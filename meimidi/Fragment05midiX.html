<html>
    <head>
        <title>Prokofiev Fragment 5 -- 1438.jpg</title>
        <link rel="stylesheet" href="css/MEImidi.css" />
        <script src="https://www.verovio.org/javascript/develop/verovio-toolkit.js" type="text/javascript" ></script>
        <!-- We also use jQuery -->
        <script src="https://code.jquery.com/jquery-3.1.1.min.js" type="text/javascript" ></script>
        <!-- Basic events from example 02 -->
        <script src="javascript/basic-events.js" type="text/javascript" ></script>
        <!-- A stylesheet for the help overlay -->
        <link rel="stylesheet" href="css/tutorial.css" />

        <!--/////////////-->
        <!-- MIDI Player -->
        <!--/////////////-->
        <script type="text/javascript" language="javascript" src="javascript/midi-player/wildwebmidi.js"></script>
        <script type="text/javascript" language="javascript" src="javascript/midi-player/midiplayer.js"></script>
        <link rel="stylesheet" href="css/midiplayer.css" />

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
      <title>Serge Prokofiev Archive as Data | Visualizations and data files drawn the from Serge Prokofiev Archive finding aid.</title>
      <meta name="generator" content="Jekyll v3.8.4" />
      <meta property="og:title" content="Serge Prokofiev Archive as Data" />
      <meta property="og:locale" content="en_US" />
      <meta name="description" content="Visualizations and data files drawn the from Serge Prokofiev Archive finding aid." />
      <meta property="og:description" content="Visualizations and data files drawn the from Serge Prokofiev Archive finding aid." />
      <link rel="canonical" href="http://localhost:4000/meimidi/htm/musicxml.html" />
      <meta property="og:url" content="http://localhost:4000/meimidi/htm/musicxml.html" />
      <meta property="og:site_name" content="Serge Prokofiev Archive as Data" />
      <script type="application/ld+json">
      {"headline":"Serge Prokofiev Archive as Data","@type":"WebPage","url":"http://localhost:4000/meimidi/htm/musicxml.html","description":"Visualizations and data files drawn the from Serge Prokofiev Archive finding aid.","@context":"http://schema.org"}</script>
      <!-- End Jekyll SEO tag -->
      <link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Serge Prokofiev Archive as Data" />
</head>
<header class="site-header" role="banner">

<div class="wrapper"><a class="site-title" rel="author" href="/">Serge Prokofiev Archive as Data</a><nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
          </svg>
        </span>
      </label>

      <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/data-files/">Data Files</a><a class="page-link" href="/sketches/">Sketches</a><a class="page-link" href="/visualizations/">Visualizations</a></div>
    </nav></div>
</header>
<main class="page-content" aria-label="Content">
    <div class="wrapper">
      <style type="text/css" media="screen">
.container {
  margin: 10px auto;
  max-width: 600px;
  text-align: center;
}
h1 {
  margin: 30px 0;
  font-size: 4em;
  line-height: 1;
  letter-spacing: -1px;
}
</style>

<!-- BUTTON STYLE -->
<!-- <style>
.button {
  background-color: #4CAF50;
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
}
</style> -->


    


    <body style="margin: 0px;">
      <div id="fragTitle">
        <H1>From the Notebooks of Serge Prokofiev</H1>
        <H2>Notebook 1: 1919-1920</H2>
        <H2>Fragment 5 &ndash; 1438.jpg</H2>
      </div>

      <script>
      function goBack() {
        window.history.back();
      }
      </script>

<button class="button" onclick="goBack()">Back</button>

<button class="button" onclick="play_midi()">
  <b>Click to play</b>
</button>

        <!-- A help overlay -->
        <!-- <div id="help_overlay">
            Press <b><strong>p</strong></b> to play
            <p>Press <b>'+'</b> or <b>'-'</b> to zoom in or out</p>
            <p>Press <b>right</b> or <b>left</b> arrows to navigate the score</p>
            <p>Press <b>ctrl + right</b> / <b>left</b> arrows to go to the beginning or the end</p>
            <p>Resize the window to see the score adjusting to it</p>
            <p>Click on any note or in the player progress bar to jump in the piece</p>
          </div> -->


        <!--//////////////////////////////////////////////////////-->
        <!-- The div where we are going to insert the MIDI Player -->
        <!--//////////////////////////////////////////////////////-->
        <div style="height: 30px;">
            <div id="player" style="z-index: 20; position: absolute; display: none;"></div>
        </div>

        <!-- The div where we are going to insert the SVG -->
        <div id="svg_output"/>

        <script type="text/javascript">
            var vrvToolkit = new verovio.toolkit();
            var page = 1;
            var zoom = 50;
            var pageHeight = 2970;
            var pageWidth = 2100;

            ////////////////////////////////////////////////
            /* A variable for storing the highlighted ids */
            ////////////////////////////////////////////////
            var ids = [];
            var isPlaying = false;

            function setOptions() {
                pageHeight = $(document).height() * 100 / zoom ;
                pageWidth = $(document).width() * 100 / zoom ;
                options = {
                            pageHeight: pageHeight,
                            pageWidth: pageWidth,
                            scale: zoom,
                            adjustPageHeight: true
                        };
                vrvToolkit.setOptions(options);
            }

            function loadData(data) {
                setOptions();
                vrvToolkit.loadData(data);

                page = 1;
                loadPage();
            }

            function loadPage() {
                svg = vrvToolkit.renderToSVG(page, {});
                $("#svg_output").html(svg);

                ////////////////////////////////////////
                /* Bind a on click event to each note */
                ////////////////////////////////////////
                $(".note").click(function() {
                    var id = $(this).attr("id");
                    var time = vrvToolkit.getTimeForElement(id);
                    $("#midi-player").midiPlayer.seek(time);
                });
            };

            function loadFile() {
                file = "meiEdit/Fragment05-1438.mei";
                $.ajax({
                    url: file
                    , dataType: "text"
                    , success: function(data) {
                        loadData(data);
                    }
                });
            }

            ////////////////////////////////////////////
            /* A function that start playing the file */
            ////////////////////////////////////////////
            function play_midi() {
                if (isPlaying == false) {
                    var base64midi = vrvToolkit.renderToMIDI();
                    var song = 'data:audio/midi;base64,' + base64midi;
                    $("#player").show();
                    $("#player").midiPlayer.play(song);
                    isPlaying = true;
                }
            }

            //////////////////////////////////////////////////////
            /* Two callback functions passed to the MIDI player */
            //////////////////////////////////////////////////////
            var midiUpdate = function(time) {
                // time needs to - 400 for adjustment
                var vrvTime = Math.max(0, time - 400);
                var elementsattime = vrvToolkit.getElementsAtTime(vrvTime);
                if (elementsattime.page > 0) {
                    if (elementsattime.page != page) {
                        page = elementsattime.page;
                        loadPage();
                    }
                    if ((elementsattime.notes.length > 0) && (ids != elementsattime.notes)) {
                        ids.forEach(function(noteid) {
                            if ($.inArray(noteid, elementsattime.notes) == -1) {
                                $("#" + noteid).attr("fill", "#000").attr("stroke", "#000");
                            }
                        });
                        ids = elementsattime.notes;
                        ids.forEach(function(noteid) {
                            if ($.inArray(noteid, elementsattime.notes) != -1) {
                                $("#" + noteid).attr("fill", "#c00").attr("stroke", "#c00");;
                            }
                        });
                    }
                }
            }

            var midiStop = function() {
                ids.forEach(function(noteid) {
                    $("#" + noteid).attr("fill", "#000").attr("stroke", "#000");
                });
                $("#player").hide();
                isPlaying = false;
            }

            $(document).ready(function() {

                $(window).keyup(function(event){
                    ////////////////////////////////
                    /* Key events 'p' for playing */
                    ////////////////////////////////
                    if (event.keyCode == 80) {
                        play_midi();
                    }
                });

                $(window).resize(function(){
                    applyZoom();
                });

                $("#player").midiPlayer({
                    color: "#c00",
                    onUpdate: midiUpdate,
                    onStop: midiStop,
                    width: 250
                });

                loadFile();
            });
        </script>


    </body>
</html>
