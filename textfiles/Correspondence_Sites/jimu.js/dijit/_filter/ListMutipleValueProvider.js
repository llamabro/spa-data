// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:jimu/dijit/_filter/ListMutipleValueProvider.html":'\x3cdiv\x3e\r\n   \x3c!--\r\n    \x3cselect data-dojo-attach-point\x3d"valProviderSelect" class\x3d"dijit-form-Select multiple-Select"  data-dojo-attach-event\x3d"onclick:_showPopup"\x3e\r\n    \x3c/select\x3e\r\n    --\x3e\r\n    \x3c!-- \x3cdiv class\x3d"subTitle"\x3e${CommonNls.layer}: \x3cspan data-dojo-attach-point\x3d"layerName"\x3e\x3c/span\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"jimu-filter-popup-btn jimu-not-selectable"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"listSelectStore" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e --\x3e\r\n\r\n      \x3c!-- for list select popup --\x3e\r\n      \x3c!-- \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e --\x3e\r\n      \x3c!-- for eidtTable --\x3e\r\n      \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"icon"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--\r\n      \x3cdiv class\x3d"add-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e\r\n        \x3cdiv class\x3d"tip"\x3eopenLayer-temp\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"add-btn add-btn-right" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n       --\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"tableContent"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"displayTypes" data-dojo-attach-point\x3d"displayTypes" data-dojo-attach-event\x3d"click:_changeDisplayType"\x3e\r\n      \x3cdiv class\x3d"title jimu-ellipsis"\x3e${Nls.displayAs}\x3c/div\x3e\r\n      \x3cspan class\x3d"option dropdownOption"\x3e\r\n        \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aDrowdownList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n      \x3cspan class\x3d"option expandedOption"\x3e\r\n      \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aExpandedList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3c!--\r\n    \x3cdiv class\x3d"jimu-multiple-set-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"" class\x3d"items-list-content items-list-header"  \x3e\r\n        \x3cdiv class\x3d"item"\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.name}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.label}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label checkboxHeader jimu-ellipsis" title\x3d"set default?"\x3e${CommonNls.defaults}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label lableR jimu-ellipsis"\x3e${CommonNls.actions}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"listContent" class\x3d"items-list-content" data-dojo-attach-event\x3d"click:_onListContentClicked"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    --\x3e\r\n\r\n    \x3cdiv class\x3d"value-type-popup" data-dojo-attach-point\x3d"valuesPopupNode" style\x3d"display:none;"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"mutiValuesSelect" multiple\x3d"true" data-dojo-type\x3d"dojox/form/CheckedMultiSelect" data-dojo-props\x3d\'searchAttr:"label",required:false,intermediateChanges:true\' style\x3d"width:100%;" \x3e\x3c/div\x3e --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"pageControlContainer"\x3eLoad more data\x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3c!-- \x3ca data-dojo-attach-event\x3d"onclick:_setSelectType" class\x3d"popupOper" style\x3d"display:none;"\x3etype\x3c/a\x3e --\x3e\r\n  \x3c/div\x3e'}});
define("dojo/_base/lang dojo/Deferred dojo/_base/html dojo/_base/array dojo/_base/declare dojo/Evented dojo/query ./ValueProvider ./EditTable ./ListMultipleSelect dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./ListMutipleValueProvider.html dojo/store/Memory jimu/utils jimu/dijit/Popup jimu/dijit/pageControlForQuery dojox/form/CheckedMultiSelect".split(" "),function(b,l,c,m,n,p,f,q,r,g,t,u,v,w,h,k,x,y){return n([q,t,u,p],{templateString:v,codedValues:null,staticValues:null,showNullValues:!1,
cbxPopup:null,pageSize:1E3,pageIndex:1,selectUI:null,postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder;this.emptyStr=window.apiNls.widgets.FeatureTable.empty},postCreate:function(){this.inherited(arguments);this.selectUI=this.selectUI?this.selectUI:"dropdown";c.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");this.controlType="unique";"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType&&(this.controlType=
"multiple");this.isNumberField=h.isNumberField(this.fieldInfo.type);this.editTable||(this.editTable=new r({tableType:this.controlType,dataList:[],codedValues:this.codedValues,customValue:this.Nls.addValuePlaceHolder,customLabel:this.Nls.addLabelPlaceHolder,isNumberField:this.isNumberField}),this.editTable.placeAt(this.tableContent),this.editTable.on("editTable_openListSelectByName",b.hitch(this,this._showListSelectByTable)),this.editTable.on("editTable_itemChanged",b.hitch(this,this._editTableItemChanged)));
this.supportPaing=!0;this.pageControlForQuery||(this.pageControlForQuery=new x({pageSize:this.pageSize,pageIndex:1,layerUrl:this.url,fieldInfo:this.fieldInfo,queryWhere:"1\x3d1",layerDefinition:this.layerDefinition,isNumberField:this.isNumberField}));this.listSelect||(this.listSelect=new g({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],isNumberField:this.isNumberField}),this.listSelect.on("listMultipleSelect_itemChecked",
b.hitch(this,this._createTarget)),this.listSelect.on("listMultipleSelect_itemUnChecked",b.hitch(this,this._destoryTarget)),this.listSelect.on("listMultipleSelect_addNextPage",b.hitch(this,this._addNextPage)),this.listSelect.on("listMultipleSelect_searchKey",b.hitch(this,this._searchKey)),this.listSelect.on("listMultipleSelect_searchKeyLocal",b.hitch(this,this._searchKeyLocal)),this.listSelect.on("listMultipleSelect_itemCheckedForPredefined",b.hitch(this,this._createTargetForPredefined)));this.mutiValuesSelect||
(this.mutiValuesSelect=new y({multiple:!0,required:!1,intermediateChanges:!0,style:{width:"100%"}}));this._multipleSelectProviderEventHandler=b.hitch(this,this._multipleSelectProviderEvent);document.addEventListener("click",this._multipleSelectProviderEventHandler);var a=new w({idProperty:"id",data:[]});this.listSelect.set("store",a)},_multipleSelectProviderEvent:function(a){var d=a.target||a.srcElement,b=c.isDescendant(d,this.editTable.searchBtn);this.editTable&&this.cbxPopup&&this.cbxPopup.domNode?
(b?"block"===c.getStyle(this.cbxPopup.domNode,"display")?c.setStyle(this.cbxPopup.domNode,"display","none"):c.setStyle(this.cbxPopup.domNode,"display","block"):c.isDescendant(d,this.cbxPopup.domNode)||this._createTargetForPredefined(),a.stopPropagation()):this._isInSelectPopup(d)||this.runtime?a.stopPropagation():c.setStyle(this.valuesPopupNode,"display","none")},_initListMultipleSelect:function(){this.pageControlForQuery.pageIndex=1;this.pageControlForQuery.isKeyQueryLoader=!1;this.listSelect=new g({emptyStr:this.emptyStr,
runtime:this.runtime,pageSize:this.pageSize,isCacheFinish:this.pageControlForQuery._isUniqueValueCacheFinish,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],isNumberField:this.isNumberField});this.listSelect.on("listMultipleSelect_itemChecked",b.hitch(this,this._createTarget));this.listSelect.on("listMultipleSelect_itemUnChecked",b.hitch(this,this._destoryTarget));this.listSelect.on("listMultipleSelect_addNextPage",b.hitch(this,this._addNextPage));this.listSelect.on("listMultipleSelect_searchKey",
b.hitch(this,this._searchKey));this.listSelect.on("listMultipleSelect_searchKeyLocal",b.hitch(this,this._searchKeyLocal));this.listSelect.on("listMultipleSelect_itemCheckedForPredefined",b.hitch(this,this._createTargetForPredefined))},_isInSelectPopup:function(a){for(var d="dijitCheckBoxInput dojoxMultiSelectItemLabel dojoxMultiSelectItemBox dojoxMultiSelectItem dojoxCheckedMultiSelectWrapper dojoxCheckedMultiSelect value-type-popup popupOper pageItem".split(" "),b=!1,e=0;e<=d.length;e++)if(c.hasClass(a,
d[e])){b=!0;break}return b},_createTarget:function(){this.editTable._createTarget("","","",!0);this._editTableItemChanged()},_createTargetForPredefined:function(a){this.editTable._setNewLabel(a);this.cbxPopup.close();this._editTableItemChanged()},_destoryTarget:function(a){this.editTable._destroyTarget(a);this._editTableItemChanged()},_editTableItemChanged:function(){if(!this.runtime){var a=this.getValueObject();this._setApplyState(a.value.length)}},_setApplyState:function(a){this.emit("listMultipleValueProvider_setApplyBtnState",
a)},_cbxWidth:245,_cbxHeight:330,isPopupLoading:!1,_showListSelectByTable:function(a){if(!this.isPopupLoading){this._initListMultipleSelect();this.valueList=[a];this.getCheckedList(this.valueList);a=c.position(this.editTable.searchBtn);var d=a.x-226,z=a.y+30;window.isRTL&&(d=a.x);this.cbxPopup=new k({width:this._cbxWidth,height:this._cbxHeight,content:this.listSelect.domNode,titleLabel:"",isResize:!1,buttons:[]});c.setStyle(this.cbxPopup.contentContainerNode,{top:"5px",bottom:"3px",left:"3px",right:"3px"});
c.destroy(this.cbxPopup.titleNode);c.setStyle(this.cbxPopup.domNode,{display:"block",left:d+"px",top:z+"px",border:"1px solid #999"});this.listSelect.valueInput&&this.listSelect.valueInput.focus();c.setStyle(this.cbxPopup.overlayNode,"display","none");this._showLoadingIcon();this.isPopupLoading=!0;this._valueLabels().then(b.hitch(this,function(a){this.isPopupLoading=!1;this._hideLoadingIcon();if(!0!==a){var d=!1;this.valueList&&0!==this.valueList.length&&(d=!0);this.listSelect.setCBXData(a,d)}}))}},
_valueLabels:function(){var a=new l;this.listSelect.codedValues=!1;if(this.staticValues)return this._setValueForStaticValues(this.staticValues),a.resolve(!0),a;if(this.codedValues)if(this.filterCodedValue)this.listSelect.codedValues=!0;else return this._setValueForStaticValues(this.codedValues),a.resolve(!0),a;this.pageControlForQuery.getPageValueDef(!0).then(b.hitch(this,function(d){a.resolve(d)}),b.hitch(this,function(d){console.log(d);this._hideLoadingIcon();a.reject(d)}));return a},_setValueForStaticValues:function(a){this.listSelect.codedValues=
!0;a&&(this.pageControlForQuery._codedvalueCache=a,a=0<a.length?a:[],this.listSelect.disPlayLabel="label",this.listSelect.setCBXData(a,!0,!0))},_changeDisplayType:function(a){a=a.target||a.srcElement;a=c.hasClass(a,"option")?a:h.getAncestorDom(a,function(a){return c.hasClass(a,"option")},2);c.hasClass(a,"checked")||(c.addClass(a,"checked"),a=f("."+this.selectUI+"Option ",this.displayTypes)[0],c.removeClass(a,"checked"),this.selectUI="expanded"===this.selectUI?"dropdown":"expanded")},_setDisplayTypeStyle:function(){var a=
f(".title",this.displayTypes)[0],d=f(".label",this.displayTypes),a=(c.getStyle(this.displayTypes,"width")-c.getStyle(a,"width")-80)/2,b=c.getStyle(d[0],"width"),b=b<a?b:a,e=c.getStyle(d[1],"width"),e=e<a?e:a;c.setStyle(d[0],"width",b+"px");c.setStyle(d[1],"width",e+"px")},_addNextPage:function(){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery._addNextPage(this.listSelect.ifFristPage).then(b.hitch(this,function(a){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;
this.listSelect.setCBXData(a,!0);this._hideLoadingIcon()}),b.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},_searchKey:function(a){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery._searchKey(a).then(b.hitch(this,function(a){this.listSelect.setCBXContentBySearch(a);this._hideLoadingIcon()}),b.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},_searchKeyLocal:function(a){this.listSelect&&(this._showLoadingIcon(),a=this.pageControlForQuery._searchKeyLocal(a),
this.listSelect.setCBXContentBySearch(a),this._hideLoadingIcon())},_handlerPageValues:function(){},getCheckedList:function(a){this.listSelect.checkedList=[];this.isNumberField?m.forEach(a,b.hitch(this,function(a){this.listSelect.checkedList.push(parseFloat(a))})):this.listSelect.checkedList=a},_showPopup:function(){var a=this.getValueObject().valueList;this.valueList=null===a?void 0:a;this.getCheckedList(this.valueList);this.cbxPopup?(this.listSelect.checkCBXItems(!1),this.cbxPopup.show()):(this.cbxPopup=
new k({width:355,height:596,content:this.listSelect.domNode,titleLabel:this.layerDefinition.name+"("+this.fieldName+")",isResize:!1,onClose:b.hitch(this,function(){this.cbxPopup.hide();return!1}),buttons:[]}),this._showLoadingIcon(),this.pageControlForQuery.getPageValueDef().then(b.hitch(this,function(a){this._hideLoadingIcon();var b=!1;this.valueList&&0!==this.valueList.length&&(b=!0);this.listSelect.setCBXData(a,b)})))},getDijits:function(){return[this.mutiValuesSelect]},setValueObject:function(a){a.value=
a.value?a.value:[];var b=f("."+(a.selectUI?a.selectUI:this.selectUI)+"Option ",this.displayTypes)[0];c.addClass(b,"checked");this.editTable.setListValues(a.value)},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,selectUI:this.selectUI,type:this.partObj.valueObj.type,value:"string"===this.shortType?"":null,checkedValue:"string"===this.shortType?"":null}:null},getValueObject:function(){if(this.isValidValue()){var a=this.editTable.getListValues();
return{isValid:!0,selectUI:this.selectUI,type:this.partObj.valueObj.type,value:a.list,valueList:a.valueList}}return null},setRequired:function(a){this.mutiValuesSelect.set("required",a)},queryByPage:function(){var a=this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage);a.then(b.hitch(this,function(b){a.resolve(b)}),b.hitch(this,function(b){console.log(b);a.reject(b)}))},_showLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&c.addClass(this.listSelect.listContainer,
"jimu-circle-loading")},_hideLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&c.removeClass(this.listSelect.listContainer,"jimu-circle-loading")},destroy:function(){this._multipleSelectProviderEventHandler&&document.removeEventListener("click",this._multipleSelectProviderEventHandler);this.inherited(arguments)},destroyProvider:function(){this.editTable&&this.editTable.destroy();this.listSelect&&this.listSelect.destroy();this.listSelect=null;this.destroy();c.destroy(this.domNode)}})});