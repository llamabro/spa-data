// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/Print/Print":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin esri/tasks/PrintTask esri/tasks/PrintParameters esri/tasks/PrintTemplate esri/request esri/lang esri/arcgis/utils dojo/_base/config dojo/_base/lang dojo/_base/array dojo/_base/html dojo/dom-style dojo/dom-construct dojo/dom-class dojo/promise/all dojo/Deferred jimu/portalUrlUtils dojo/text!./templates/Print.html dojo/text!./templates/PrintResult.html dojo/aspect dojo/query jimu/LayerInfos/LayerInfos jimu/dijit/LoadingShelter jimu/dijit/Message jimu/utils dojo/on dijit/popup dijit/form/ValidationTextBox dijit/form/Form dijit/form/Select dijit/form/NumberTextBox dijit/form/Button dijit/form/CheckBox dijit/ProgressBar dijit/form/DropDownButton dijit/TooltipDialog dijit/form/RadioButton dijit/form/SimpleTextarea esri/IdentityManager dojo/store/Memory".split(" "),
function(d,l,n,u,x,m,h,g,c,b,y,k,t,a,C,A,B,z,H,D,F,G,I,K,E,L,M,e,J,q,O){F=d([l,n,u],{widgetsInTemplate:!0,templateString:F,map:null,count:1,results:[],authorText:null,copyrightText:null,copyrightEditable:!0,defaultTitle:null,defaultFormat:null,defaultLayout:null,baseClass:"gis_PrintDijit",pdfIcon:require.toUrl("./widgets/Print/images/pdf.png"),imageIcon:require.toUrl("./widgets/Print/images/image.png"),printTaskURL:null,printTask:null,async:!1,_showSettings:!1,_currentTemplateInfo:null,postCreate:function(){this.inherited(arguments);
this.printTask=new x(this.printTaskURL,{async:this.async});this.printparams=new m;this.printparams.map=this.map;this.shelter=new L({hidden:!0});this.shelter.placeAt(this.domNode);this.shelter.startup();this.shelter.show();this.titleNode.set("value",this.defaultTitle);this.authorNode.set("value",this.defaultAuthor);this.copyrightNode.set("value",this.defaultCopyright);this.copyrightNode.set("readOnly",!this.copyrightEditable);var b=D.setHttpProtocol(this.printTaskURL),r=D.getNewPrintUrl(this.appConfig.portalUrl);
this._isNewPrintUrl=b===r||/sharing\/tools\/newPrint$/.test(b);b=K("input",this.printWidgetMapScale.domNode)[0];r=K("input",this.printWidgetMapExtent.domNode)[0];e.combineRadioCheckBoxWithLabel(b,this.printWidgetMapScaleLabel);e.combineRadioCheckBoxWithLabel(r,this.printWidgetMapExtentLabel);"MAP_ONLY"===this.defaultLayout?a.setStyle(this.titleTr,"display","none"):a.setStyle(this.titleTr,"display","");this._hasLabelLayer()?(a.setStyle(this.labelsFormDijit.domNode,"display",""),a.setStyle(this.labelsTitleNode,
"display","")):(a.setStyle(this.labelsFormDijit.domNode,"display","none"),a.setStyle(this.labelsTitleNode,"display","none"));E.getInstance(this.map,this.map.itemInfo).then(k.hitch(this,function(f){this.layerInfosObj=f;return z([this._getPrintTaskInfo(),this._getLayerTemplatesInfo()]).then(k.hitch(this,function(f){var r=f[0];(f=f[1])&&!f.error?(f=f&&f.results)&&0<f.length&&(t.some(f,k.hitch(this,function(f){return f&&"Output_JSON"===f.paramName?this.templateInfos=f.value:!1})),this.templateInfos&&
0<this.templateInfos.length&&(this.templateNames=t.map(this.templateInfos,function(f){return f.layoutTemplate}))):console.warn("Get Layout Templates Info Error",f&&f.error);!c.isDefined(r)||r&&r.error?this._handleError(r.error):this._handlePrintInfo(r)}))})).always(k.hitch(this,function(){this.shelter.hide()}));this.printTask._getPrintDefinition&&I.after(this.printTask,"_getPrintDefinition",k.hitch(this,"printDefInspector"),!1);this.printTask._createOperationalLayers&&(I.after(this.printTask,"_createOperationalLayers",
k.hitch(this,"_fixInvalidSymbol")),I.after(this.printTask,"_createOperationalLayers",k.hitch(this,"_excludeInvalidLegend")))},_hasLabelLayer:function(){return t.some(this.map.graphicsLayerIds,function(a){return(a=this.map.getLayer(a))&&"esri.layers.LabelLayer"===a.declaredClass},this)},_getPrintTaskInfo:function(){var a=new H;this._isNewPrintUrl?a.resolve({isGPPrint:!1}):g({url:this.printTaskURL,content:{f:"json"},callbackParamName:"callback",handleAs:"json",timeout:6E4}).then(k.hitch(this,function(r){a.resolve({isGPPrint:!0,
data:r})}),k.hitch(this,function(r){a.resolve({error:r})}));return a},_getLayerTemplatesInfo:function(){var a=new H,r=this.printTaskURL.split("/"),f=r.indexOf("GPServer");if(-1<f){var v=null,v=/Utilities\/PrintingTools\/GPServer/.test(this.printTaskURL)?r.slice(0,f+1).join("/")+"/"+encodeURIComponent("Get Layout Templates Info Task")+"/execute":r.slice(0,f+1).join("/")+"/"+encodeURIComponent("Get Layout Templates Info")+"/execute";g({url:v,content:{f:"json"},callbackParamName:"callback",handleAs:"json",
timeout:6E4}).then(k.hitch(this,function(f){a.resolve(f)}),k.hitch(this,function(f){a.resolve({error:f})}))}else a.resolve(null);return a},_fixInvalidSymbol:function(a){t.forEach(a,function(r){"map_graphics"===r.id&&(r=k.getObject("featureCollection.layers",!1,r))&&0<r.length&&t.forEach(r,function(f){f&&f.featureSet&&"esriGeometryPoint"===f.featureSet.geometryType&&t.forEach(f.featureSet.features,function(f){f&&f.symbol&&!f.symbol.style&&(f.symbol.style="esriSMSSquare")})})},this);return a},_excludeInvalidLegend:function(a){function r(f){return t.filter(f.subLayerIds,
k.hitch(this,function(r){return(r=this.layerInfosObj.getLayerInfoById(f.id+"_"+r))&&r.getShowLegendOfWebmap()}))}if(this.printTask.allLayerslegend){for(var f=b.getLegendLayers({map:this.map,itemInfo:this.map.itemInfo}),f=t.map(f,function(f){return{id:f.layer.id}}),v=this.printTask.allLayerslegend,e=[],E=0;E<v.length;E++){var c=v[E],q=this.map.getLayer(c.id),J=this.layerInfosObj.getLayerInfoById(c.id),g=q&&q.declaredClass&&"esri.layers.GraphicsLayer"!==q.declaredClass,q=!q.renderer||q.renderer&&!q.renderer.hasVisualVariables(),
J=J&&J.getShowLegendOfWebmap();g&&q&&J&&(c.subLayerIds&&(c.subLayerIds=k.hitch(this,r,c)()),e.push(c))}t.forEach(f,k.hitch(this,function(f){var r=t.some(e,k.hitch(this,function(r){return r.id===f.id})),v=this.layerInfosObj.getLayerInfoById(f.id),v=v&&v.getShowLegendOfWebmap()&&v.isShowInMap();!r&&v&&e.push(f)}));this.printTask.allLayerslegend=e}return a},printDefInspector:function(a){"force"===this.preserve.preserveScale&&(a.mapOptions.scale=this.preserve.forcedScale);return a},_handleError:function(a){console.log("print widget load error: ",
a);new M({message:a.message||a})},onLayoutChange:function(e){var r=this.templateNames&&this.templateNames.indexOf(e);if(-1<r){a.empty(this.customTextElementsTable);e=this._currentTemplateInfo=this.templateInfos[r];if((r=k.getObject("layoutOptions.customTextElements",!1,e))&&0<r.length){var f=[];t.forEach(r,k.hitch(this,function(r){for(var v in r)if(0>f.indexOf(v)){var e=this.customTextElementsTable.insertRow(-1);e.insertCell(-1).appendChild(a.toDom(v+": "));e.insertCell(-1).appendChild((new O({name:v,
trim:!0,required:!1,value:r[v],style:"width:100%"})).domNode);f.push(v)}}))}k.getObject("layoutOptions.hasAuthorText",!1,e)?a.setStyle(this.authorTr,"display",""):a.setStyle(this.authorTr,"display","none");k.getObject("layoutOptions.hasCopyrightText",!1,e)?a.setStyle(this.copyrightTr,"display",""):a.setStyle(this.copyrightTr,"display","none");k.getObject("layoutOptions.hasTitleText",!1,e)?a.setStyle(this.titleTr,"display",""):a.setStyle(this.titleTr,"display","none");k.getObject("layoutOptions.hasLegend",
!1,e)?a.setStyle(this.legendTr,"display",""):a.setStyle(this.legendTr,"display","none")}else"MAP_ONLY"===e?(a.setStyle(this.authorTr,"display","none"),a.setStyle(this.copyrightTr,"display","none"),a.setStyle(this.titleTr,"display","none"),a.setStyle(this.legendTr,"display","none"),this._currentTemplateInfo={layoutOptions:{hasTitleText:!1,hasCopyrightText:!1,hasAuthorText:!1,hasLegend:!1}}):(a.setStyle(this.authorTr,"display",""),a.setStyle(this.copyrightTr,"display",""),a.setStyle(this.titleTr,"display",
""),a.setStyle(this.legendTr,"display",""),this._currentTemplateInfo={layoutOptions:{hasTitleText:!0,hasCopyrightText:!0,hasAuthorText:!0,hasLegend:!0}})},_getMapAttribution:function(){var e=this.map.attribution;return e&&e.domNode?a.getProp(e.domNode,"textContent"):""},showSettings:function(a){a.preventDefault();a.stopPropagation();this._showSettings?(q.close(this.settingsDialog),this._showSettings=!1):(q.open({popup:this.settingsDialog,around:this.advancedButtonDijit}),this._showSettings=!0)},_handlePrintInfo:function(e){if(e.isGPPrint){e=
e.data;C.set(this.layoutDijit.domNode.parentNode.parentNode,"display","");C.set(this.formatDijit.domNode.parentNode.parentNode,"display","");C.set(this.advancedButtonDijit,"display","");this.own(J(document.body,"click",k.hitch(this,function(f){if(this._showSettings){f=f.target||f.srcElement;var r=this.settingsDialog.domNode;f===r||a.isDescendant(f,r)||(q.close(this.settingsDialog),this._showSettings=!1)}})));var r=t.filter(e.parameters,function(f){return"Layout_Template"===f.name});if(0===r.length)console.log('print service parameters name for templates must be "Layout_Template"');
else{var f=t.map(r[0].choiceList,function(f){return{label:f,value:f}});f.sort(function(f,r){return f.label>r.label?1:r.label>f.label?-1:0});this.layoutDijit.addOption(f);this.defaultLayout?this.layoutDijit.set("value",this.defaultLayout):this.layoutDijit.set("value",r[0].defaultValue);e=t.filter(e.parameters,function(f){return"Format"===f.name});0===e.length?console.log('print service parameters name for format must be "Format"'):(r=t.map(e[0].choiceList,function(f){return{label:f,value:f}}),r.sort(function(f,
r){return f.label>r.label?1:r.label>f.label?-1:0}),this.formatDijit.addOption(r),this.defaultFormat?this.formatDijit.set("value",this.defaultFormat):this.formatDijit.set("value",e[0].defaultValue))}}else C.set(this.layoutDijit.domNode.parentNode.parentNode,"display","none"),C.set(this.formatDijit.domNode.parentNode.parentNode,"display","none"),C.set(this.advancedButtonDijit,"display","none")},print:function(){if(this.printSettingsFormDijit.isValid()){var a=this.printSettingsFormDijit.get("value");
k.mixin(a,this.layoutMetadataDijit.get("value"));k.mixin(a,this.forceAttributesFormDijit.get("value"));k.mixin(a,this.labelsFormDijit.get("value"));this.preserve=this.preserveFormDijit.get("value");k.mixin(a,this.preserve);this.layoutForm=this.layoutFormDijit.get("value");var r=this.mapQualityFormDijit.get("value"),f=this.mapOnlyFormDijit.get("value");k.mixin(f,r);var v=this.customTextElementsDijit.get("value"),r=[],e=!1,b=y.locale||"en",E;for(E in v){var c={};"Date"===E&&(e=!0);c[E]=v[E];r.push(c)}e||
r.push({Date:(new Date).toLocaleString(b)});e=this._currentTemplateInfo;E=k.getObject("layoutOptions.hasAuthorText",!1,e);v=k.getObject("layoutOptions.hasCopyrightText",!1,e);e=k.getObject("layoutOptions.hasTitleText",!1,e);b=new h;b.format=a.format;b.layout=a.layout;b.preserveScale="true"===a.preserveScale||"force"===a.preserveScale;b.forceFeatureAttributes=a.forceFeatureAttributes&&a.forceFeatureAttributes[0];b.label=a.title;b.exportOptions=f;b.showLabels=a.showLabels&&a.showLabels[0];b.layoutOptions=
{authorText:E?a.author:"",copyrightText:v?a.copyright||this._getMapAttribution():"",legendLayers:this._getLegendLayers(),titleText:e?a.title:"",customTextElements:r,scalebarUnit:this.layoutForm.scalebarUnit};this.printparams.template=b;this.printparams.extraParameters={printFlag:!0};f=this.printTask.execute(this.printparams);(new P({count:this.count.toString(),icon:"PDF"===a.format?this.pdfIcon:this.imageIcon,docName:a.title,title:a.format+", "+a.layout,fileHandle:f,nls:this.nls})).placeAt(this.printResultsNode,
"last").startup();C.set(this.clearActionBarNode,"display","block");this.count++}else this.printSettingsFormDijit.validate()},_getLegendLayers:function(){var a=k.getObject("layoutOptions.hasLegend",!1,this._currentTemplateInfo),r=0<this.layoutForm.legend.length&&this.layoutForm.legend[0];if(this.printTask&&!this.printTask._createOperationalLayers){var f=[];a&&r&&(a=b.getLegendLayers({map:this.map,itemInfo:this.map.itemInfo}),f=t.map(a,function(f){return{layerId:f.layer.id}}));return f}return a&&r?
null:[]},clearResults:function(){A.empty(this.printResultsNode);C.set(this.clearActionBarNode,"display","none");this.count=1},updateAuthor:function(a){(a=a||"")&&this.authorTB&&this.authorTB.set("value",a)},getCurrentMapScale:function(){this.forceScaleNTB.set("value",this.map.getScale())}});var P=d([l,n,u],{widgetsInTemplate:!0,templateString:G,url:null,postCreate:function(){this.inherited(arguments);this.progressBar.set("label",this.nls.creatingPrint);this.fileHandle.then(k.hitch(this,"_onPrintComplete"),
k.hitch(this,"_onPrintError"))},_onPrintComplete:function(e){e.url?(this.url=e.url,a.setStyle(this.progressBar.domNode,"display","none"),a.setStyle(this.successNode,"display","inline-block"),B.add(this.resultNode,"printResultHover")):this._onPrintError(this.nls.printError)},_onPrintError:function(e){console.log(e);a.setStyle(this.progressBar.domNode,"display","none");a.setStyle(this.errNode,"display","block");B.add(this.resultNode,"printResultError");a.setAttr(this.domNode,"title",e.details||e.message||
"")},_openPrint:function(){null!==this.url&&window.open(this.url)}});return F})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ../request ../urlUtils ../geometry/Polygon ../renderers/SimpleRenderer ../symbols/FillSymbol ./Geoprocessor ./PrintTemplate ./Task dojo/dom-attr dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),
function(d,l,n,u,x,m,h,g,c,b,y,k,t,a,C,A,B,z,H,D,F,G,I,K){d=d(H,{declaredClass:"esri.tasks.PrintTask",constructor:function(a,b){this.url=a;this.printGp=new B(this.url);this._handler=l.hitch(this,this._handler);b&&b.async&&(this.async=!0);this._colorEvaluator=K("$..color")},async:!1,_vtlExtent:null,_cimVersion:null,_is11xService:!1,_loadGpServerMetadata:!0,execute:function(a,c,g){if(!this._loadGpServerMetadata)return this._execute(a,c,g);var e=new x(b._dfdCanceller),E=this._url.path,q=E.lastIndexOf("/GPServer/");
0<q&&(E=E.slice(0,q+9));e._pendingDfd=k({url:E,callbackParamName:"callback",content:l.mixin({},this._url.query,{f:"json"})}).then(l.hitch(this,function(b){this._loadGpServerMetadata=!1;this.async="esriExecutionTypeAsynchronous"===b.executionType;this._cimVersion=b.cimVersion;this._is11xService=!!this._cimVersion;e._pendingDfd=this._execute(a);return e._pendingDfd})).then(l.hitch(this,function(a){this._successHandler([a],"onComplete",c,e)})).otherwise(l.hitch(this,function(a){this._errorHandler(a,
g,e)}));return e},_handler:function(a,b,c,e,k){try{var E;this.async?"esriJobSucceeded"===a.jobStatus&&this.printGp.getResultData(a.jobId,"Output_File",l.hitch(this,function(a){E=a.value;this._successHandler([E],"onComplete",c,k)})):(E=a[0].value,this._successHandler([E],"onComplete",c,k))}catch(O){this._errorHandler(O,e,k)}},_execute:function(a,c,k){var e=this._handler,E=this._errorHandler,q=a.template||new z;q.hasOwnProperty("showLabels")||(q.showLabels=!0);var h=q.exportOptions,m;h&&(m={outputSize:[h.width,
h.height],dpi:h.dpi});var h=q.layoutOptions,d,r=[];if(h){this.legendAll=!1;h.legendLayers?n.forEach(h.legendLayers,function(f){var a={};a.id=f.layerId;f.subLayerIds&&(a.subLayerIds=f.subLayerIds);r.push(a)}):this.legendAll=!0;var f,v;if("Miles"===h.scalebarUnit||"Kilometers"===h.scalebarUnit)f="esriKilometers",v="esriMiles";else if("Meters"===h.scalebarUnit||"Feet"===h.scalebarUnit)f="esriMeters",v="esriFeet";d={esriMiles:"mi",esriKilometers:"km",esriFeet:"ft",esriMeters:"m"};d={titleText:h.titleText,
authorText:h.authorText,copyrightText:h.copyrightText,customTextElements:h.customTextElements,scaleBarOptions:{metricUnit:f,metricLabel:d[f],nonMetricUnit:v,nonMetricLabel:d[v]},legendOptions:{operationalLayers:r}}}f=this._getPrintDefinition(a.map,q);a.outSpatialReference&&(f.mapOptions.spatialReference=a.outSpatialReference.toJson());a.template&&g.isDefined(a.template.showAttribution)&&(f.mapOptions.showAttribution=a.template.showAttribution);l.mixin(f,{exportOptions:m,layoutOptions:d});this.allLayerslegend&&
l.mixin(f.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});if(f.operationalLayers){m=f.operationalLayers;var w,L=function(f){return g.fixJson(l.mixin(f,{type:"esriSLS",cap:void 0,join:void 0,meterLimit:void 0}))},t=/[\u4E00-\u9FFF\u0E00-\u0E7F\u0900-\u097F\u3040-\u309F\u30A0-\u30FF\u31F0-\u31FF]/,C=/[\u0600-\u06FF]/,y=function(f){var r=f.text,a=(f=f.font)&&f.family&&f.family.toLowerCase();r&&f&&("arial"===a||"arial unicode ms"===a)&&(f.family=t.test(r)?"Arial Unicode MS":"Arial",
"normal"!==f.style&&C.test(r)&&(f.family="Arial Unicode MS"))};for(d=0;d<m.length;d++)if(m[d].featureCollection&&m[d].featureCollection.layers)for(v=0;v<m[d].featureCollection.layers.length;v++){var A=m[d].featureCollection.layers[v];A.layerDefinition&&A.layerDefinition.drawingInfo&&A.layerDefinition.drawingInfo.renderer&&A.layerDefinition.drawingInfo.renderer.symbol&&(w=A.layerDefinition.drawingInfo.renderer,"esriCLS"===w.symbol.type?w.symbol=L(w.symbol):"esriTS"===w.symbol.type?y(w.symbol):w.symbol.outline&&
"esriCLS"===w.symbol.outline.type&&(w.symbol.outline=L(w.symbol.outline)));if(A.featureSet&&A.featureSet.features)for(h=0;h<A.featureSet.features.length;h++)w=A.featureSet.features[h],w.symbol&&("esriCLS"===w.symbol.type?w.symbol=L(w.symbol):"esriTS"===w.symbol.type?y(w.symbol):w.symbol.outline&&"esriCLS"===w.symbol.outline.type&&(w.symbol.outline=L(w.symbol.outline)))}}q={Web_Map_as_JSON:u.toJson(g.fixJson(f)),Format:q.format,Layout_Template:q.layout};a.extraParameters&&(q=l.mixin(q,a.extraParameters));
var M=new x(b._dfdCanceller);a=function(f,r){e(f,r,c,k,M)};f=function(f){E(f,k,M)};M._pendingDfd=this.async?this.printGp.submitJob(q,a,null,f):this.printGp.execute(q,a,f);return M},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",
drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},_convertSvgSymbol:function(a){if(!(8>=
m("ie")||!a.path&&"image/svg+xml"!==a.contentType)){var b,c=I.createSurface(F.create("div"),1024,1024);b="image/svg+xml"===a.contentType?c.createObject(I.Image,{src:"data:image/svg+xml;base64,"+a.imageData,width:G.pt2px(a.width),height:G.pt2px(a.height),x:0,y:0}):c.createObject(I.Path,a.path).setFill(a.color).setStroke(a.outline);"pendingRender"in c&&c._render(!0);var e=c.rawNode.getContext("2d"),E=Math.ceil(b.getBoundingBox().width),k=Math.ceil(b.getBoundingBox().height);b=e.getImageData(b.getBoundingBox().x,
b.getBoundingBox().y,E,k);e.canvas.width=E;e.canvas.height=k;e.putImageData(b,0,0);e=e.canvas.toDataURL("image/png");a={type:"esriPMS",imageData:e.substr(22,e.length),angle:a.angle,contentType:"image/png",height:a.size?a.size:G.px2pt(k),width:a.size?E/k*a.size:G.px2pt(E),xoffset:a.xoffset,yoffset:a.yoffset};c.destroy();return a}},_convertSvgRenderer:function(a){"simple"===a.type&&a.symbol&&(a.symbol.path||"image/svg+xml"===a.symbol.contentType)?a.symbol=this._convertSvgSymbol(a.symbol):"uniqueValue"===
a.type?(a.defaultSymbol&&(a.defaultSymbol.path||"image/svg+xml"===a.defaultSymbol.contentType)&&(a.defaultSymbol=this._convertSvgSymbol(a.defaultSymbol)),a.uniqueValueInfos&&n.forEach(a.uniqueValueInfos,function(a){if(a.symbol.path||"image/svg+xml"===a.symbol.contentType)a.symbol=this._convertSvgSymbol(a.symbol)},this)):"classBreaks"===a.type&&(a.defaultSymbol&&(a.defaultSymbol.path||"image/svg+xml"===a.defaultSymbol.contentType)&&(a.defaultSymbol=this._convertSvgSymbol(a.defaultSymbol)),a.classBreakInfos&&
n.forEach(a.classBreakInfos,function(a){if(a.symbol.path||"image/svg+xml"===a.symbol.contentType)a.symbol=this._convertSvgSymbol(a.symbol)},this))},_createFeatureCollection:function(b,c,k,e){var h=this._createPolygonLayer(),q=this._createPolylineLayer(),g=this._createPointLayer(),d=this._createMultipointLayer(),m=this._createPointLayer();m.layerDefinition.name="textLayer";delete m.layerDefinition.drawingInfo;if("esri.layers.FeatureLayer"===b.declaredClass||"esri.layers.StreamLayer"===b.declaredClass)h.layerDefinition.name=
q.layerDefinition.name=g.layerDefinition.name=d.layerDefinition.name=l.getObject("arcgisProps.title",!1,b)||b.name||b.id;var r=b.renderer&&"esri.renderer.SimpleRenderer"===b.renderer.declaredClass;if(!b.renderer||b.renderer.valueExpression||l.isFunction(b.renderer.attributeField))delete h.layerDefinition.drawingInfo,delete q.layerDefinition.drawingInfo,delete g.layerDefinition.drawingInfo,delete d.layerDefinition.drawingInfo;else{var f=b.renderer.toJson({useLegacyRotationProperties:!0});if("temporal"===
f.type){var f={latestObservationRenderer:f.latestObservationRenderer,trackLinesRenderer:f.trackRenderer,observationAger:f.observationAger,renderer:f.observationRenderer},v={};b._trackIdField&&(v.trackIdField=b._trackIdField);b._startTimeField&&(v.startTimeField=b._startTimeField);b._endTimeField&&(v.endTimeField=b._endTimeField);h.layerDefinition.drawingInfo=f;h.layerDefinition.timeInfo=v;q.layerDefinition.drawingInfo=f;q.layerDefinition.timeInfo=v;g.layerDefinition.drawingInfo=f;g.layerDefinition.timeInfo=
v;d.layerDefinition.drawingInfo=f;d.layerDefinition.timeInfo=v}else h.layerDefinition.drawingInfo.renderer=f,q.layerDefinition.drawingInfo.renderer=f,g.layerDefinition.drawingInfo.renderer=f,d.layerDefinition.drawingInfo.renderer=f}f=b.fields;f||!b.renderer||b.renderer.valueExpression||l.isFunction(b.renderer.attributeField)||("esri.renderer.ClassBreaksRenderer"===b.renderer.declaredClass?(f=[{name:b.renderer.attributeField,type:"esriFieldTypeDouble"}],b.renderer.normalizationField&&f.push({name:b.renderer.normalizationField,
type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===b.renderer.declaredClass&&(f=[{name:b.renderer.attributeField,type:"esriFieldTypeString"}],b.renderer.attributeField2&&f.push({name:b.renderer.attributeField2,type:"esriFieldTypeString"}),b.renderer.attributeField3&&f.push({name:b.renderer.attributeField3,type:"esriFieldTypeString"})));f&&(h.layerDefinition.fields=f,q.layerDefinition.fields=f,g.layerDefinition.fields=f,d.layerDefinition.fields=f);f=b.graphics;b.isFeatureReductionActive&&
b.isFeatureReductionActive()&&(f=b.getSingleGraphics());var v=f.length,w,E;for(E=0;E<v;E++){var t=f[E];if(!1!==t.visible&&t.geometry){w=t.toJson();w.symbol&&w.symbol.outline&&w.symbol.outline.color&&w.symbol.outline.color[3]&&!this._is11xService&&(w.symbol.outline.color[3]=255);if(b.renderer&&!w.symbol&&(l.isFunction(b.renderer.attributeField)||b.renderer.valueExpression||this._isFeatureCollectionRequired(b.renderer,b)||"esri.renderer.DotDensityRenderer"===b.renderer.declaredClass||k)){k=k||b.renderer;
var C=null;try{C=k.getSymbol(t)}catch(Q){}if(!C)continue;w.symbol=C.toJson();this._isFeatureCollectionRequired(k,b)&&this._applyVisualVariables(w.symbol,{renderer:k,graphic:t,symbol:C,mapResolution:c&&c.getResolutionInMeters(),mapScale:c&&c.getScale()})}w.symbol&&(w.symbol.path||"image/svg+xml"===w.symbol.contentType?w.symbol=this._convertSvgSymbol(w.symbol):w.symbol.text&&delete w.attributes);switch(t.geometry.type){case "polygon":h.featureSet.features.push(w);break;case "polyline":q.featureSet.features.push(w);
break;case "point":w.symbol&&w.symbol.text?m.featureSet.features.push(w):g.featureSet.features.push(w);break;case "multipoint":d.featureSet.features.push(w);break;case "extent":w.geometry=a.fromExtent(t.geometry).toJson(),h.featureSet.features.push(w)}}}c=[];0<h.featureSet.features.length&&c.push(h);0<q.featureSet.features.length&&c.push(q);0<d.featureSet.features.length&&c.push(d);0<g.featureSet.features.length&&c.push(g);0<m.featureSet.features.length&&c.push(m);if(!c.length)return null;n.forEach(c,
function(f){var a=n.every(f.featureSet.features,function(f){return f.symbol});if(r||a)e&&e.forceFeatureAttributes||n.forEach(f.featureSet.features,function(f){delete f.attributes}),delete f.layerDefinition.fields;a&&delete f.layerDefinition.drawingInfo});n.forEach(c,function(f){f.layerDefinition.drawingInfo&&f.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(f.layerDefinition.drawingInfo.renderer)},this);return{id:b.id,opacity:b.opacity,minScale:b.minScale||0,maxScale:b.maxScale||0,
featureCollection:{layers:c}}},_getPrintDefinition:function(a,b){var c={operationalLayers:this._createOperationalLayers(a,b)},e=this._vtlExtent||a.extent,k=a.spatialReference;this._vtlExtent=null;a.spatialReference._isWrappable()&&(e=e._normalize(!0),k=e.spatialReference);e={mapOptions:{showAttribution:a.showAttribution,extent:e.toJson(),spatialReference:k.toJson()}};b.preserveScale&&l.mixin(e.mapOptions,{scale:b.outScale||a.getScale()});a.timeExtent&&l.mixin(e.mapOptions,{time:[a.timeExtent.startTime.getTime(),
a.timeExtent.endTime.getTime()]});a={};l.mixin(a,e,c);return a},_createOperationalLayers:function(a,b){var k,e,g,q,d=[],m=0;b.preserveScale&&(m=b.outScale||a.getScale());this.allLayerslegend=this.legendAll?[]:null;this._vtlExtent=null;var y=n.map(a.layerIds,a.getLayer,a);a._mapImageLyr&&y.push(a._mapImageLyr);for(k=0;k<y.length;k++)if(e=y[k],e.loaded&&e.visible&&(!m||e.isVisibleAtScale(m)))switch(g=e.declaredClass,q={id:e.id,title:l.getObject("arcgisProps.title",!1,e)||e.id,opacity:e.opacity,minScale:e.minScale||
0,maxScale:e.maxScale||0},q=l.mixin(q,this._getUrlAndToken(e)),e.getNode()&&D.get(e.getNode(),"data-reference")&&(q._isRefLayer=!0),g){case "esri.layers.ArcGISDynamicMapServiceLayer":var r=[];g=!!e._params.layers;if(e._params.dynamicLayers)g=u.fromJson(e._params.dynamicLayers),n.forEach(g,function(f){r.push({id:f.id,name:f.name,layerDefinition:f});delete f.id;delete f.name;delete f.maxScale;delete f.minScale}),0===r.length&&(q.visibleLayers=[-1]);else if(e.supportsDynamicLayers){if(g||e.layerDefinitions||
e.layerTimeOptions){var f=e.createDynamicLayerInfosFromLayerInfos(),v=null;g&&(v=e.visibleLayers);var v=c._getVisibleLayers(f,v),w=c._getLayersForScale(b.outScale||a.getScale(),f);n.forEach(f,function(f){if(!f.subLayerIds){var a=f.id;-1<n.indexOf(v,a)&&-1<n.indexOf(w,a)&&(f={source:f.source.toJson()},e.layerDefinitions&&e.layerDefinitions[a]&&(f.definitionExpression=e.layerDefinitions[a]),e.layerTimeOptions&&e.layerTimeOptions[a]&&(f.layerTimeOptions=e.layerTimeOptions[a].toJson()),r.push({id:a,layerDefinition:f}))}});
0===r.length&&(q.visibleLayers=[-1])}}else n.forEach(e.layerInfos,function(f){var a={id:f.id,layerDefinition:{}};e.layerDefinitions&&e.layerDefinitions[f.id]&&(a.layerDefinition.definitionExpression=e.layerDefinitions[f.id]);e.layerTimeOptions&&e.layerTimeOptions[f.id]&&(a.layerDefinition.layerTimeOptions=e.layerTimeOptions[f.id].toJson());(a.layerDefinition.definitionExpression||a.layerDefinition.layerTimeOptions)&&r.push(a)}),g&&(q.visibleLayers=e.visibleLayers.length?e.visibleLayers:[-1]);r.length&&
(q.layers=r);d.push(q);this.allLayerslegend&&this.allLayerslegend.push({id:e.id,subLayerIds:e.visibleLayers});break;case "esri.layers.ArcGISImageServiceLayer":q=l.mixin(q,{url:e.url,bandIds:e.bandIds,compressionQuality:e.compressionQuality,format:e.format,interpolation:e.interpolation});e.mosaicRule&&l.mixin(q,{mosaicRule:e.mosaicRule.toJson()});(e.renderingRule||e.renderer)&&(g=e.getExportImageRenderingRule())&&l.mixin(q,{renderingRule:g.toJson()});d.push(q);this.allLayerslegend&&this.allLayerslegend.push({id:e.id});
break;case "esri.layers.WMSLayer":q=l.mixin(q,{url:e.url,title:e.title,type:"wms",version:e.version,transparentBackground:e.imageTransparency,visibleLayers:e.visibleLayers});d.push(q);this.allLayerslegend&&this.allLayerslegend.push({id:e.id,subLayerIds:e.visibleLayers});break;case "esri.virtualearth.VETiledLayer":g=e.mapStyle;"roadOnDemand"===g?g="Road":"aerialWithLabelsOnDemand"===g&&(g="Hybrid");q=l.mixin(q,{visibility:e.visible,type:"BingMaps"+g,culture:e.culture,key:e.bingMapsKey});d.push(q);
break;case "esri.layers.OpenStreetMapLayer":q=l.mixin(q,{credits:e.copyright,type:"OpenStreetMap",url:t.getAbsoluteUrl(e.tileServers[0])});d.push(q);break;case "esri.layers.WMTSLayer":q=l.mixin(q,{url:e.url,type:"wmts",layer:e._identifier,style:e._style,format:e.format,tileMatrixSet:e._tileMatrixSetId});d.push(q);break;case "esri.layers.MapImageLayer":g=e.getImages();n.forEach(g,function(f,a){f.visible&&f.href&&(q={id:e.id+"_image"+a,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||
0,opacity:e.opacity*f.opacity,extent:f.extent.toJson()},"data:image/png;base64,"===f.href.substr(0,22)?q.imageData=f.href.substr(22):q.url=f.href,d.push(q))});break;case "esri.layers.VectorTileLayer":delete q.url;delete q.token;if(this._is11xService&&e.currentStyleInfo.serviceUrl&&e.currentStyleInfo.styleUrl&&(g=h.id&&h.id.findCredential(e.currentStyleInfo.styleUrl),f=h.id&&h.id.findCredential(e.currentStyleInfo.serviceUrl),!g&&!f||"2.1.0"!==this._cimVersion)){q.type="VectorTileLayer";q.styleUrl=
e.currentStyleInfo.styleUrl;g&&(q.token=g.token);f&&f.token!==q.token&&(q.additionalTokens=[{url:e.currentStyleInfo.serviceUrl,token:f.token}]);d.push(q);break}q.type="image";g=this._vtlExtent||a.extent.offset(0,0);var A=b.exportOptions&&b.exportOptions.dpi||96,f={format:"png",pixelRatio:A/96};"MAP_ONLY"!==b.layout||!b.preserveScale||b.outScale&&b.outScale!==a.getScale()||96!==A||!b.exportOptions||b.exportOptions.width%2===a.width%2&&b.exportOptions.height%2===a.height%2||(f.area={x:0,y:0,width:a.width,
height:a.height},b.exportOptions.width%2!==a.width%2&&--f.area.width,b.exportOptions.height%2!==a.height%2&&--f.area.height,this._vtlExtent||(A=a.toMap({x:f.area.width,y:f.area.height}),g.update(g.xmin,A.y,A.x,g.ymax,g.spatialReference),this._vtlExtent=g));q.extent=g._normalize(!0).toJson();g=e.takeScreenshot(f);g.isResolved()?g.then(function(f){"data:image/png;base64,"===f.dataURL.substr(0,22)&&(q.imageData=f.dataURL.substr(22))}):console.error("PrintTask: VectorTileLayer.takeScreenshot() returned an unresolved Promise");
q.imageData&&d.push(q);break;case "esri.layers.WebTiledLayer":g=e.url.replace(/\$\{/g,"{");q=l.mixin(q,{type:"WebTiledLayer",urlTemplate:g,credits:e.copyright});e.subDomains&&0<e.subDomains.length&&(q.subDomains=e.subDomains);e._wmtsInfo&&(q.wmtsInfo=e._wmtsInfo);delete q.url;d.push(q);break;default:if(e.getTileUrl||e.getImageUrl)q=l.mixin(q,{url:e.url}),d.push(q)}y=n.map(a.graphicsLayerIds,a.getLayer,a);for(k=0;k<y.length;k++)e=y[k],e.isFeatureReductionActive&&e.isFeatureReductionActive()&&(e.getSingleGraphics().length?
y.splice(++k,0,e.getFeatureReductionLayer()):y[k]=e.getFeatureReductionLayer());for(k=0;k<y.length;k++)if(e=y[k],e.loaded&&e.visible&&(!m||e.isVisibleAtScale(m)))switch(g=e.declaredClass,g){case "esri.layers.CSVLayer":if(this._is11xService){q={id:e.id,url:e.url,title:e.title,opacity:e.opacity,minScale:e.minScale||0,maxScale:e.maxScale||0,type:"CSV",locationInfo:{latitudeFieldName:e.latitudeFieldName,longitudeFieldName:e.longitudeFieldName},layerDefinition:{drawingInfo:{renderer:e.renderer&&e.renderer.toJson({useLegacyRotationProperties:!0})}}};
d.push(q);break}case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.StreamLayer":if("esri.layers.LabelLayer"===g&&!b.showLabels||e.renderer&&"esri.renderer.HeatmapRenderer"===e.renderer.declaredClass)continue;g=null;e.url&&e.renderer&&("esri.renderer.ScaleDependentRenderer"===e.renderer.declaredClass?"scale"===e.renderer.rangeType?g=e.renderer.getRendererInfoByScale(a.getScale())&&e.renderer.getRendererInfoByScale(a.getScale()).renderer:"zoom"===e.renderer.rangeType&&(g=
e.renderer.getRendererInfoByZoom(a.getZoom())&&e.renderer.getRendererInfoByZoom(a.getZoom()).renderer):g=e.renderer);f=g&&"esri.layers.CSVLayer"!==e.declaredClass&&!this._isFeatureCollectionRequired(g,e)&&!g.valueExpression&&"esri.renderer.DotDensityRenderer"!==g.declaredClass;A=e.isFeatureReductionActive&&e.isFeatureReductionActive();if(g&&!A&&"esri.layers.StreamLayer"!==e.declaredClass&&(this._is11xService||f)&&("esri.renderer.SimpleRenderer"===g.declaredClass||"esri.renderer.TemporalRenderer"===
g.declaredClass||null==g.attributeField||l.isString(g.attributeField)&&e._getField(g.attributeField,!0)))if(q={id:e.id,title:l.getObject("arcgisProps.title",!1,e)||e.id,opacity:e.opacity,minScale:e.minScale||0,maxScale:e.maxScale||0,layerDefinition:{drawingInfo:{renderer:g.toJson({useLegacyRotationProperties:!0})}}},q=l.mixin(q,this._getUrlAndToken(e)),"esri.renderer.TemporalRenderer"===g.declaredClass&&(f=q.layerDefinition.drawingInfo,f.latestObservationRenderer=f.renderer.latestObservationRenderer,
f.trackLinesRenderer=f.renderer.trackRenderer,f.observationAger=f.renderer.observationAger,f.renderer=f.renderer.observationRenderer,e._trackIdField&&(q.layerDefinition.timeInfo={trackIdField:e._trackIdField})),this._convertSvgRenderer(q.layerDefinition.drawingInfo.renderer),this._is11xService||1>e.opacity||"esri.renderer.TemporalRenderer"===g.declaredClass||this._updateLayerOpacity(q))if(e._params.source&&(g=e._params.source.toJson(),l.mixin(q.layerDefinition,{source:g})),e.getDefinitionExpression()&&
l.mixin(q.layerDefinition,{definitionExpression:e.getDefinitionExpression()}),2!==e.mode)0<e.getSelectedFeatures().length&&(g=n.map(e.getSelectedFeatures(),function(f){return f.attributes[e.objectIdField]}),0<g.length&&e.getSelectionSymbol()&&l.mixin(q,{selectionObjectIds:g,selectionSymbol:e.getSelectionSymbol().toJson()}));else{g=n.map(e.getSelectedFeatures(),function(f){return f.attributes[e.objectIdField]});if(0===g.length||!e._params.drawMode)break;l.mixin(q.layerDefinition,{objectIds:g});g=null;
e.getSelectionSymbol()&&(g=new C(e.getSelectionSymbol()));l.mixin(q.layerDefinition.drawingInfo,{renderer:g&&g.toJson()})}else q=this._createFeatureCollection(e,a,null,b);else q=g&&(g.valueExpression||this._isFeatureCollectionRequired(g,e)||"esri.renderer.DotDensityRenderer"===g.declaredClass)?this._createFeatureCollection(e,a,g,b):this._createFeatureCollection(e,a,null,b);if(!q)continue;d.push(q);this.allLayerslegend&&this.allLayerslegend.push({id:e.id});break;case "esri.layers._GraphicsLayer":case "esri.layers.GraphicsLayer":case "esri.layers.WFSLayer":q=
this._createFeatureCollection(e,a,null,b);if(!q)continue;d.push(q);this.allLayerslegend&&this.allLayerslegend.push({id:e.id});break;case "esri.layers.ArcGISImageServiceVectorLayer":q={id:e.id,title:l.getObject("arcgisProps.title",!1,e)||e.id,opacity:e.opacity,minScale:e.minScale||0,maxScale:e.maxScale||0,visibility:e.visible,symbolTileSize:e.symbolTileSize,layerDefinition:{drawingInfo:{renderer:e.renderer.toJson({useLegacyRotationProperties:!0})}}},q=l.mixin(q,this._getUrlAndToken(e)),e.mosaicRule&&
l.mixin(q,{mosaicRule:e.mosaicRule.toJson()}),d.push(q),this.allLayerslegend&&this.allLayerslegend.push({id:e.id})}m&&n.forEach(d,function(f){f.minScale=0;f.maxScale=0});a.graphics&&0<a.graphics.graphics.length&&(q=this._createFeatureCollection(a.graphics,a,null,b))&&d.push(q);a._labels&&b.showLabels&&(q=this._createFeatureCollection(a._labels,a,null,b))&&d.push(q);n.forEach(d,function(f,a,r){f._isRefLayer&&(delete f._isRefLayer,r.splice(a,1),r.push(f))});return d},_getUrlAndToken:function(a){return{token:a._getToken(),
url:a._url?a._url.path:null}},_updateLayerOpacity:function(a){var b=this._colorEvaluator(a),b=n.filter(b,function(a){return l.isArray(a)&&4===a.length}),c=!0;if(b.length){var e=b[0][3],g;for(g=1;g<b.length;g++)if(e!==b[g][3]){c=!1;break}if(c)for(a.opacity=e/255,g=0;g<b.length;g++)b[g][3]=255}return c},_isFeatureCollectionRequired:function(a,b){if(b&&b.isFeatureReductionActive&&b.isFeatureReductionActive())return!0;var c=!1;if(b=this._getVariable(a,"rotationInfo",!1))c=(c=b.field)&&l.isFunction(c)||
b.valueExpression;return a.hasVisualVariables("sizeInfo")||a.hasVisualVariables("colorInfo")||a.hasVisualVariables("opacityInfo")||c},_getVariable:function(a,b,c){var e;a&&(e=(a=a.getVisualVariablesForType(b,c))&&a[0]);return e},_applyVisualVariables:function(a,b){var c=b.renderer,e=b.graphic,g=b.symbol,k=b.mapResolution,h=b.mapScale,d=g.type;if("textsymbol"!==d&&"shieldlabelsymbol"!==d){var m=this._getVariable(c,"sizeInfo",!1),r=this._getVariable(c,"colorInfo",!1),f=this._getVariable(c,"opacityInfo",
!1);b=this._getVariable(c,"rotationInfo",!1);g instanceof A&&(m=this._getVariable(c,"sizeInfo","outline")||m);k=m?c.getSize(e,{sizeInfo:m,shape:"simplemarkersymbol"===d?g.style:null,resolution:k,scale:h}):e.size;null!=k&&("simplemarkersymbol"===d?a.size=G.px2pt(k):"picturemarkersymbol"===d?(h=g.width/g.height*k,a.width=G.px2pt(h),a.height=G.px2pt(k),0!==g.xoffset&&(a.xoffset=G.px2pt(g.xoffset/g.width*h)),0!==g.yoffset&&(a.yoffset=G.px2pt(g.yoffset/g.height*k))):"simplelinesymbol"===d?a.width=G.px2pt(k):
a.outline&&(a.outline.width=G.px2pt(k)));r&&(!(g=c.getColor(e,{colorInfo:r}))||"simplemarkersymbol"!==d&&"simplelinesymbol"!==d&&"simplefillsymbol"!==d||(a.color=y.toJsonColor(g)));f&&(g=c.getOpacity(e,{opacityInfo:f}),null!=g&&a.color&&(a.color[3]=Math.round(255*g)));b&&(c=c.getRotationAngle(e,{rotationInfo:b}))&&(a.angle=-c)}}});m("extend-esri")&&l.setObject("tasks.PrintTask",d,h);return d})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(d,l,n,u,x,m,h,g,c,b,y,k,t,a,C,A,B,z,H,D,F,G,I){d=d(k,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(a){this._jobUpdateHandler=l.hitch(this,this._jobUpdateHandler);this._getJobStatus=l.hitch(this,this._getJobStatus);this._getResultDataHandler=
l.hitch(this,this._getResultDataHandler);this._getResultImageHandler=l.hitch(this,this._getResultImageHandler);this._executeHandler=l.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(a){this.updateDelay=a},setProcessSpatialReference:function(a){this.processSpatialReference=a},setOutputSpatialReference:function(a){this._setOutSR(a)},setOutSpatialReference:function(a){this._setOutSR(a)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(a){this.outSpatialReference=this.outputSpatialReference=a},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(a,b,c){for(var g in a){var e=a[g];l.isArray(e)?a[g]=x.toJson(n.map(e,function(a){return this._gpEncode({item:a},!0).item},this)):e instanceof Date&&(a[g]=e.getTime())}return this._encode(a,b,c)},_decode:function(a){var b=a.dataType,
c=new D(a);if(-1!==n.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],b))return c;if("GPLinearUnit"===b)c.value=new A(c.value);else if("GPFeatureRecordSetLayer"===b||"GPRecordSet"===b)c.value=new t(c.value);else if("GPDataFile"===b)c.value=new B(c.value);else if("GPDate"===b)a=c.value,l.isString(a)?c.value=new H({date:a}):c.value=new Date(a);else if("GPRasterData"===b||"GPRasterDataLayer"===b)a=a.value.mapImage,c.value=a?new I(a):new z(c.value);else if(-1!==b.indexOf("GPMultiValue:")){var g=b.split(":")[1];
a=c.value;c.value=n.map(a,function(a){return this._decode({paramName:"_name",dataType:g,value:a}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+c.dataType),c=null;return c},submitJob:function(a,b,g,k,e){var d=this._getOutSR(),h=e.assembly;a=this._gpEncode(l.mixin({},this._url.query,{f:"json","env:outSR":d?d.wkid||x.toJson(d.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||x.toJson(this.processSpatialReference.toJson()):
null},a),null,h&&h[0]);var m=this._jobUpdateHandler,t=this._errorHandler;return c({url:this._url.path+"/submitJob",content:a,callbackParamName:"callback",load:function(a,r){m(a,r,!1,b,g,e.dfd)},error:function(a){t(a,k,e.dfd)}})},_jobUpdateHandler:function(b,c,g,k,e,d){var h=b.jobId;c=new a(b);this._successHandler([c],"onStatusUpdate",e,g&&d);if(!g)switch(clearTimeout(this._updateTimers[h]),this._updateTimers[h]=null,d&&d.progress(c),b.jobStatus){case a.STATUS_SUBMITTED:case a.STATUS_EXECUTING:case a.STATUS_WAITING:case a.STATUS_NEW:var m=
this._getJobStatus;this._updateTimers[h]=setTimeout(function(){m(h,g,k,e,d)},this.updateDelay);break;default:this._successHandler([c],"onJobComplete",k,d)}},_getJobStatus:function(a,b,g,k,e){var d=this._jobUpdateHandler;c({url:this._url.path+"/jobs/"+a,content:l.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,c){d(a,c,b,g,k,e)},error:this._errorHandler})},_getResultDataHandler:function(a,b,c,g,e){try{var k=this._decode(a);this._successHandler([k],"onGetResultDataComplete",
c,e)}catch(q){this._errorHandler(q,g,e)}},getResultData:function(a,g,k,d){var e=this._getResultDataHandler,h=this._errorHandler,m=new u(b._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/jobs/"+a+"/results/"+g,content:l.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(a,b){e(a,b,k,d,m)},error:function(a){h(a,d,m)}});return m},checkJobStatus:function(a,g,k){var d=this._jobUpdateHandler,e=this._errorHandler,h=new u(b._dfdCanceller);h._pendingDfd=
c({url:this._url.path+"/jobs/"+a,content:l.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,b){d(a,b,!0,null,g,h)},error:function(a){e(a,k,h)}});return h},cancelJob:function(a,g,k){var d=this._errorHandler,e=new u(b._dfdCanceller);e._pendingDfd=c({url:this._url.path+"/jobs/"+a+"/cancel",content:l.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:l.hitch(this,function(a,b){this._successHandler([a],"onJobCancel",g,e)}),error:function(a){d(a,k,e)}});
return e},execute:function(a,b,g,k){var e=this._getOutSR(),d=k.assembly;a=this._gpEncode(l.mixin({},this._url.query,{f:"json","env:outSR":e?e.wkid||x.toJson(e.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||x.toJson(this.processSpatialReference.toJson()):null},a),null,d&&d[0]);var h=this._executeHandler,m=this._errorHandler;return c({url:this._url.path+"/execute",content:a,callbackParamName:"callback",load:function(a,e){h(a,e,b,g,k.dfd)},error:function(a){m(a,
g,k.dfd)}})},_executeHandler:function(a,b,c,g,e){try{var k=a.results,d,h,m=a.messages;d=0;for(h=k.length;d<h;d++)k[d]=this._decode(k[d]);d=0;for(h=m.length;d<h;d++)m[d]=new C(m[d]);this._successHandler([k,m],"onExecuteComplete",c,e)}catch(N){this._errorHandler(N,g,e)}},_getResultImageHandler:function(a,b,c,g,e){try{var k=this._decode(a);this._successHandler([k],"onGetResultImageComplete",c,e)}catch(q){this._errorHandler(q,g,e)}},getResultImage:function(a,g,k,d,e){var h=this._getResultImageHandler,
m=this._errorHandler;k=this._gpEncode(l.mixin({},this._url.query,{f:"json"},k.toJson()));var t=new u(b._dfdCanceller);t._pendingDfd=c({url:this._url.path+"/jobs/"+a+"/results/"+g,content:k,callbackParamName:"callback",load:function(a,b){h(a,b,d,e,t)},error:function(a){m(a,e,t)}});return t},cancelJobStatusUpdates:function(a){clearTimeout(this._updateTimers[a]);this._updateTimers[a]=null},getResultImageLayer:function(a,b,c,g){if(null==b){var e=this._url.path.indexOf("/GPServer/");a=this._url.path.substring(0,
e)+"/MapServer/jobs/"+a}else a=this._url.path+"/jobs/"+a+"/results/"+b;this._url.query&&(a+="?"+h.objectToQuery(this._url.query));b=null==b?new G(a,{imageParameters:c}):new F(a,{imageParameters:c},!0);this.onGetResultImageLayerComplete(b);g&&g(b);return b},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});y._createWrappers(d);
m("extend-esri")&&l.setObject("tasks.Geoprocessor",d,g);return d})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(d,l,n,u,x){d=d(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(d){this.messages=[];l.mixin(this,d);d=this.messages;var h,g=d.length;for(h=0;h<g;h++)d[h]=new x(d[h])},jobId:"",jobStatus:""});l.mixin(d,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",
STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});n("extend-esri")&&l.setObject("tasks.JobInfo",d,u);return d})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(d,l,n,u){d=d(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(d){l.mixin(this,
d)}});l.mixin(d,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});n("extend-esri")&&l.setObject("tasks.GPMessage",d,u);return d})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(d,l,n,u){d=d(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(d){d&&l.mixin(this,d)},distance:0,units:null,toJson:function(){var d={};this.distance&&(d.distance=this.distance);this.units&&(d.units=this.units);return d}});n("extend-esri")&&l.setObject("tasks.LinearUnit",d,u);return d})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(d,l,n,u){d=d(null,{declaredClass:"esri.tasks.DataFile",
constructor:function(d){d&&l.mixin(this,d)},url:null,itemID:null,toJson:function(){var d={};this.url&&(d.url=this.url);this.itemID&&(d.itemID=this.itemID);return d}});n("extend-esri")&&l.setObject("tasks.DataFile",d,u);return d})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(d,l,n,u){d=d(null,{declaredClass:"esri.tasks.RasterData",constructor:function(d){d&&l.mixin(this,d)},url:null,format:null,itemID:null,toJson:function(){var d=
{};this.url&&(d.url=this.url);this.format&&(d.format=this.format);this.itemID&&(d.itemID=this.itemID);return d}});n("extend-esri")&&l.setObject("tasks.RasterData",d,u);return d})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(d,l,n,u,x){d=d(null,{declaredClass:"esri.tasks.Date",constructor:function(d){d&&(d.format&&(this.format=d.format),this.date=n.parse(d.date,{selector:"date",datePattern:this.format}))},date:new Date,
format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:n.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});u("extend-esri")&&l.setObject("tasks.Date",d,x);return d})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(d,l,n,u){d=d(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(d){l.mixin(this,d)}});n("extend-esri")&&l.setObject("tasks.ParameterValue",d,u);return d})},
"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(d,l,n,u,x,m,h){d=d(h,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(g,c){c&&c.imageParameters&&c.imageParameters.extent&&(this.initialExtent=this.fullExtent=c.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=l.hitch(this,this.getImageUrl);
this.loaded=!0;this.onLoad(this)},getImageUrl:function(g,c,b,d){var k=g.spatialReference.wkid;d(this._url.path+"?"+x.objectToQuery(l.mixin(this._params,{f:"image",bbox:n.toJson(g.toJson()),bboxSR:k,imageSR:k,size:c+","+b})))}});u("extend-esri")&&l.setObject("tasks._GPResultImageLayer",d,m);return d})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(d,l,n,u){d=d(null,{declaredClass:"esri.tasks.PrintTemplate",label:null,exportOptions:{width:800,
height:1100,dpi:96},layoutOptions:null,format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,forceFeatureAttributes:!1,showAttribution:null,showLabels:!0});n("extend-esri")&&l.setObject("tasks.PrintTemplate",d,u);return d})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),function(d,l,n,u,x,m,h,g,c,b,y,k,t){function a(a,f,b,c,e,g,
d,k,h,m){var r,v,w=f.length,t=0;m?(v=m.l/e,t=m.i):v=f[0]/e;for(;g<d;)g+v>d&&(r={l:(g+v-d)*e,i:t},v=d-g),t%2||(a.beginPath(),a.arc(b,c,e,g,g+v,k),h&&a.stroke()),g+=v,++t,v=f[t%w]/e;return r}function C(a,f,b,g){var r=0,v=0,c,e=0;g?(c=g.l,e=g.i):c=f[0];for(;1>v;)v=t.tAtLength(a,c),1==v&&(r=t.computeLength(a),r={l:c-r,i:e}),a=t.splitBezierAtT(a,v),e%2||b.push(a[0]),a=a[1],++e,c=f[e%f.length];return r}function A(a,f,b,c){var r=[f.last.x,f.last.y].concat(b),v=!(a instanceof Array);b=4===b.length?"quadraticCurveTo":
"bezierCurveTo";var e=[];f=C(r,f.canvasDash,e,c);for(c=0;c<e.length;++c)r=e[c],v?(a.moveTo(r[0],r[1]),a[b].apply(a,r.slice(2))):(a.push("moveTo",[r[0],r[1]]),a.push(b,r.slice(2)));return f}function B(a,f,b,c,e,g,d){var r=0,v=0,k=0,h=t.distance(b,c,e,g),w=0;f=f.canvasDash;var m=b,C=c,y,q=!(a instanceof Array);d?(k=d.l,w=d.i):k+=f[0];for(;.01<Math.abs(1-v);)k>h&&(r={l:k-h,i:w},k=h),v=k/h,d=b+(e-b)*v,y=c+(g-c)*v,w++%2||(q?(a.moveTo(m,C),a.lineTo(d,y)):(a.push("moveTo",[m,C]),a.push("lineTo",[d,y]))),
m=d,C=y,k+=f[w%f.length];return r}var z=d.canvas={},H=null,D=y.multiplyPoint,F=Math.PI,G=2*F,I=F/2;k=l.extend;if(x.global.CanvasRenderingContext2D){x=x.doc.createElement("canvas").getContext("2d");var K="function"==typeof x.setLineDash,E="function"==typeof x.fillText}var L={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};z.Shape=u("dojox.gfx.canvas.Shape",
g.Shape,{_render:function(a){a.save();this._renderTransform(a);this._renderClip(a);this._renderShape(a);this._renderFill(a,!0);this._renderStroke(a,!0);a.restore()},_renderClip:function(a){this.canvasClip&&(this.canvasClip.render(a),a.clip())},_renderTransform:function(a){if("canvasTransform"in this){var f=this.canvasTransform;a.translate(f.dx,f.dy);a.rotate(f.angle2);a.scale(f.sx,f.sy);a.rotate(f.angle1)}},_renderShape:function(a){},_renderFill:function(a,f){if("canvasFill"in this){var b=this.fillStyle;
if("canvasFillImage"in this){var r=b.width,c=b.height,e=this.canvasFillImage.width,g=this.canvasFillImage.height,d=Math.min(r==e?1:r/e,c==g?1:c/g),k=(r-d*e)/2,h=(c-d*g)/2;H.width=r;H.height=c;var m=H.getContext("2d");m.clearRect(0,0,r,c);m.drawImage(this.canvasFillImage,0,0,e,g,k,h,d*e,d*g);this.canvasFill=a.createPattern(H,"repeat");delete this.canvasFillImage}a.fillStyle=this.canvasFill;f&&("pattern"!==b.type||0===b.x&&0===b.y||a.translate(b.x,b.y),a.fill())}else a.fillStyle="rgba(0,0,0,0.0)"},
_renderStroke:function(a,f){var b=this.strokeStyle;b?(a.strokeStyle=b.color.toString(),a.lineWidth=b.width,a.lineCap=b.cap,"number"==typeof b.join?(a.lineJoin="miter",a.miterLimit=b.join):a.lineJoin=b.join,this.canvasDash?K?(a.setLineDash(this.canvasDash),f&&a.stroke()):this._renderDashedStroke(a,f):f&&a.stroke()):f||(a.strokeStyle="rgba(0,0,0,0.0)")},_renderDashedStroke:function(a,f){},getEventSource:function(){return null},on:function(){},connect:function(){},disconnect:function(){},canvasClip:null,
setClip:function(a){this.inherited(arguments);var f=a?"width"in a?"rect":"cx"in a?"ellipse":"points"in a?"polyline":"d"in a?"path":null:null;if(a&&!f)return this;this.canvasClip=a?M(f,a):null;this.parent&&this.parent._makeDirty();return this}});var M=function(a,f){switch(a){case "ellipse":return{canvasEllipse:O({shape:f}),render:function(a){return z.Ellipse.prototype._renderShape.call(this,a)}};case "rect":return{shape:l.delegate(f,{r:0}),render:function(a){return z.Rect.prototype._renderShape.call(this,
a)}};case "path":return{canvasPath:e(f),render:function(a){this.canvasPath._renderShape(a)}};case "polyline":return{canvasPolyline:f.points,render:function(a){return z.Polyline.prototype._renderShape.call(this,a)}}}return null},e=function(a){var f=new dojox.gfx.canvas.Path;f.canvasPath=[];f._setPath(a.d);return f},J=function(a,f,b){var r=a.prototype[f];a.prototype[f]=b?function(){this.parent&&this.parent._makeDirty();r.apply(this,arguments);b.call(this);return this}:function(){this.parent&&this.parent._makeDirty();
return r.apply(this,arguments)}};J(z.Shape,"setTransform",function(){this.matrix?this.canvasTransform=d.decompose(this.matrix):delete this.canvasTransform});J(z.Shape,"setFill",function(){var a=this.fillStyle,f;if(a){if("object"==typeof a&&"type"in a){var b=this.surface.rawNode.getContext("2d");switch(a.type){case "linear":case "radial":f="linear"==a.type?b.createLinearGradient(a.x1,a.y1,a.x2,a.y2):b.createRadialGradient(a.cx,a.cy,0,a.cx,a.cy,a.r);n.forEach(a.colors,function(a){f.addColorStop(a.offset,
d.normalizeColor(a.color).toString())});break;case "pattern":H||(H=document.createElement("canvas")),b=new Image,this.surface.downloadImage(b,a.src),this.canvasFillImage=b}}else f=a.toString();this.canvasFill=f}else delete this.canvasFill});J(z.Shape,"setStroke",function(){var a=this.strokeStyle;if(a){var f=this.strokeStyle.style.toLowerCase();f in L&&(f=L[f]);if(f instanceof Array){this.canvasDash=f=f.slice();var b;for(b=0;b<f.length;++b)f[b]*=a.width;if("butt"!=a.cap){for(b=0;b<f.length;b+=2)f[b]-=
a.width,1>f[b]&&(f[b]=1);for(b=1;b<f.length;b+=2)f[b]+=a.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!K&&!!this.canvasDash});J(z.Shape,"setShape");z.Group=u("dojox.gfx.canvas.Group",z.Shape,{constructor:function(){g.Container._init.call(this)},_render:function(a){a.save();this._renderTransform(a);this._renderClip(a);for(var f=0;f<this.children.length;++f)this.children[f]._render(a);a.restore()},destroy:function(){g.Container.clear.call(this,!0);z.Shape.prototype.destroy.apply(this,
arguments)}});z.Rect=u("dojox.gfx.canvas.Rect",[z.Shape,g.Rect],{_renderShape:function(a){var f=this.shape,b=Math.min(f.r,f.height/2,f.width/2),c=f.x,e=c+f.width,g=f.y,f=g+f.height,r=c+b,d=e-b,k=g+b,h=f-b;a.beginPath();a.moveTo(r,g);b?(a.arc(d,k,b,-I,0,!1),a.arc(d,h,b,0,I,!1),a.arc(r,h,b,I,F,!1),a.arc(r,k,b,F,F+I,!1)):(a.lineTo(d,g),a.lineTo(e,h),a.lineTo(r,f),a.lineTo(c,k));a.closePath()},_renderDashedStroke:function(b,f){var c=this.shape,e=Math.min(c.r,c.height/2,c.width/2),g=c.x,r=g+c.width,d=
c.y,k=d+c.height,h=g+e,m=r-e,t=d+e,C=k-e;e?(b.beginPath(),c=B(b,this,h,d,m,d),f&&b.stroke(),c=a(b,this.canvasDash,m,t,e,-I,0,!1,f,c),b.beginPath(),c=B(b,this,r,t,r,C,c),f&&b.stroke(),c=a(b,this.canvasDash,m,C,e,0,I,!1,f,c),b.beginPath(),c=B(b,this,m,k,h,k,c),f&&b.stroke(),c=a(b,this.canvasDash,h,C,e,I,F,!1,f,c),b.beginPath(),c=B(b,this,g,C,g,t,c),f&&b.stroke(),a(b,this.canvasDash,h,t,e,F,F+I,!1,f,c)):(b.beginPath(),c=B(b,this,h,d,m,d),c=B(b,this,m,d,r,C,c),c=B(b,this,r,C,h,k,c),B(b,this,h,k,g,t,c),
f&&b.stroke())}});var q=[];(function(){var a=b.curvePI4;q.push(a.s,a.c1,a.c2,a.e);for(var f=45;360>f;f+=45){var c=y.rotateg(f);q.push(D(c,a.c1),D(c,a.c2),D(c,a.e))}})();var O=function(a){var f,b,c,e=[],g=a.shape,d=y.normalize([y.translate(g.cx,g.cy),y.scale(g.rx,g.ry)]);f=D(d,q[0]);e.push([f.x,f.y]);for(g=1;g<q.length;g+=3)b=D(d,q[g]),c=D(d,q[g+1]),f=D(d,q[g+2]),e.push([b.x,b.y,c.x,c.y,f.x,f.y]);if(a._needsDash){f=[];b=e[0];for(g=1;g<e.length;++g)c=[],C(b.concat(e[g]),a.canvasDash,c),b=[e[g][4],e[g][5]],
f.push(c);a._dashedPoints=f}return e};z.Ellipse=u("dojox.gfx.canvas.Ellipse",[z.Shape,g.Ellipse],{setShape:function(){this.inherited(arguments);this.canvasEllipse=O(this);return this},setStroke:function(){this.inherited(arguments);K||(this.canvasEllipse=O(this));return this},_renderShape:function(a){var f=this.canvasEllipse,b;a.beginPath();a.moveTo.apply(a,f[0]);for(b=1;b<f.length;++b)a.bezierCurveTo.apply(a,f[b]);a.closePath()},_renderDashedStroke:function(a,f){var b=this._dashedPoints;a.beginPath();
for(var c=0;c<b.length;++c)for(var g=b[c],e=0;e<g.length;++e){var d=g[e];a.moveTo(d[0],d[1]);a.bezierCurveTo(d[2],d[3],d[4],d[5],d[6],d[7])}f&&a.stroke()}});z.Circle=u("dojox.gfx.canvas.Circle",[z.Shape,g.Circle],{_renderShape:function(a){var f=this.shape;a.beginPath();a.arc(f.cx,f.cy,f.r,0,G,1)},_renderDashedStroke:function(a,f){var b=this.shape,c=0,e,g=this.canvasDash.length;for(i=0;c<G;)e=this.canvasDash[i%g]/b.r,i%2||(a.beginPath(),a.arc(b.cx,b.cy,b.r,c,c+e,0),f&&a.stroke()),c+=e,++i}});z.Line=
u("dojox.gfx.canvas.Line",[z.Shape,g.Line],{_renderShape:function(a){var f=this.shape;a.beginPath();a.moveTo(f.x1,f.y1);a.lineTo(f.x2,f.y2)},_renderDashedStroke:function(a,f){var b=this.shape;a.beginPath();B(a,this,b.x1,b.y1,b.x2,b.y2);f&&a.stroke()}});z.Polyline=u("dojox.gfx.canvas.Polyline",[z.Shape,g.Polyline],{setShape:function(){this.inherited(arguments);var a=this.shape.points,f=a[0],b,c;this.bbox=null;this._normalizePoints();if(a.length)if("number"==typeof f)f=a;else for(f=[],c=0;c<a.length;++c)b=
a[c],f.push(b.x,b.y);else f=[];this.canvasPolyline=f;return this},_renderShape:function(a){var f=this.canvasPolyline;if(f.length){a.beginPath();a.moveTo(f[0],f[1]);for(var b=2;b<f.length;b+=2)a.lineTo(f[b],f[b+1])}},_renderDashedStroke:function(a,f){var b=this.canvasPolyline,c=0;a.beginPath();for(var e=0;e<b.length;e+=2)c=B(a,this,b[e],b[e+1],b[e+2],b[e+3],c);f&&a.stroke()}});z.Image=u("dojox.gfx.canvas.Image",[z.Shape,g.Image],{setShape:function(){this.inherited(arguments);var a=new Image;this.surface.downloadImage(a,
this.shape.src);this.canvasImage=a;return this},_renderShape:function(a){var f=this.shape;a.drawImage(this.canvasImage,f.x,f.y,f.width,f.height)}});z.Text=u("dojox.gfx.canvas.Text",[z.Shape,g.Text],{_setFont:function(){this.fontStyle?this.canvasFont=d.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var a=this.shape,f=0,b;a.text&&(b=this.surface.rawNode.getContext("2d"),b.save(),this._renderTransform(b),this._renderFill(b,!1),this._renderStroke(b,!1),this.canvasFont&&
(b.font=this.canvasFont),f=b.measureText(a.text).width,b.restore());return f},_render:function(a){a.save();this._renderTransform(a);this._renderFill(a,!1);this._renderStroke(a,!1);this._renderShape(a);a.restore()},_renderShape:function(a){var f=this.shape;f.text&&(a.textAlign="middle"===f.align?"center":f.align,this.canvasFont&&(a.font=this.canvasFont),this.canvasFill&&a.fillText(f.text,f.x,f.y),this.strokeStyle&&(a.beginPath(),a.strokeText(f.text,f.x,f.y),a.closePath()))}});J(z.Text,"setFont");E||
z.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var P={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};z.Path=u("dojox.gfx.canvas.Path",[z.Shape,c.Path],{constructor:function(){this.lastControl=
{}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);K||(this.segmented=!1,this._confirmSegmented());return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(a){var f=l.clone(this.last);this[P[a.action]](this.canvasPath,a.action,a.args,this._needsDash?this._dashedPath:null);this.last=f;this.inherited(arguments)},_renderShape:function(a){var f=this.canvasPath;
a.beginPath();for(var b=0;b<f.length;b+=2)a[f[b]].apply(a,f[b+1])},_renderDashedStroke:K?function(){}:function(a,f){var b=this._dashedPath;a.beginPath();for(var c=0;c<b.length;c+=2)a[b[c]].apply(a,b[c+1]);f&&a.stroke()},_moveToA:function(a,f,b,c){a.push("moveTo",[b[0],b[1]]);c&&c.push("moveTo",[b[0],b[1]]);for(f=2;f<b.length;f+=2)a.push("lineTo",[b[f],b[f+1]]),c&&(this._dashResidue=B(c,this,b[f-2],b[f-1],b[f],b[f+1],this._dashResidue));this.last.x=b[b.length-2];this.last.y=b[b.length-1];this.lastControl=
{}},_moveToR:function(a,b,c,e){b="x"in this.last?[this.last.x+=c[0],this.last.y+=c[1]]:[this.last.x=c[0],this.last.y=c[1]];a.push("moveTo",b);e&&e.push("moveTo",b);for(b=2;b<c.length;b+=2)a.push("lineTo",[this.last.x+=c[b],this.last.y+=c[b+1]]),e&&(this._dashResidue=B(e,this,e[e.length-1][0],e[e.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(a,b,c,e){for(b=0;b<c.length;b+=2)e&&(this._dashResidue=B(e,this,this.last.x,this.last.y,c[b],c[b+1],this._dashResidue)),
a.push("lineTo",[c[b],c[b+1]]);this.last.x=c[c.length-2];this.last.y=c[c.length-1];this.lastControl={}},_lineToR:function(a,b,c,e){for(b=0;b<c.length;b+=2)a.push("lineTo",[this.last.x+=c[b],this.last.y+=c[b+1]]),e&&(this._dashResidue=B(e,this,e[e.length-1][0],e[e.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(a,b,c,e){for(b=0;b<c.length;++b)a.push("lineTo",[c[b],this.last.y]),e&&(this._dashResidue=B(e,this,e[e.length-1][0],e[e.length-1][1],c[b],this.last.y,
this._dashResidue));this.last.x=c[c.length-1];this.lastControl={}},_hLineToR:function(a,b,c,e){for(b=0;b<c.length;++b)a.push("lineTo",[this.last.x+=c[b],this.last.y]),e&&(this._dashResidue=B(e,this,e[e.length-1][0],e[e.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(a,b,c,e){for(b=0;b<c.length;++b)a.push("lineTo",[this.last.x,c[b]]),e&&(this._dashResidue=B(e,this,e[e.length-1][0],e[e.length-1][1],this.last.x,c[b],this._dashResidue));this.last.y=c[c.length-
1];this.lastControl={}},_vLineToR:function(a,b,c,e){for(b=0;b<c.length;++b)a.push("lineTo",[this.last.x,this.last.y+=c[b]]),e&&(this._dashResidue=B(e,this,e[e.length-1][0],e[e.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(a,b,c,e){for(b=0;b<c.length;b+=6)a.push("bezierCurveTo",c.slice(b,b+6)),e&&(this._dashResidue=A(e,this,a[a.length-1],this._dashResidue));this.last.x=c[c.length-2];this.last.y=c[c.length-1];this.lastControl.x=c[c.length-4];this.lastControl.y=
c[c.length-3];this.lastControl.type="C"},_curveToR:function(a,b,c,e){for(b=0;b<c.length;b+=6)a.push("bezierCurveTo",[this.last.x+c[b],this.last.y+c[b+1],this.lastControl.x=this.last.x+c[b+2],this.lastControl.y=this.last.y+c[b+3],this.last.x+c[b+4],this.last.y+c[b+5]]),e&&(this._dashResidue=A(e,this,a[a.length-1],this._dashResidue)),this.last.x+=c[b+4],this.last.y+=c[b+5];this.lastControl.type="C"},_smoothCurveToA:function(a,b,c,e){for(b=0;b<c.length;b+=4){var f="C"==this.lastControl.type;a.push("bezierCurveTo",
[f?2*this.last.x-this.lastControl.x:this.last.x,f?2*this.last.y-this.lastControl.y:this.last.y,c[b],c[b+1],c[b+2],c[b+3]]);e&&(this._dashResidue=A(e,this,a[a.length-1],this._dashResidue));this.lastControl.x=c[b];this.lastControl.y=c[b+1];this.lastControl.type="C"}this.last.x=c[c.length-2];this.last.y=c[c.length-1]},_smoothCurveToR:function(a,b,c,e){for(b=0;b<c.length;b+=4){var f="C"==this.lastControl.type;a.push("bezierCurveTo",[f?2*this.last.x-this.lastControl.x:this.last.x,f?2*this.last.y-this.lastControl.y:
this.last.y,this.last.x+c[b],this.last.y+c[b+1],this.last.x+c[b+2],this.last.y+c[b+3]]);e&&(this._dashResidue=A(e,this,a[a.length-1],this._dashResidue));this.lastControl.x=this.last.x+c[b];this.lastControl.y=this.last.y+c[b+1];this.lastControl.type="C";this.last.x+=c[b+2];this.last.y+=c[b+3]}},_qCurveToA:function(a,b,c,e){for(b=0;b<c.length;b+=4)a.push("quadraticCurveTo",c.slice(b,b+4));e&&(this._dashResidue=A(e,this,a[a.length-1],this._dashResidue));this.last.x=c[c.length-2];this.last.y=c[c.length-
1];this.lastControl.x=c[c.length-4];this.lastControl.y=c[c.length-3];this.lastControl.type="Q"},_qCurveToR:function(a,b,c,e){for(b=0;b<c.length;b+=4)a.push("quadraticCurveTo",[this.lastControl.x=this.last.x+c[b],this.lastControl.y=this.last.y+c[b+1],this.last.x+c[b+2],this.last.y+c[b+3]]),e&&(this._dashResidue=A(e,this,a[a.length-1],this._dashResidue)),this.last.x+=c[b+2],this.last.y+=c[b+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(a,b,c,e){for(b=0;b<c.length;b+=2){var f="Q"==this.lastControl.type;
a.push("quadraticCurveTo",[this.lastControl.x=f?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=f?2*this.last.y-this.lastControl.y:this.last.y,c[b],c[b+1]]);e&&(this._dashResidue=A(e,this,a[a.length-1],this._dashResidue));this.lastControl.type="Q"}this.last.x=c[c.length-2];this.last.y=c[c.length-1]},_qSmoothCurveToR:function(a,b,c,e){for(b=0;b<c.length;b+=2){var f="Q"==this.lastControl.type;a.push("quadraticCurveTo",[this.lastControl.x=f?2*this.last.x-this.lastControl.x:this.last.x,
this.lastControl.y=f?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+c[b],this.last.y+c[b+1]]);e&&(this._dashResidue=A(e,this,a[a.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=c[b];this.last.y+=c[b+1]}},_arcTo:function(a,c,e,g){c="a"==c;for(var f=0;f<e.length;f+=7){var d=e[f+5],k=e[f+6];c&&(d+=this.last.x,k+=this.last.y);var h=b.arcAsBezier(this.last,e[f],e[f+1],e[f+2],e[f+3]?1:0,e[f+4]?1:0,d,k);n.forEach(h,function(b){a.push("bezierCurveTo",b)});g&&(this._dashResidue=
A(g,this,p,this._dashResidue));this.last.x=d;this.last.y=k}this.lastControl={}},_closePath:function(a,b,c,e){a.push("closePath",[]);e&&(this._dashResidue=B(e,this,this.last.x,this.last.y,e[1][0],e[1][1],this._dashResidue));this.lastControl={}}});n.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),function(a){J(z.Path,a)});z.TextPath=u("dojox.gfx.canvas.TextPath",[z.Shape,c.TextPath],{_renderShape:function(a){},_setText:function(){},_setFont:function(){}});
z.Surface=u("dojox.gfx.canvas.Surface",g.Surface,{constructor:function(){g.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){g.Container.clear.call(this,!0);this.inherited(arguments)},setDimensions:function(a,b){this.width=d.normalizedLength(a);this.height=d.normalizedLength(b);if(!this.rawNode)return this;a=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,a=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,a=!0);a&&this.makeDirty();
return this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(a){!this.rawNode||!a&&this.pendingImageCount||(a=this.rawNode.getContext("2d"),a.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(a),"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender))},render:function(a){a.save();for(var b=0;b<this.children.length;++b)this.children[b]._render(a);a.restore()},makeDirty:function(){this.pendingImagesCount||
"pendingRender"in this||this._batch||(this.pendingRender=setTimeout(l.hitch(this,this._render),0))},downloadImage:function(a,b){var c=l.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);a.onload=c;a.onerror=c;a.onabort=c;a.src=b},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},
on:function(){}});z.createSurface=function(a,b,c){if(!b&&!c){var e=m.position(a);b=b||e.w;c=c||e.h}"number"==typeof b&&(b+="px");"number"==typeof c&&(c+="px");e=new z.Surface;a=h.byId(a);var f=a.ownerDocument.createElement("canvas");f.width=d.normalizedLength(b);f.height=d.normalizedLength(c);a.appendChild(f);e.rawNode=f;e._parent=a;return e.surface=e};var N=g.Container;u={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();
return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(a){this._makeDirty();return N.add.apply(this,arguments)},remove:function(a,b){this._makeDirty();return N.remove.apply(this,arguments)},clear:function(){this._makeDirty();return N.clear.apply(this,arguments)},getBoundingBox:N.getBoundingBox,_moveChildToFront:function(a){this._makeDirty();return N._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(a){this._makeDirty();return N._moveChildToBack.apply(this,
arguments)}};c={createObject:function(a,b){a=new a;a.surface=this.surface;a.setShape(b);this.add(a);return a}};k(z.Group,u);k(z.Group,g.Creator);k(z.Group,c);k(z.Surface,u);k(z.Surface,g.Creator);k(z.Surface,c);z.fixTarget=function(a,b){return!0};return z})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),function(d,l,n,u,x,m,h,g,c,b){function y(a,b){if(!k)return a.splice(b,
1);var c=a.length;if(c){for(;b<c;)a[b]=a[b+1],b++;a.length--}}var k=!!x("chrome"),t=d.shape={};t.Shape=n("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(x("gfxRegistry")){var a=t.register(this);this.getUID=function(){return a}}},destroy:function(){x("gfxRegistry")&&t.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},
getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var a=this.getBoundingBox();if(!a)return null;var c=this._getRealMatrix();return[b.multiplyPoint(c,a.x,a.y),b.multiplyPoint(c,a.x+a.width,a.y),b.multiplyPoint(c,a.x+a.width,
a.y+a.height),b.multiplyPoint(c,a.x,a.y+a.height)]},getEventSource:function(){return this.rawNode},setClip:function(a){this.clip=a},getClip:function(){return this.clip},setShape:function(a){this.shape=d.makeParameters(this.shape,a);this.bbox=null;return this},setFill:function(a){if(!a)return this.fillStyle=null,this;var b=null;if("object"==typeof a&&"type"in a)switch(a.type){case "linear":b=d.makeParameters(d.defaultLinearGradient,a);break;case "radial":b=d.makeParameters(d.defaultRadialGradient,
a);break;case "pattern":b=d.makeParameters(d.defaultPattern,a)}else b=d.normalizeColor(a);this.fillStyle=b;return this},setStroke:function(a){if(!a)return this.strokeStyle=null,this;if("string"==typeof a||l.isArray(a)||a instanceof c)a={color:a};a=this.strokeStyle=d.makeParameters(d.defaultStroke,a);a.color=d.normalizeColor(a.color);return this},setTransform:function(a){this.matrix=b.clone(a?b.normalize(a):b.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var a=
this.getParent();a&&(a._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var a=this.getParent();a&&(a._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(a){return a?this.setTransform([this.matrix,a]):this},applyLeftTransform:function(a){return a?this.setTransform([a,this.matrix]):this},applyTransform:function(a){return a?this.setTransform([this.matrix,a]):this},removeShape:function(a){this.parent&&
this.parent.remove(this,a);return this},_setParent:function(a,b){this.parent=a;return this._updateParentMatrix(b)},_updateParentMatrix:function(a){this.parentMatrix=a?b.clone(a):null;return this._applyTransform()},_getRealMatrix:function(){for(var a=this.matrix,c=this.parent;c;)c.matrix&&(a=b.multiply(c.matrix,a)),c=c.parent;return a}});t._eventsProcessing={on:function(a,b){return m(this.getEventSource(),a,t.fixCallback(this,d.fixTarget,b))},connect:function(a,b,c){"on"==a.substring(0,2)&&(a=a.substring(2));
return this.on(a,c?l.hitch(b,c):b)},disconnect:function(a){return a.remove()}};t.fixCallback=function(a,b,c,g){g||(g=c,c=null);if(l.isString(g)){c=c||u.global;if(!c[g])throw['dojox.gfx.shape.fixCallback: scope["',g,'"] is null (scope\x3d"',c,'")'].join("");return function(d){return b(d,a)?c[g].apply(c,arguments||[]):void 0}}return c?function(d){return b(d,a)?g.apply(c,arguments||[]):void 0}:function(d){return b(d,a)?g.apply(c,arguments):void 0}};l.extend(t.Shape,t._eventsProcessing);t.Container={_init:function(){this.children=
[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(a){var b=a.getParent();b&&b.remove(a,!0);this.children.push(a);return a._setParent(this,this._getRealMatrix())},remove:function(a,b){for(var c=0;c<this.children.length;++c)if(this.children[c]==a){b||(a.parent=null,a.parentMatrix=null);y(this.children,c);break}return this},clear:function(a){for(var b,c=0;c<this.children.length;++c)b=this.children[c],b.parent=null,b.parentMatrix=null,a&&b.destroy();this.children=
[];return this},getBoundingBox:function(){if(this.children){var a=null;h.forEach(this.children,function(c){var g=c.getBoundingBox();g&&((c=c.getTransform())&&(g=b.multiplyRectangle(c,g)),a?(a.x=Math.min(a.x,g.x),a.y=Math.min(a.y,g.y),a.endX=Math.max(a.endX,g.x+g.width),a.endY=Math.max(a.endY,g.y+g.height)):a={x:g.x,y:g.y,endX:g.x+g.width,endY:g.y+g.height})});a&&(a.width=a.endX-a.x,a.height=a.endY-a.y);return a}return null},_moveChildToFront:function(a){for(var b=0;b<this.children.length;++b)if(this.children[b]==
a){y(this.children,b);this.children.push(a);break}return this},_moveChildToBack:function(a){for(var b=0;b<this.children.length;++b)if(this.children[b]==a){y(this.children,b);this.children.unshift(a);break}return this}};t.Surface=n("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){h.forEach(this._nodes,g.destroy);this._nodes=[];h.forEach(this._events,function(a){a&&a.remove()});this._events=[];this.rawNode=null;
if(x("ie"))for(;this._parent.lastChild;)g.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(a){},whenLoaded:function(a,b){var c=l.hitch(a,b);if(this.isLoaded)c(this);else m.once(this,"load",function(a){c(a)})}});l.extend(t.Surface,t._eventsProcessing);t.Rect=n("dojox.gfx.shape.Rect",t.Shape,{constructor:function(a){this.shape=d.getDefault("Rect");this.rawNode=
a},getBoundingBox:function(){return this.shape}});t.Ellipse=n("dojox.gfx.shape.Ellipse",t.Shape,{constructor:function(a){this.shape=d.getDefault("Ellipse");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-a.rx,y:a.cy-a.ry,width:2*a.rx,height:2*a.ry}}return this.bbox}});t.Circle=n("dojox.gfx.shape.Circle",t.Shape,{constructor:function(a){this.shape=d.getDefault("Circle");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-
a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r}}return this.bbox}});t.Line=n("dojox.gfx.shape.Line",t.Shape,{constructor:function(a){this.shape=d.getDefault("Line");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:Math.min(a.x1,a.x2),y:Math.min(a.y1,a.y2),width:Math.abs(a.x2-a.x1),height:Math.abs(a.y2-a.y1)}}return this.bbox}});t.Polyline=n("dojox.gfx.shape.Polyline",t.Shape,{constructor:function(a){this.shape=d.getDefault("Polyline");this.rawNode=a},setShape:function(a,
b){a&&a instanceof Array?(this.inherited(arguments,[{points:a}]),b&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[a]);return this},_normalizePoints:function(){var a=this.shape.points,b=a&&a.length;if(b&&"number"==typeof a[0]){for(var c=[],g=0;g<b;g+=2)c.push({x:a[g],y:a[g+1]});this.shape.points=c}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var a=this.shape.points,b=a.length,c=a[0],g=c.x,d=c.y,k=c.x,h=c.y,m=1;m<b;++m)c=
a[m],g>c.x&&(g=c.x),k<c.x&&(k=c.x),d>c.y&&(d=c.y),h<c.y&&(h=c.y);this.bbox={x:g,y:d,width:k-g,height:h-d}}return this.bbox}});t.Image=n("dojox.gfx.shape.Image",t.Shape,{constructor:function(a){this.shape=d.getDefault("Image");this.rawNode=a},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});t.Text=n(t.Shape,{constructor:function(a){this.fontStyle=null;this.shape=d.getDefault("Text");this.rawNode=a},getFont:function(){return this.fontStyle},
setFont:function(a){this.fontStyle="string"==typeof a?d.splitFontString(a):d.makeParameters(d.defaultFont,a);this._setFont();return this},getBoundingBox:function(){var a=null;this.getShape().text&&(a=d._base._computeTextBoundingBox(this));return a}});t.Creator={createShape:function(a){switch(a.type){case d.defaultPath.type:return this.createPath(a);case d.defaultRect.type:return this.createRect(a);case d.defaultCircle.type:return this.createCircle(a);case d.defaultEllipse.type:return this.createEllipse(a);
case d.defaultLine.type:return this.createLine(a);case d.defaultPolyline.type:return this.createPolyline(a);case d.defaultImage.type:return this.createImage(a);case d.defaultText.type:return this.createText(a);case d.defaultTextPath.type:return this.createTextPath(a)}return null},createGroup:function(){return this.createObject(d.Group)},createRect:function(a){return this.createObject(d.Rect,a)},createEllipse:function(a){return this.createObject(d.Ellipse,a)},createCircle:function(a){return this.createObject(d.Circle,
a)},createLine:function(a){return this.createObject(d.Line,a)},createPolyline:function(a){return this.createObject(d.Polyline,a)},createImage:function(a){return this.createObject(d.Image,a)},createText:function(a){return this.createObject(d.Text,a)},createPath:function(a){return this.createObject(d.Path,a)},createTextPath:function(a){return this.createObject(d.TextPath,{}).setText(a)},createObject:function(a,b){return null}};return t})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang",
"dojo/_base/declare","./matrix","./shape"],function(d,l,n,u,x){x=n("dojox.gfx.path.Path",x.Shape,{constructor:function(m){this.shape=l.clone(d.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=m;this.segmented=!1},setAbsoluteMode:function(d){this._confirmSegmented();this.absolute="string"==typeof d?"absolute"==d:d;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&
"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var d=this.bbox,h=this._getRealMatrix();this.bbox=null;for(var g=0,c=this.segments.length;g<c;++g)this._updateWithSegment(this.segments[g],h);h=this.bbox;this.bbox=d;return this.tbbox=h?[{x:h.l,y:h.t},{x:h.r,y:h.t},{x:h.r,y:h.b},{x:h.l,y:h.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in
this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(d,h,g){g&&(h=u.multiplyPoint(g,d,h),d=h.x,h=h.y);this.bbox&&"l"in this.bbox?(this.bbox.l>d&&(this.bbox.l=d),this.bbox.r<d&&(this.bbox.r=d),this.bbox.t>h&&(this.bbox.t=h),this.bbox.b<h&&(this.bbox.b=h)):this.bbox={l:d,b:h,r:d,t:h}},_updateWithSegment:function(m,h){var g=m.args,c=g.length,b;switch(m.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(b=0;b<c;b+=2)this._updateBBox(g[b],
g[b+1],h);this.last.x=g[c-2];this.last.y=g[c-1];this.absolute=!0;break;case "H":for(b=0;b<c;++b)this._updateBBox(g[b],this.last.y,h);this.last.x=g[c-1];this.absolute=!0;break;case "V":for(b=0;b<c;++b)this._updateBBox(this.last.x,g[b],h);this.last.y=g[c-1];this.absolute=!0;break;case "m":b=0;"x"in this.last||(this._updateBBox(this.last.x=g[0],this.last.y=g[1],h),b=2);for(;b<c;b+=2)this._updateBBox(this.last.x+=g[b],this.last.y+=g[b+1],h);this.absolute=!1;break;case "l":case "t":for(b=0;b<c;b+=2)this._updateBBox(this.last.x+=
g[b],this.last.y+=g[b+1],h);this.absolute=!1;break;case "h":for(b=0;b<c;++b)this._updateBBox(this.last.x+=g[b],this.last.y,h);this.absolute=!1;break;case "v":for(b=0;b<c;++b)this._updateBBox(this.last.x,this.last.y+=g[b],h);this.absolute=!1;break;case "c":for(b=0;b<c;b+=6)this._updateBBox(this.last.x+g[b],this.last.y+g[b+1],h),this._updateBBox(this.last.x+g[b+2],this.last.y+g[b+3],h),this._updateBBox(this.last.x+=g[b+4],this.last.y+=g[b+5],h);this.absolute=!1;break;case "s":case "q":for(b=0;b<c;b+=
4)this._updateBBox(this.last.x+g[b],this.last.y+g[b+1],h),this._updateBBox(this.last.x+=g[b+2],this.last.y+=g[b+3],h);this.absolute=!1;break;case "A":for(b=0;b<c;b+=7)this._updateBBox(g[b+5],g[b+6],h);this.last.x=g[c-2];this.last.y=g[c-1];this.absolute=!0;break;case "a":for(b=0;b<c;b+=7)this._updateBBox(this.last.x+=g[b+5],this.last.y+=g[b+6],h);this.absolute=!1}m=[m.action];for(b=0;b<c;++b)m.push(d.formatNumber(g[b],!0));if("string"==typeof this.shape.path)this.shape.path+=m.join("");else for(b=
0,c=m.length;b<c;++b)this.shape.path.push(m[b])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(d,h){this.tbbox=null;var g=this._validSegments[d.toLowerCase()];"number"==typeof g&&(g?h.length>=g&&(d={action:d,args:h.slice(0,h.length-h.length%g)},this.segments.push(d),this._updateWithSegment(d)):(d={action:d,args:[]},this.segments.push(d),this._updateWithSegment(d)))},_collectArgs:function(d,h){for(var g=0;g<h.length;++g){var c=h[g];"boolean"==typeof c?d.push(c?1:0):
"number"==typeof c?d.push(c):c instanceof Array?this._collectArgs(d,c):"x"in c&&"y"in c&&d.push(c.x,c.y)}},moveTo:function(){this._confirmSegmented();var d=[];this._collectArgs(d,arguments);this._pushSegment(this.absolute?"M":"m",d);return this},lineTo:function(){this._confirmSegmented();var d=[];this._collectArgs(d,arguments);this._pushSegment(this.absolute?"L":"l",d);return this},hLineTo:function(){this._confirmSegmented();var d=[];this._collectArgs(d,arguments);this._pushSegment(this.absolute?
"H":"h",d);return this},vLineTo:function(){this._confirmSegmented();var d=[];this._collectArgs(d,arguments);this._pushSegment(this.absolute?"V":"v",d);return this},curveTo:function(){this._confirmSegmented();var d=[];this._collectArgs(d,arguments);this._pushSegment(this.absolute?"C":"c",d);return this},smoothCurveTo:function(){this._confirmSegmented();var d=[];this._collectArgs(d,arguments);this._pushSegment(this.absolute?"S":"s",d);return this},qCurveTo:function(){this._confirmSegmented();var d=
[];this._collectArgs(d,arguments);this._pushSegment(this.absolute?"Q":"q",d);return this},qSmoothCurveTo:function(){this._confirmSegmented();var d=[];this._collectArgs(d,arguments);this._pushSegment(this.absolute?"T":"t",d);return this},arcTo:function(){this._confirmSegmented();var d=[];this._collectArgs(d,arguments);this._pushSegment(this.absolute?"A":"a",d);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var d=
this.shape.path;this.shape.path=[];this._setPath(d);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(m){m=l.isArray(m)?m:m.match(d.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(m){for(var h="",g=[],c=m.length,b=0;b<c;++b){var y=m[b],k=parseFloat(y);isNaN(k)?(h&&this._pushSegment(h,g),g=[],h=y):g.push(k)}this._pushSegment(h,g)}},setShape:function(m){this.inherited(arguments,["string"==typeof m?{path:m}:m]);this.segmented=!1;this.segments=
[];d.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});n=n("dojox.gfx.path.TextPath",x,{constructor:function(m){"text"in this||(this.text=l.clone(d.defaultTextPath));"fontStyle"in this||(this.fontStyle=l.clone(d.defaultFont))},getText:function(){return this.text},setText:function(m){this.text=d.makeParameters(this.text,"string"==typeof m?{text:m}:m);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(m){this.fontStyle="string"==typeof m?
d.splitFontString(m):d.makeParameters(d.defaultFont,m);this._setFont();return this}});return d.path={Path:x,TextPath:n}})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(d,l,n){function u(b){var c=Math.cos(b);b=Math.sin(b);var g={x:c+4/3*(1-c),y:b-4/3*c*(1-c)/b};return{s:{x:c,y:-b},c1:{x:g.x,y:-g.y},c2:g,e:{x:c,y:b}}}var x=2*Math.PI,m=Math.PI/4,h=Math.PI/8,g=m+h,c=u(h);return d.arc={unitArcAsBezier:u,curvePI4:c,arcAsBezier:function(b,d,k,t,a,l,A,B){a=!!a;l=!!l;
var y=n._degToRad(t);t=d*d;var C=k*k,D=n.multiplyPoint(n.rotate(-y),{x:(b.x-A)/2,y:(b.y-B)/2}),F=D.x*D.x,G=D.y*D.y;t=Math.sqrt((t*C-t*G-C*F)/(t*G+C*F));isNaN(t)&&(t=0);t={x:t*d*D.y/k,y:-t*k*D.x/d};a==l&&(t={x:-t.x,y:-t.y});t=n.multiplyPoint([n.translate((b.x+A)/2,(b.y+B)/2),n.rotate(y)],t);d=n.normalize([n.translate(t.x,t.y),n.rotate(y),n.scale(d,k)]);t=n.invert(d);b=n.multiplyPoint(t,b);B=n.multiplyPoint(t,A,B);A=Math.atan2(b.y,b.x);t=A-Math.atan2(B.y,B.x);l&&(t=-t);0>t?t+=x:t>x&&(t-=x);k=h;B=c;
k=l?k:-k;b=[];for(a=t;0<a;a-=m)a<g&&(k=a/2,B=u(k),k=l?k:-k,a=0),D=n.normalize([d,n.rotate(A+k)]),l?(t=n.multiplyPoint(D,B.c1),y=n.multiplyPoint(D,B.c2),D=n.multiplyPoint(D,B.e)):(t=n.multiplyPoint(D,B.c2),y=n.multiplyPoint(D,B.c1),D=n.multiplyPoint(D,B.s)),b.push([t.x,t.y,y.x,y.y,D.x,D.y]),A+=2*k;return b}}})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(d,l,n){function u(c,b){return Math.abs(c-b)<=1E-6*(Math.abs(c)+Math.abs(b))}function x(c,b,g,d){if(!isFinite(c))return g;
if(!isFinite(g))return c;b=Math.abs(b);d=Math.abs(d);return(b*c+d*g)/(b+d)}function m(c){c=n.normalize(c);var b=-c.xx-c.yy,g=c.xx*c.yy-c.xy*c.yx,d=Math.sqrt(b*b-4*g),b=-(b+(0>b?-d:d))/2,g=g/b,d=c.xy/(b-c.xx),h=1,a=c.xy/(g-c.xx),m=1;u(b,g)&&(d=1,a=h=0,m=1);isFinite(d)||(d=1,h=(b-c.xx)/c.xy,isFinite(h)||(d=(b-c.yy)/c.yx,h=1,isFinite(d)||(d=1,h=c.yx/(b-c.yy))));isFinite(a)||(a=1,m=(g-c.xx)/c.xy,isFinite(m)||(a=(g-c.yy)/c.yx,m=1,isFinite(a)||(a=1,m=c.yx/(g-c.yy))));c=Math.sqrt(d*d+h*h);var l=Math.sqrt(a*
a+m*m);isFinite(d/=c)||(d=0);isFinite(h/=c)||(h=0);isFinite(a/=l)||(a=0);isFinite(m/=l)||(m=0);return{value1:b,value2:g,vector1:{x:d,y:h},vector2:{x:a,y:m}}}function h(c,b){var d=0>c.xx*c.yy||0<c.xy*c.yx?-1:1,g=b.angle1=(Math.atan2(c.yx,c.yy)+Math.atan2(-d*c.xy,d*c.xx))/2,d=Math.cos(g),g=Math.sin(g);b.sx=x(c.xx/d,d,-c.xy/g,g);b.sy=x(c.yy/d,d,c.yx/g,g);return b}function g(c,b){var d=0>c.xx*c.yy||0<c.xy*c.yx?-1:1,g=b.angle2=(Math.atan2(d*c.yx,d*c.xx)+Math.atan2(-c.xy,c.yy))/2,d=Math.cos(g),g=Math.sin(g);
b.sx=x(c.xx/d,d,c.yx/g,g);b.sy=x(c.yy/d,d,-c.xy/g,g);return b}return d.decompose=function(c){var b=n.normalize(c);c={dx:b.dx,dy:b.dy,sx:1,sy:1,angle1:0,angle2:0};if(u(b.xy,0)&&u(b.yx,0))return l.mixin(c,{sx:b.xx,sy:b.yy});if(u(b.xx*b.yx,-b.xy*b.yy))return h(b,c);if(u(b.xx*b.xy,-b.yx*b.yy))return g(b,c);var d,k=new n.Matrix2D(b);d=l.mixin(k,{dx:0,dy:0,xy:k.yx,yx:k.xy});k=m([b,d]);d=m([d,b]);k=new n.Matrix2D({xx:k.vector1.x,xy:k.vector2.x,yx:k.vector1.y,yy:k.vector2.y});d=new n.Matrix2D({xx:d.vector1.x,
xy:d.vector1.y,yx:d.vector2.x,yy:d.vector2.y});b=new n.Matrix2D([n.invert(k),b,n.invert(d)]);h(d,c);b.xx*=c.sx;b.yy*=c.sy;g(k,c);b.xx*=c.sx;b.yy*=c.sy;return l.mixin(c,{sx:b.xx,sy:b.yy})}})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(d){d=d.bezierutils={};d.tAtLength=function(d,g){var c=0,b=6==d.length,h=0,k=0,t=b?u:m,a=function(m,l){for(var u=0,y=0;y<m.length-2;y+=2)u+=n(m[y],m[y+1],m[y+2],m[y+3]);y=b?n(d[0],d[1],d[4],d[5]):n(d[0],d[1],d[6],d[7]);u-y>l||h+u>g+l?(++k,m=t(m,.5),
a(m[0],l),Math.abs(h-g)<=l||a(m[1],l)):(h+=u,c+=1/(1<<k))};g&&a(d,.5);return c};var l=d.computeLength=function(d){for(var g=6==d.length,c=0,b=0;b<d.length-2;b+=2)c+=n(d[b],d[b+1],d[b+2],d[b+3]);b=g?n(d[0],d[1],d[4],d[5]):n(d[0],d[1],d[6],d[7]);.1<c-b&&(d=g?u(d,.5):x(d,.5),c=l(d[0],g),c+=l(d[1],g));return c},n=d.distance=function(d,g,c,b){return Math.sqrt((c-d)*(c-d)+(b-g)*(b-g))},u=function(d,g){var c=1-g,b=c*c,h=g*g,k=d[0],m=d[1],a=d[2],l=d[3],n=d[4];d=d[5];var u=b*k+2*c*g*a+h*n,b=b*m+2*c*g*l+h*
d;return[[k,m,c*k+g*a,c*m+g*l,u,b],[u,b,c*a+g*n,c*l+g*d,n,d]]},x=function(d,g){var c=1-g,b=c*c,h=b*c,k=g*g,m=k*g,a=d[0],l=d[1],n=d[2],u=d[3],x=d[4],H=d[5],D=d[6];d=d[7];var F=h*a+3*b*g*n+3*c*k*x+m*D,h=h*l+3*b*g*u+3*c*k*H+m*d;return[[a,l,c*a+g*n,c*l+g*u,b*a+2*c*g*n+k*x,b*l+2*c*g*u+k*H,F,h],[F,h,b*n+2*c*g*x+k*D,b*u+2*c*g*H+k*d,c*x+g*D,c*H+g*d,D,d]]},m=d.splitBezierAtT=function(d,g){return 6==d.length?u(d,g):x(d,g)};return d})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang",
"dojox","dojo/_base/array"],function(d,l,n){l.getObject("json",!0,n);n.json._slice=function(d,l,m,h){var g=d.length,c=[];m=m||g;l=0>l?Math.max(0,l+g):Math.min(g,l);for(m=0>m?Math.max(0,m+g):Math.min(g,m);l<m;l+=h)c.push(d[l]);return c};n.json._find=function(d,l){function m(c){l&&(!0!==l||c instanceof Array?c[l]&&h.push(c[l]):h.push(c));for(var b in c){var d=c[b];l?d&&"object"==typeof d&&m(d):h.push(d)}}var h=[];if(l instanceof Array){if(1==l.length)return d[l[0]];for(var g=0;g<l.length;g++)h.push(d[l[g]])}else m(d);
return h};n.json._distinctFilter=function(d,l){for(var m=[],h={},g=0,c=d.length;g<c;++g){var b=d[g];l(b,g,d)&&("object"==typeof b&&b?b.__included||(b.__included=!0,m.push(b)):h[b+typeof b]||(h[b+typeof b]=!0,m.push(b)))}g=0;for(c=m.length;g<c;++g)m[g]&&delete m[g].__included;return m};return n.json.query=function(d,l){function m(b,c,a,d,h,m,l,n){return g[n].match(/[\*\?]/)||"~"==l?"/^"+g[n].substring(1,g[n].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+
("~"==l?"$/i":"$/")+".test("+c+")":b}var h=0,g=[];d=d.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(b){h+="["==b?1:"]"==b?-1:0;return"]"==b&&0<h?"`]":'"'==b.charAt(0)||"'"==b.charAt(0)?"`"+(g.push(b)-1):b});var c="";d.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");});d=d.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(b){return"."==b.charAt(0)?b:"@"==b?"$obj":(b.match(/:|^(\$|Math|true|false|null)$/)?
"":"$obj.")+b}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(b,d,a){return(d=b.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?(a="",b.match(/^\./)&&(c="dojox.json._find("+c,a=",true)"),c=(d[1].match(/\=/)?"dojo.map":d[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter")+"("+c,a+",function($obj){return "+d[2]+"})"):(d=b.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+d[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(a,b,c){return"var av\x3d "+c.replace(/\$obj/,
"a")+",bv\x3d "+c.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==b?1:-1)+";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==b?-1:1)+";}\n"})+"return 0;})":(d=b.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(c="dojox.json._slice("+c,","+(d[1]||0)+","+(d[2]||0)+","+(d[3]||1)+")"):b.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(c="dojox.json._find("+c,("."==b.charAt(1)?",'"+a+"'":b.match(/,/)?","+b:"")+")"):b}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,
m).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(b,c,a,d,g,h,l,n){return m(b,d,g,h,l,n,a,c)});d=c+("$"==d.charAt(0)?"":"$")+d.replace(/`([0-9]+|\])/g,function(b,c){return"]"==c?"]":g[c]});for(var b=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+d+"}"),n=0;n<arguments.length-1;n++)arguments[n]=arguments[n+1];return l?b.apply(this,arguments):b}})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel"],function(d,l,n,u){d=d(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null});n("extend-esri")&&l.setObject("tasks.PrintParameters",d,u);return d})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),function(d,l,n,u,x,m,h,g){return l("dijit.ProgressBar",[m,h],{progress:"0",value:"",
maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:g,_indeterminateHighContrastImagePath:d.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());this.update()},_setDirAttr:function(c){var b=
"rtl"==c.toLowerCase();n.toggle(this.domNode,"dijitProgressBarRtl",b);n.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&b);this.inherited(arguments)},update:function(c){u.mixin(this,c||{});c=this.internalProgress;var b=this.domNode,d=1;this.indeterminate?b.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(d=Math.min(parseFloat(this.progress)/100,1),this.progress=d*this.maximum):(this.progress=Math.min(this.progress,this.maximum),d=this.maximum?this.progress/
this.maximum:0),b.setAttribute("aria-valuenow",this.progress));b.setAttribute("aria-labelledby",this.labelNode.id);b.setAttribute("aria-valuemin",0);b.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(d);n.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);n.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());c.style.width=100*d+"%";this.onChange()},_setValueAttr:function(c){this._set("value",c);Infinity==
c?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:c})},_setLabelAttr:function(c){this._set("label",c);this.update()},_setIndeterminateAttr:function(c){this._set("indeterminate",c);this.update()},report:function(c){return this.label?this.label:this.indeterminate?"\x26#160;":x.format(c,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"widgets/Print/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css",
"dojo/i18n!./nls/strings"],function(){})},"url:widgets/Print/templates/Print.html":'\x3cdiv class\x3d"gis_PrintDijit"\x3e\r\n    \x3cdiv class\x3d"formContainer"\x3e\r\n        \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"printSettingsFormDijit"\x3e\r\n            \x3ctable cellspacing\x3d"5" style\x3d"width:100%;"\x3e\r\n                \x3ctr data-dojo-attach-point\x3d"titleTr"\x3e\r\n                    \x3ctd style\x3d"width:65px;"\x3e\r\n                        ${nls.title}:\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                        \x3cinput type\x3d"text" data-dojo-attach-point\x3d"titleNode" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"name:\'title\',trim:true,required:true,style:\'width:100%;\'" /\x3e\r\n                    \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr style\x3d"display: none"\x3e\r\n                    \x3ctd\x3e\r\n                        ${nls.layout}:\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                        \x3cinput type\x3d"select" data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"name:\'layout\',style:\'width:100%;\'"\r\n                        data-dojo-attach-point\x3d"layoutDijit" data-dojo-attach-event\x3d"Change:onLayoutChange"/\x3e\r\n                    \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr style\x3d"display: none"\x3e\r\n                    \x3ctd\x3e\r\n                        ${nls.format}:\r\n                    \x3c/td\x3e\r\n                    \x3ctd\x3e\r\n                        \x3cinput type\x3d"select" data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"name:\'format\',style:\'width:100%;\'"\r\n                        data-dojo-attach-point\x3d"formatDijit" /\x3e\r\n                    \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n            \x3c/table\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"buttonActionBar jimu-align-trailing"\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"advancedButtonDijit" style\x3d"display: none"\r\n            data-dojo-attach-event\x3d"onclick:showSettings"\x3e\x3cdiv class\x3d"btn-icon settingsIcon"\x3e\x3c/div\x3e${nls.settings}\x3c/div\x3e\r\n        \x3cdiv data-dojo-type\x3d"dijit/TooltipDialog" data-dojo-attach-point\x3d"settingsDialog"\r\n            style\x3d"display: none" class\x3d"gis_PrintDijit"\x3e\r\n            \x3cdiv style\x3d"width:250px;"\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.mapScaleExtent}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"preserveFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd style\x3d"vertical-align:middle;"\x3e\r\n                                ${nls.preserve}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"printWidgetMapScale" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-props\x3d"name:\'preserveScale\',checked:true,value:\'true\'"\r\n                                /\x3e\x3clabel data-dojo-attach-point\x3d"printWidgetMapScaleLabel"\x3e${nls.mapScale}\x3c/label\x3e\r\n                                \x3cbr /\x3e\r\n                                \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"printWidgetMapExtent" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-props\x3d"name:\'preserveScale\',value:\'false\'"\r\n                                /\x3e\x3clabel data-dojo-attach-point\x3d"printWidgetMapExtentLabel"\x3e${nls.mapExtent}\x3c/label\x3e\r\n                            \x3c/td\x3e\r\n                            \x3ctr\x3e\r\n                                \x3ctd\x3e\r\n                                    ${nls.forceScale}:\r\n                                \x3c/td\x3e\r\n                                \x3ctd\x3e\r\n                                    \x3cinput type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-props\x3d"name:\'preserveScale\',value:\'force\',checked:false"/\x3e \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"name:\'forcedScale\',required:false,style:\'width:100px;\'" data-dojo-attach-point\x3d"forceScaleNTB"/\x3e \x3ca href\x3d"#" data-dojo-attach-event\x3d"click:getCurrentMapScale"\x3e${nls.getCurrentScale}\x3c/a\x3e\r\n                                \x3c/td\x3e\r\n                            \x3c/tr\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;" data-dojo-attach-point\x3d"labelsTitleNode"\x3e\r\n                    ${nls.labels}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"labelsFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd style\x3d"vertical-align:middle;"\x3e\r\n                                ${nls.showLabels}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"name:\'showLabels\',value:true,checked:true" /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.mapMetadata}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"layoutMetadataDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5" style\x3d"width:100%;"\x3e\r\n                        \x3ctr data-dojo-attach-point\x3d"authorTr"\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.author}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"authorNode" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"name:\'author\',trim:true,required:false,style:\'width:100%;\'" data-dojo-attach-point\x3d"authorTB"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr data-dojo-attach-point\x3d"copyrightTr"\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.copyright}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3ctextarea data-dojo-attach-point\x3d"copyrightNode" name\x3d"copyright"\r\n                                    data-dojo-type\x3d"dijit/form/SimpleTextarea"\r\n                                    style\x3d"width:100%;height:60px;resize:none;"\x3e\x3c/textarea\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"customTextElementsDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5" style\x3d"width:100%;" data-dojo-attach-point\x3d"customTextElementsTable"\x3e\r\n\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"layoutFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr data-dojo-attach-point\x3d"legendTr"\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.lncludeLegend}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"name:\'legend\',value:true,checked:true"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr data-dojo-attach-point\x3d"scalebarTr"\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.scaleBarUnit}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"name:\'scalebarUnit\',style:\'width:100%;\'"\r\n                        data-dojo-attach-point\x3d"scalebarUnitDijit"\x3e\r\n                                    \x3coption value\x3d"Miles" selected\x3d"selected"\x3e${nls.unitsMiles}\x3c/option\x3e\r\n                                    \x3coption value\x3d"Kilometers"\x3e${nls.unitsKilometers}\x3c/option\x3e\r\n                                    \x3coption value\x3d"Meters"\x3e${nls.unitsMeters}\x3c/option\x3e\r\n                                    \x3coption value\x3d"Feet"\x3e${nls.unitsFeet}\x3c/option\x3e\r\n                                \x3c/select\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.mapOnlyOptions}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"mapOnlyFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.width}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"name:\'width\',required:true,value:670,style:\'width:100px;\'"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.height}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"name:\'height\',required:true,value:500,style:\'width:100px;\'"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.printQualityOptions}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"mapQualityFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd\x3e\r\n                                ${nls.dpi}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"name:\'dpi\',required:true,value:96,style:\'width:100px;\'"\r\n                                /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv style\x3d"font-weight:bold;"\x3e\r\n                    ${nls.forceFeatureAttributes}:\r\n                \x3c/div\x3e\r\n                \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"forceAttributesFormDijit"\x3e\r\n                    \x3ctable cellspacing\x3d"5"\x3e\r\n                        \x3ctr\x3e\r\n                            \x3ctd style\x3d"vertical-align:middle;"\x3e\r\n                                ${nls.includeFeatureAttributes}:\r\n                            \x3c/td\x3e\r\n                            \x3ctd\x3e\r\n                                \x3cinput type\x3d"checkbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"name:\'forceFeatureAttributes\',value:true,checked:false" /\x3e\r\n                            \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                    \x3c/table\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"printButtonDijit"\r\n            data-dojo-attach-event\x3d"onclick:print"\x3e\x3cdiv class\x3d"btn-icon printIcon"\x3e\x3c/div\x3e${nls.print}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- \x3chr calss\x3d"spacer"\x3e --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"printResultsNode" class\x3d"resultsContainer"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"clearActionBarNode" class\x3d"buttonActionBar"\r\n    style\x3d"display:none;padding:0;"\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-event\x3d"onclick:clearResults"\x3e\r\n            \x3cdiv class\x3d"btn-icon clearIcon"\x3e\x3c/div\x3e${nls.clearList}\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/Print/templates/PrintResult.html":'\x3cdiv class\x3d"printResult" data-dojo-attach-point\x3d"resultNode" data-dojo-attach-event\x3d"onclick:_openPrint"\x3e\r\n  \x3ctable class\x3d"printResultTable"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd width\x3d"25px"\x3e\r\n        \x3cspan class\x3d"bold"\x3e${count}.\x3c/span\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd width\x3d"30px"\x3e\r\n        \x3cimg src\x3d"${icon}"\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd data-dojo-attach-point\x3d"nameNode"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"progressBar" data-dojo-type\x3d"dijit/ProgressBar" data-dojo-props\x3d\'value:Infinity\'\x3e\x3c/div\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"successNode" class\x3d"bold" style\x3d"display:none;"\x3e${docName}\x3c/span\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"errNode" style\x3d"display:none;"\x3e\r\n          \x3cspan class\x3d"bold"\x3e${nls.printError}\x3c/span\x3e\r\n          \x3cdiv class\x3d"jimu-icon jimu-icon-error jimu-float-trailing"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:widgets/Print/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"printNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/Print/css/style.css":".jimu-widget-print{width: 100%; height: 100%; position: relative;}.jimu-widget-print .dijitSelect{height: 20px; width: 100%;}.gis_PrintDijit {width: 100%;}.gis_PrintDijit .printResult {height: 28px; margin-bottom: -1px; width: 100%;}.gis_PrintDijit .printResult .printResultTable {width: 100%;}.gis_PrintDijit .printResult .bold {font-weight: bold;}.gis_PrintDijit .printResultError {font-weight: bold; color: red; cursor: help;}.gis_PrintDijit .printResultHover table:hover {background-color: #D4E7F8; cursor: pointer;}.gis_PrintDijit .buttonActionBar {padding: 3px 0px 2px 0px; width: 100%;}.gis_PrintDijit .formContainer {margin-bottom: -1px; width: 100%;}.gis_PrintDijit .resultsContainer {width: 100%; margin-top: 10px;}.gis_PrintDijit .btn-icon {width: 16px; height: 16px; display: inline-block; vertical-align: text-top; margin-right: 10px;}.jimu-rtl .gis_PrintDijit .btn-icon {margin-right: auto; margin-left: 10px;}.gis_PrintDijit .printIcon {background-image: url(../images/print.png);}.gis_PrintDijit .clearIcon {background-image: url(../images/clear.png);}.gis_PrintDijit .settingsIcon {background-image: url(../images/settings.png); width: 16px; height: 16px;}.gis_PrintDijit .dijitArrowButtonContainer{width: 17px;}",
"*now":function(d){d(['dojo/i18n!*preload*widgets/Print/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare jimu/BaseWidget jimu/portalUtils dojo/_base/lang dojo/Deferred jimu/dijit/Message jimu/dijit/LoadingShelter ./Print esri/request jimu/portalUrlUtils".split(" "),function(d,l,n,u,x,m,h,g,c,b){return d([l],{baseClass:"jimu-widget-print",name:"Print",className:"esri.widgets.Print",_portalPrintTaskURL:null,postCreate:function(){this.inherited(arguments);this.shelter=new h({hidden:!0});this.shelter.placeAt(this.domNode);this.shelter.startup()},startup:function(){this.inherited(arguments);
this.shelter.show();this._initPrinter()},_initPrinter:function(){this._getPrintTaskURL(this.appConfig.portalUrl).then(u.hitch(this,function(b){this.shelter.show();this.isAsync(b).then(u.hitch(this,function(c){this.print=new g({map:this.map,appConfig:this.appConfig,printTaskURL:b,defaultAuthor:this.config.defaultAuthor,defaultCopyright:this.config.defaultCopyright,copyrightEditable:!1!==this.config.copyrightEditable,defaultTitle:this.config.defaultTitle,defaultFormat:this.config.defaultFormat,defaultLayout:this.config.defaultLayout,
nls:this.nls,async:c});this.print.placeAt(this.printNode);this.print.startup()}),u.hitch(this,function(b){new m({message:b.message})})).always(u.hitch(this,function(){this.shelter.hide()}))}),u.hitch(this,function(b){new m({message:b});console.error(b);this.shelter.hide()}))},_getPrintTaskURL:function(b){var c=new x;if(this.config&&this.config.serviceURL)return c.resolve(this.config.serviceURL),c;n.getPortalSelfInfo(b).then(u.hitch(this,function(b){(b=b&&b.helperServices&&b.helperServices.printTask&&
b.helperServices.printTask.url)?c.resolve(b):c.reject("error")}),u.hitch(this,function(b){new m({message:this.nls.portalConnectionError});c.reject("error");console.error(b)}));return c},isAsync:function(d){var g=new x,h=b.setHttpProtocol(d),a=b.getNewPrintUrl(this.appConfig.portalUrl);h===a||/sharing\/tools\/newPrint$/.test(h)?g.resolve(!1):c({url:d,content:{f:"json"},callbackParamName:"callback",handleAs:"json",timeout:6E4,load:u.hitch(this,function(a){"esriExecutionTypeAsynchronous"===a.executionType?
g.resolve(!0):g.resolve(!1)}),error:u.hitch(this,function(a){g.reject(a)})});return g},onSignIn:function(b){b=b||{};b.userId&&this.print&&this.print.updateAuthor(b.userId)}})});