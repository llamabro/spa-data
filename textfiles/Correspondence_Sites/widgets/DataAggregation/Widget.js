// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/DataAggregation/js/UI/PageContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Evented dojo/query dojo/dom-class dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/PageContainer.html jimu/dijit/ViewStack".split(" "),function(t,d,h,l,n,w,p,y,u,A,v,m){return t([u,A,w],{templateString:v,selected:"",tabs:null,average:!1,nls:null,baseClass:"jimu-tab3",declaredClass:"PageContainer",views:[],_currentIndex:-1,
_homeIndex:0,theme:"",isDarkTheme:"",styleColor:"",altHomeIndex:0,nextDisabled:!1,_backLabels:[],constructor:function(f){d.mixin(this,f);this.theme=this.appConfig.theme.name;this.own(n.subscribe("appConfigChanged",d.hitch(this,this._onAppConfigChanged)));this.own(n.subscribe("builder/styleChanged",d.hitch(this,this._onBuilderStyleChanged)))},postCreate:function(){this.inherited(arguments);this.displayControllerOnStart||this.toggleController(!0);this._darkThemes=["DartTheme","DashboardTheme"];this.updateImageNodes()},
startup:function(){this.inherited(arguments);this._started=!0;this._initSelf();this.selected?this.selectView(this.selected):0<this.views.length&&this.selectView(this._homeIndex);this._backLabels=[]},_onBuilderStyleChanged:function(f){this.setStyleColor(f.styleColor)},_onAppConfigChanged:function(f,a,b){switch(a){case "themeChange":this.theme=f.theme.name;this.updateImageNodes();this._updateViewTheme();this.emit("theme-change",f,a,b);break;case "layoutChange":this.emit("layout-change",f,a,b);break;
case "styleChange":this.emit("style-change",f,a,b);break;case "widgetChange":this.emit("widget-change",f,a,b);break;case "mapChange":this.emit("map-change",f,a,b)}},selectView:function(f,a){!a&&0<f&&(a=this.getSelectedTitle(),(a=this.getViewByTitle(a))&&this._backLabels[this._backLabels.length-1]!==a.label&&f!==a.index&&(this._backLabels.push(a.label),this.backDisabled=!1));this.viewStack.switchView(f);this._updateDomNodes(f);this._currentIndex=f;this.emit("view-changed",f)},showShelter:function(){l.setStyle(this.shelter,
"display","block")},hideShelter:function(){l.setStyle(this.shelter,"display","none")},_initSelf:function(){this.viewStack?this.viewStack._currentView=void 0:this.viewStack=new m(null,this.containerNode);this._initViews()},_initViews:function(){h.forEach(this.views,d.hitch(this,function(f){this.addView(f)}))},_prevView:function(){this._navView("back-view")},_homeView:function(){this._navView("home-view")},_nextView:function(){this._navView("next-view")},_navView:function(f){var a=this.getSelectedTitle(),
b=this.getViewByTitle(a),k="home-view"===f&&b.altHomeIndex?b.altHomeIndex:this._homeIndex,q,e=!1;if("back-view"===f&&0<this._backLabels.length){var g;for(q=this._backLabels.length-1;0<=q&&(!(g=this.getViewByTitle(this._backLabels[q]))||this._backLabels[q]===a);q--)this._backLabels.splice(q,1);q=g.index;e=!0}"next-view"===f&&"undefined"===typeof b&&0<this._backLabels.length&&(this._currentIndex=(b=this.getViewByTitle(this._backLabels[this._backLabels.length-1]))&&b.index?b.index:this._currentIndex);
"undefined"===typeof q&&(q="next-view"===f?b.altNextIndex:"back-view"===f?b.altBackIndex:void 0);var c;"undefined"!==typeof q&&"home-view"!==f?c=this.getViewByIndex(q):"next-view"===f?this._currentIndex<this.viewCount-1&&(c=this.getViewByIndex(this._currentIndex+1)):"back-view"===f?c=this._currentIndex-1<=this._homeIndex?this.getViewByIndex(this._homeIndex):this.getViewByIndex(this._currentIndex-1):(k!==this._homeIndex&&this._backLabels&&0<this._backLabels.length&&(e=!0),c=this.getViewByIndex(k));
c&&(a={currentView:b,navView:c},this.emit(f,a),b.validate?b.validate(f,a).then(d.hitch(this,function(a){a&&this._navigate(c.index,e,b.index,f,c.label)})):this._navigate(c.index,e,b.index,f,c.label))},_navigate:function(f,a,b,k,q){0<b&&"next-view"===k&&this._backLabels[this._backLabels.length-1]!==this.views[b].label&&(this._backLabels.push(this.views[b].label),this.backDisabled=!1);if(a){for(a=this._backLabels.length-1;0<=a;a--)if(this._backLabels[a]===q){this._backLabels.splice(a,1);break}0===this._backLabels.length&&
(this.backDisabled=!0)}this._currentIndex=f;this.selectView(f,!0);this.emit("nav-view",f)},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},getViewByIndex:function(f){if(this.views.length>f)return this.views[f]},getViewByTitle:function(f){for(var a=0;a<this.views.length;a++){var b=this.views[a];if(b.label===f)return b}},_updateControl:function(f,a){a?l.addClass(f,"control-disbaled"):l.removeClass(f,"control-disbaled")},_updateViews:function(){this.viewCount=
this.views.length;for(var f=0;f<this.views.length;f++){var a=this.views[f];a.setStyleColor(this.styleColor);"undefined"!==typeof a.index&&a.index!==f&&this.emit("view-index-change",{oldIndex:a.index,newIndex:f});a.index=f}this.emit("views-updated",this)},addView:function(f){f.pageContainer=this;this._containsView(f.label)||this.views.push(f);this.viewStack.getViewByLabel(f.label)||this.viewStack.addView(f);this._updateViews();this.emit("view-added",f)},removeViewByTitle:function(f){f=this.getViewByTitle(f);
this.removeViewByIndex(f.index)},removeView:function(f){this.removeViewByIndex(f.index)},removeViewByIndex:function(f){var a=this.getViewByIndex(f),b=a.label;this.viewStack.removeView(a);this.views.splice(f,1);this._updateViews();this._backLabels=this._backLabels.filter(function(a){return a!==b});0===this._backLabels.length&&(this.backDisabled=!0);this._navView("next-view");this.emit("view-removed",a)},_clearViews:function(){h.forEach(this.views,d.hitch(this,function(f){this.viewStack.removeView(f)}));
this.views=[];this._backLabels=[]},_containsView:function(f){for(var a=0;a<this.views.length;a++)if(this.views[a].label===f)return!0;return!1},setStyleColor:function(f){this.styleColor=f;h.forEach(this.views,d.hitch(this,function(a){a.styleColor=f}))},updateImageNodes:function(){var f=-1<this._darkThemes.indexOf(this.theme);this._updateImageNode(f,"bg-back-img","bg-back-img-white");this._updateImageNode(f,"bg-home-img","bg-home-img-white");this._updateImageNode(f,"bg-next-img","bg-next-img-white")},
_updateDomNodes:function(f){var a=this.views[f],b=this._homeIndex,k=this.backDisabled?this.backDisabled:f===this._homeIndex?!0:!1;this._updateControl(this.backTd,k);this._updateControl(this.backImage,k);k=f===b?!0:!1;this._updateControl(this.homeTd,k);this._updateControl(this.homeImage,k);a=a&&"undefined"!==typeof a.altNextIndex;f=this.nextDisabled?this.nextDisabled:f!==b||this.nextDisabled?a?!1:this.nextDisabled:!1;this._updateControl(this.nextTd,f);this._updateControl(this.nextImage,f)},_updateImageNode:function(f,
a,b){var k=f?a:b,q=f?b:a;f=p("."+k,this.domNode);h.forEach(f,function(a){y.remove(a,k);y.add(a,q)})},_updateViewTheme:function(f){this.theme=f;h.forEach(this.views,d.hitch(this,function(a){a.theme=f}))},toggleController:function(f){this.controlTable&&(f?y.contains(this.controlTable,"display-none")||y.add(this.controlTable,"display-none"):y.contains(this.controlTable,"display-none")&&y.remove(this.controlTable,"display-none"))},reset:function(){this._clearViews();this.views=[];this._currentIndex=-1;
this._homeIndex=0;this.nextDisabled=!1;this.backDisabled=!0;this.selected="";this.updateImageNodes()}})})},"widgets/DataAggregation/js/UI/Home":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/Home.html dojo/on dojo/dom-construct dojo/dom-class ../csvStore ./Addresses ./Coordinates ./FieldMapping esri/lang jimu/dijit/Popup".split(" "),function(t,d,h,l,n,w,p,
y,u,A,v,m,f,a,b,k,q,e){return t([n,w,p,y],{baseClass:"cf-home",declaredClass:"CriticalFacilities.Home",templateString:u,_started:null,label:"Home",parent:null,nls:null,map:null,appConfig:null,config:null,theme:"",isDarkTheme:"",styleColor:"",_geocodeSources:null,_fsFields:[],_singleFields:[],_multiFields:[],_childViews:[],singleEnabled:!1,multiEnabled:!1,xyEnabled:!1,disabled:!1,userName:"",constructor:function(a){d.mixin(this,a);this._initBaseArgs()},_initBaseArgs:function(){this._baseArgs={nls:this.nls,
map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,theme:this.theme,isDarkTheme:this.isDarkTheme}},postCreate:function(){this.inherited(arguments);this.pageInstruction.innerHTML=q.substitute({layer:this.parent.editLayer.name},this.nls.startPage.startPageInstructions)},startup:function(){this._started=!0;this.inDrop=!1;(this.fileNode.disabled=this.disabled)&&m.add(this.uploadLabel,"disabled");this.parent.domNode&&(this.own(A(this.parent.domNode,"dragenter",this.onDragEnter)),
this.own(A(this.parent.domNode,"dragover",this.onDragOver)),this.own(A(this.parent.domNode,"drop",d.hitch(this,this.onDrop))));this.own(A(this.map.container,"dragenter",this.onDragEnter));this.own(A(this.map.container,"dragover",this.onDragOver));this.own(A(this.map.container,"drop",d.hitch(this,this.onDrop)));this.own(A(this.fileNode,"change",d.hitch(this,this.onDrop)))},onShown:function(){},_clearResults:function(a){a||(this.map.infoWindow.hide(),this.inDrop=!1)},setStyleColor:function(a){this.styleColor=
a},updateImageNodes:function(){},updateTheme:function(a){this.theme=a},validate:function(a,c){var g=new l;"next-view"===a?g.resolve(this._nextView(c)):"back-view"===a?this._backView(c).then(function(c){g.resolve(c)}):this._homeView(c).then(function(c){g.resolve(c)});return g},_nextView:function(a){a.navView.label===this.pageContainer.views[1].label&&this.pageContainer.toggleController(!1);return!0},_backView:function(a){var c=new l;a.navView.label===this.label&&(this.pageContainer.toggleController(!0),
c.resolve(!0));return c},_homeView:function(a){var c=new l;a.navView.label===this.label&&(this.pageContainer.toggleController(!0),c.resolve(!0));return c},_clearMapping:function(){this.parent._locationMappingComplete=!1;this.parent._fieldMappingComplete=!1},onDragEnter:function(a){a.preventDefault()},onDragOver:function(a){a.preventDefault()},onDrop:function(a){if(this.disabled)this.parent._userCanEdit?(a=this.parent._getMessages(),this.parent._showPopup(a)):this.parent.showEditMessage();else if(!this.inDrop){this.inDrop=
!0;this.csvStore&&this.csvStore.clear();var c;a.dataTransfer?(a.preventDefault(),c=a.dataTransfer.files):a.currentTarget&&(c=a.currentTarget.files);c&&0<c.length?(a=c[0],-1!==a.name.indexOf(".csv")?(this.csvStore=new f({file:a,fsFields:this._fsFields,map:this.map,geocodeSources:this._geocodeSources,nls:this.nls,appConfig:this.appConfig,editLayer:this.parent.editLayer,symbol:this.parent._symbol}),this.csvStore.handleCsv().then(d.hitch(this,function(c){this._updatePageContainer(c);this.inDrop=!1}))):
this.inDrop=!1):this.inDrop=!1}},_initCoordinatesView:function(a){return new b(d.mixin({fields:this._getFields(a,!0),xField:"X"===this.config.xyFields[0].fieldName?this.config.xyFields[0]:this.config.xyFields[1],yField:"Y"===this.config.xyFields[0].fieldName?this.config.xyFields[0]:this.config.xyFields[1],firstField:this.config.xyFields[0].fieldName},this._baseArgs))},_initAddressView:function(g){return new a(d.mixin({singleFields:this._singleFields,multiFields:this._multiFields,fields:this._getFields(g,
!1),multiEnabled:this.multiEnabled,singleEnabled:this.singleEnabled},this._baseArgs))},_initFieldMappingView:function(a){return new k(d.mixin({targetFields:a.fsFields,sourceFields:this._getFields(a,!1)},this._baseArgs))},_getFields:function(a,c){var g=[];h.forEach(a.fields,function(b){var e=a.fieldTypes[b];(c&&e&&(e.supportsInt||e.supportsFloat)||!c)&&g.push({label:b,value:b,type:e})});return g},_updatePageContainer:function(a){this.pageContainer.getViewByTitle("StartPage").csvStore=this.csvStore;
if(this.xyEnabled){var c=this._initCoordinatesView(a);this.pageContainer.addView(c)}if(this.singleEnabled||this.multiEnabled)c=this._initAddressView(a),this.pageContainer.addView(c);a=this._initFieldMappingView(a);this.pageContainer.addView(a);this.pageContainer._nextView()},verifyClearSettings:function(a){var c=new l;if(a.navView.label===this.label){var g;if(this.parent._locationMappingComplete||this.parent._fieldMappingComplete||this.parent._tempResultsAdded)g=this.nls.warningsAndErrors.settingsCleared;
if(g){var b=v.create("div");v.create("div",{className:"cf-warning-icon",style:"float: "+(window.isRTL?"right; margin-left":"left; margin-right")+": 10px;"},b);var z="padding-"+(window.isRTL?"right":"left")+": 50px;";v.create("div",{innerHTML:g,style:z},b);v.create("div",{innerHTML:this.nls.warningsAndErrors.proceed,style:"padding-top:10px; "+z},b);var k=new e({width:325,autoHeight:!0,content:b,buttons:[{label:this.nls.yes,onClick:d.hitch(this,function(){this._clearMapping();this._clearStore(!0);this.pageContainer.toggleController(!0);
k.close();k=null;c.resolve(!0)})},{label:this.nls.no,classNames:["jimu-btn-vacation"],onClick:d.hitch(this,function(){this.pageContainer.selectView(a.currentView.index);k.close();k=null;c.resolve(!1)})}],onClose:function(){k=null}})}else this.pageContainer.toggleController(!0),this._clearStore(!0),c.resolve(!0)}else c.resolve(!0);return c},_clearStore:function(a){this.csvStore&&this.csvStore.clear();this.map.infoWindow&&this.map.infoWindow.clearFeatures&&this.map.infoWindow.clearFeatures();this.fileForm.reset();
a&&(this.parent._initPageContainer(!0),this.inDrop=!1)}})})},"widgets/DataAggregation/js/csvStore":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/DeferredList dojo/Evented dojox/data/CsvStore dojo/store/Observable dojo/store/Memory esri/graphicsUtils esri/geometry/webMercatorUtils esri/geometry/Point esri/layers/FeatureLayer esri/tasks/locator esri/tasks/query esri/SpatialReference esri/dijit/PopupTemplate esri/geometry/geometryEngine esri/tasks/ProjectParameters esri/tasks/GeometryService esri/request jimu/utils moment/moment".split(" "),
function(t,d,h,l,n,w,p,y,u,A,v,m,f,a,b,k,q,e,g,c,x,r,z){return t([w],{file:null,map:null,spatialReference:null,fsFields:[],duplicateTestFields:[],geocodeSources:[],duplicateData:[],data:null,editLayer:null,separatorCharacter:null,csvStore:null,storeItems:null,matchedFeatureLayer:null,mappedArrayFields:null,unMatchedFeatureLayer:null,duplicateFeatureLayer:null,addrFieldName:"",xFieldName:"",yFieldName:"",symbol:null,matchFieldPrefix:"MatchField_",_internalFields:[],constructor:function(a){h.mixin(this,
a);this.useAddr=!0;this.objectIdField="ObjectID";this.nls=a.nls;this.minScore=90;this._getDuplicateFields(this.fsFields);this.spatialReference=this.map.spatialReference;this.decimalSeperator=/^1(.+)1$/.exec(r.localizeNumber(1.1))[1].toString()},_getDuplicateFields:function(a){var c=[];d.forEach(a,function(a){a.duplicate&&c.push(a.name)});this.duplicateTestFields=c},handleCsv:function(){var a=new l;if(this.file&&!this.file.data){var c=new FileReader;c.onload=h.hitch(this,function(){this.data=c.result;
this._processCsvData().then(function(c){a.resolve(c)})});c.readAsText(this.file)}return a},_processCsvData:function(){var a=new l;this._convertSources();this._getSeparator();this._getCsvStore().then(function(c){a.resolve(c)});return a},processForm:function(){this._internalFields=["DestinationOID","matchScore","hasDuplicateUpdates","duplicateState"];this._matchFields=[];var a=new l;this._locateData(this.useAddr).then(h.hitch(this,function(c){for(var g=[],b=[],e=[],z={},x=0,k=0,r=function(a,c,g,b){var e=
a;-1===[null,void 0,""].indexOf(a)&&a.indexOf&&-1<a.indexOf(c)&&(g=g.filter(function(a){return a.keyField===b}))&&g.hasOwnProperty("length")&&1===g.length&&(e=a.toString?a.toString().replace(c,"."):a);return e},f=Object.keys(c),q=0;q<f.length;q++){var B={},C=c[f[q]],p=this.storeItems[C.csvIndex];d.forEach(this.fsFields,h.hitch(this,function(a){if(this.mappedArrayFields.hasOwnProperty(a.name))if(this.mappedArrayFields[a.name]){var c=this.csvStore.getValue(p,this.mappedArrayFields[a.name]);if(a.domainValues){var g=
a.domainValues.filter(h.hitch(this,function(a){return a.label===c}));B[a.name]=g&&0<g.length?g[0].value:c}else B[a.name]="."===this.decimalSeperator||this.useAddr?c:r(c,this.decimalSeperator,this._currentAddressFields,this.mappedArrayFields[a.name])}else B[a.name]=void 0}));d.forEach(this._currentAddressFields,h.hitch(this,function(a){var c=this.matchFieldPrefix+a.keyField;if("undefined"!==typeof a.value){var g=this.csvStore.getValue(p,a.value);B[c]="."===this.decimalSeperator||this.useAddr?g:r(g,
this.decimalSeperator,this._currentAddressFields,a.keyField)}else B[c]=void 0;this._matchFields.push(c)}));C&&C.score>this.minScore?(B.ObjectID=q-x-k,B.matchScore=C.score,g.push({geometry:C.location,attributes:h.clone(B)})):C.isDuplicate?(B.ObjectID=k,B.DestinationOID=C.featureAttributes[this.editLayer.objectIdField],B.matchScore=100,B.hasDuplicateUpdates=!1,B.duplicateState="no-change",e.push({geometry:C.location,attributes:h.clone(B)}),z[k]=C.featureAttributes,k++):(B.ObjectID=x,B.matchScore=C.score?
C.score:0,b.push({geometry:C.location&&C.location.type?C.location:new m(0,0,this.spatialReference),attributes:h.clone(B)}),x++)}this.matchedFeatureLayer=this._initLayer(g,this.file.name.replace(".csv",""));0<e.length&&(this.duplicateFeatureLayer=this._initLayer(e,this.file.name.replace(".csv","")+"_Duplicate"));0<b.length&&(this.unMatchedFeatureLayer=this._initLayer(b,this.file.name.replace(".csv","")+"_UnMatched"));a.resolve({matchedLayer:this.matchedFeatureLayer,unMatchedLayer:this.unMatchedFeatureLayer,
duplicateLayer:this.duplicateFeatureLayer,duplicateLookupList:z})}));return a},_initLayer:function(a,c){a=this._generateFC(a);c=new f(a,{id:c,editable:!0,outFields:["*"]});this._initPopup(c);this.map.addLayers([c]);return c},_initPopup:function(a){var c={title:a.id+": {"+this.labelField+"}"},g=[];d.forEach(a.fields,h.hitch(this,function(a){a.name!==this.objectIdField&&-1===this._internalFields.indexOf(a.name)&&-1===this._matchFields.indexOf(a.name)&&g.push({fieldName:a.name,visible:!0})}));c.fieldInfos=
g;a.infoTemplate=new q(c)},_findDuplicates:function(){var a=new l;this._getAllLayerFeatures(this.editLayer,this.fsFields).then(h.hitch(this,function(c){this.keys=Object.keys(this.mappedArrayFields);this.oidField=this.editLayer.objectIdField;var g=[],b=[],e=this.duplicateTestFields;e&&e.hasOwnProperty("length")&&0<e.length&&d.forEach(this.storeItems,h.hitch(this,function(a){var c={compareValues:{},fileId:a._csvId,featureId:-1};d.forEach(e,h.hitch(this,function(g){var e=this.mappedArrayFields[g];"undefined"!==
typeof e&&(c.compareValues[g]=this.csvStore.getValue(a,e),-1===b.indexOf(g)&&b.push(g))}));0<Object.keys(c.compareValues).length&&g.push(c)}));var z=[];0<g.length&&d.forEach(g,h.hitch(this,function(a){d.forEach(c,h.hitch(this,function(c){var g={};d.forEach(b,h.hitch(this,function(a){var b=c.attributes[a];g[a]=-1===[null,void 0].indexOf(b)&&b.toString?b.toString():b}));if(JSON.stringify(a.compareValues)===JSON.stringify(g)){var e=c.attributes[this.oidField];-1!==a.featureId?(a.hasMultiDuplicates=!0,
"undefined"===typeof a.featureIds?(a.featureIds=[a.featureId,e],a.features=[a.feature,c]):(a.featureIds.push(e),a.features.push(c))):(a.featureId=e,a.feature=c,z.push(a))}}))}));a.resolve(z)}));return a},_getAllLayerFeatures:function(a,c){var g=new l,e=[this.editLayer.objectIdField];d.forEach(c,function(a){a.name&&e.push(a.name)});2>e.length&&(e=c);var z=a.maxRecordCount;c=new b;c.where="1\x3d1";a.queryIds(c).then(function(c){var x=[],k,r;if(c&&0<c.length){k=0;for(r=c.length;k<r;k+=z){var f=new b;
f.outFields=e;f.objectIds=c.slice(k,k+z);f.returnGeometry=!0;x.push(a.queryFeatures(f))}(new n(x)).then(h.hitch(this,function(a){if(a){for(var c=[],b=0;b<a.length;b++)a[b][1].features&&c.push.apply(c,a[b][1].features.map(function(a){return{geometry:a.geometry,attributes:a.attributes}}));g.resolve(c)}}))}else g.resolve([])});return g},_locateData:function(a){var c=new l;this._findDuplicates().then(h.hitch(this,function(g){this.duplicateData=g;if(a){var b=h.hitch(this,function(a,c,g){var e=new l,z=
this._geocodeSources[c],k=z.locator;k.outSpatialReference=this.spatialReference;var x=[],r=[],f=0,q,B;q=0;B=a.length;for(;q<B;q+=500){var m=a.slice(q,q+500),D=[];(z.singleEnabled||z.multiEnabled)&&d.forEach(m,h.hitch(this,function(a){var c=a._csvId,b=null,e;a:for(e in this.duplicateData){var k=this.duplicateData[e];if(k.fileId===c){b=h.mixin({},k);delete this.duplicateData[e];break a}}var x={};x.OBJECTID=c;this.useMultiFields&&z.multiEnabled?d.forEach(this.multiFields,h.hitch(this,function(c){this._currentAddressFields=
this.multiFields;if(c.value!==this.nls.noValue){var g=this.csvStore.getValue(a,c.value);x[c.keyField]=g}else x[c.keyField]=void 0})):z.singleEnabled&&this.singleFields[0].value!==this.nls.noValue&&(this._currentAddressFields=this.singleFields,e=this.csvStore.getValue(a,this.singleFields[0].value),"undefined"===typeof e&&(e=typeof e+c),x[z.singleLineFieldName]=e);e=h.mixin({},x);delete e.OBJECTID;e=JSON.stringify(e);if(null===b)D.push(x),g[e]={index:f,csvIndex:c,location:{}},f+=1;else if(null!==b){var k=
b.feature.geometry,r=b.feature.attributes;if(-1!==[null,void 0].indexOf(k)&&b.features){var q=0;a:for(;q<b.features.length;q++){var B=b.features[q];if(-1===[null,void 0].indexOf(B.geometry)){k=B.geometry;r=B.attributes;break a}}}g[e]={index:-1,csvIndex:c,isDuplicate:!0,location:h.mixin({},k),featureAttributes:r}}}));r.push(k.addressesToLocations({addresses:D,countryCode:z.countryCode,outFields:["ResultID","Score"]}))}var C=Object.keys(g);(new n(r)).then(h.hitch(this,function(z){this.minScore=this._geocodeSources[c]?
this._geocodeSources[c].minCandidateScore:90;c+=1;var k=this._geocodeSources.length>c;if(z){var r=this.minScore,f=0;d.forEach(z,h.hitch(this,function(c){c=c[1];d.forEach(c,function(a){a.ResultID=a.attributes.ResultID});c=y(new u({data:c,idProperty:"ResultID"})).query({},{sort:[{attribute:"ResultID"}]});d.forEach(c,h.hitch(this,function(c){for(var b in C){var e=C[b];if(g[e]&&g[e].index===f){c.attributes.Score<r?k&&(x.push(a[g[e].csvIndex]),delete g[e]):(g[e].location=c.location,g[e].score=c.attributes.Score,
delete g[e].index);delete C[b];break}}f+=1}))}));if(k&&0<x.length)b(x,c,g).then(h.hitch(this,function(a){e.resolve(a)}));else return e.resolve(g),e.promise}}));return e});b(this.storeItems,0,{}).then(h.hitch(this,function(a){c.resolve(a)}))}else this._currentAddressFields=[{keyField:this.xFieldName,label:this.xFieldName,value:this.xFieldName},{keyField:this.yFieldName,label:this.yFieldName,value:this.yFieldName}],this._xyData({storeItems:this.storeItems,csvStore:this.csvStore,xFieldName:this.xFieldName,
yFieldName:this.yFieldName,wkid:this.spatialReference.wkid}).then(h.hitch(this,function(a){if(this.isGeographic&&!this.map.spatialReference.isWebMercator()&&4326!==this.spatialReference.wkid){var g=[];d.forEach(a,function(a){g.push(a.location)});var b=1<g.length?e.union(g):e.buffer(g[0],100,9001);this._projectPoints(b,g).then(function(g){for(var b=0;b<a.length;b++)a[b].location=g[b];c.resolve(a)})}else c.resolve(a)}),function(a){c.reject(a)})}));return c},_xyData:function(a){var c=new l,g=[],b=a.csvStore;
d.forEach(a.storeItems,h.hitch(this,function(c){var e=c._csvId,z=null,k;a:for(k in this.duplicateData){var x=this.duplicateData[k];if(x.fileId===e){z=h.mixin({},x);delete this.duplicateData[k];break a}}var r={};k=b.getAttributes(c);d.forEach(k,function(a){r[a]=b.getValue(c,a)});k=!1;var f,q;null!==z&&z.feature&&z.feature.geometry?(x=z.feature.geometry,k=!0,q=z.feature.attributes):(f=b.getValue(c,a.xFieldName),z=b.getValue(c,a.yFieldName),"."!==this.decimalSeperator&&(f=-1!==[null,void 0,""].indexOf(f)?
void 0:f.toString().replace(this.decimalSeperator,"."),z=-1!==[null,void 0,""].indexOf(z)?void 0:z.toString().replace(this.decimalSeperator,".")),f=parseFloat(f),z=parseFloat(z),x=this._getGeometry(f,z),f=100);x&&g.push({attributes:r,location:x,csvIndex:e,score:f,isDuplicate:k,featureAttributes:q})}));c.resolve(g);return c},_getGeometry:function(a,c){"undefined"===typeof this.isGeographic&&(this.isGeographic=/(?=^[-]?\d{1,3}\.)^[-]?\d{1,3}\.\d+|(?=^[-]?\d{4,})|^[-]?\d{1,3}/.exec(a)?!0:!1);var g;isNaN(a)||
isNaN(c)||(g=new m(a,c),this.isGeographic&&this.spatialReference.isWebMercator()?g=v.geographicToWebMercator(g):g.spatialReference=this.isGeographic&&4326!==this.spatialReference.wkid?new k(4326):new k({wkid:this.spatialReference.wkid}));return g},_projectPoints:function(a,b){var e=new l;this.gsvc=new c(this.appConfig.geometryService);a={url:this.gsvc.url+"/findTransformations",content:{f:"json",inSR:a.spatialReference.wkid,outSR:this.spatialReference.wkid,extentOfInterest:JSON.stringify(a.getExtent().toJson())},
handleAs:"json",callbackParamName:"callback"};x(a,{usePost:!1}).then(h.hitch(this,function(a){a=(a=a&&a.transformations?a.transformations:void 0)&&0<a.length?a[0].wkid:void 0;var c=new g;c.outSR=this.spatialReference;c.geometries=b;c.transformForward=!0;c.transformation=a;this.gsvc.project(c,h.hitch(this,function(a){e.resolve(a)}),function(a){e.reject(a)})}),function(a){e.reject(a)});return e},_generateFC:function(a){var c={layerDefinition:{geometryType:"esriGeometryPoint",spatialReference:this.spatialReference,
objectIdField:this.objectIdField,type:"Feature Layer",drawingInfo:{renderer:{type:"simple",symbol:this.symbol}},fields:[{name:this.objectIdField,alias:this.objectIdField,type:"esriFieldTypeOID"}]},featureSet:{features:a,geometryType:"esriGeometryPoint"}};d.forEach(this.fsFields,h.hitch(this,function(a){c.layerDefinition.fields.push({name:a.name,alias:a.label,type:a.value,editable:!0,domain:null})}));return c},clear:function(){this._removeLayer(this.matchedFeatureLayer);this._removeLayer(this.unMatchedFeatureLayer);
this._removeLayer(this.duplicateFeatureLayer);this.storeItems=this.csvStore=this.separatorCharacter=this.data=this.fsFields=this.file=void 0;this.duplicateData=[];this.mappedArrayFields=this.duplicateFeatureLayer=this.unMatchedFeatureLayer=this.matchedFeatureLayer=void 0;this.useAddr=!0;this.yFieldName=this.xFieldName=this.addrFieldName=""},_removeLayer:function(a){a&&(this.map.removeLayer(a),a.clear())},_getSeparator:function(){var a=this.data.indexOf("\n"),c=h.trim(this.data.substr(0,a)),g=0,b=
"";d.forEach([",","      ",";","|"],function(a){var e=c.split(a).length;e>g&&(g=e,b=a)});this.separatorCharacter=b},_getCsvStore:function(){var a=new l;this.csvStore=new p({data:this.data,separator:this.separatorCharacter});this.csvStore.fetch({onComplete:h.hitch(this,function(c){this.storeItems=c;this._fetchFieldsAndUpdateForm(this.storeItems,this.csvStore,this.fsFields).then(function(c){a.resolve(c)})}),onError:function(c){console.error("Error fetching items from CSV store: ",c);a.reject(c)}});
return a},_fetchFieldsAndUpdateForm:function(a,c,g){var b=new l,e=c._attributes,k=this.decimalSeperator,x={};d.forEach(e,function(g){d.forEach(a,function(a){var b=!0,e=!0,r=!0,f=!0,q;x.hasOwnProperty(g)&&(e=x[g].supportsInt,r=x[g].supportsFloat,f=x[g].supportsDate,q=x[g].maxLength,e||r||f||(b=!1));var B=c.getValue(a,g);if(B){a=B.toString().length;var m=z(B);if(b){b=-1!==[null,void 0,""].indexOf(B);if(!b&&(f=f&&m.isValid()))if(m=B)try{f=!isNaN((new Date(m)).getTime())}catch(F){console.error(F),f=!1}else f=
-1<[null,void 0,""].indexOf(m)?!0:!1;x[g]={supportsDate:f,supportsInt:b?e:!isNaN(parseInt(B,10))&&parseInt(B,10).toString().length===a&&e};"."!==k&&(B=b?"":B.toString().replace(k,"."));x[g].supportsFloat=b?r:!isNaN(parseFloat(B))&&parseFloat(B).toString().length===a&&r}e=x[g];e.maxLength=q;"undefined"===typeof e.maxLength?e.maxLength=a:e.maxLength<a&&(e.maxLength=a)}})});b.resolve({fields:e,fieldTypes:x,fsFields:g});return b},_zoomToData:function(a,c){if(a&&0<a.length)try{var g=A.graphicsExtent(a);
c?this.map.setExtent(g.expand(1.9),!0):this.map.setExtent(g,!0)}catch(E){console.log(E.message)}},_convertSources:function(){this.geocodeSources&&0<this.geocodeSources.length&&(this._geocodeSources=d.map(this.geocodeSources,h.hitch(this,function(c){if(c&&c.url&&"locator"===c.type)return{locator:new a(c.url||""),outFields:["ResultID","Score"],singleLineFieldName:c.singleLineFieldName||"",name:r.stripHTML(c.name||""),placeholder:r.stripHTML(c.placeholder||""),countryCode:c.countryCode||"",addressFields:c.addressFields,
singleEnabled:c.singleEnabled||!1,multiEnabled:c.multiEnabled||!1,minCandidateScore:c.minCandidateScore||90}})))}})})},"dojox/data/CsvStore":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),function(t,d,h,l,n,w){d=d("dojox.data.CsvStore",null,{constructor:function(d){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=!1;d.url&&(this.url=d.url);
this._csvData=d.data;d.label?this.label=d.label:""===this.label&&(this.label=void 0);this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=d.identifier;""===this.identifier?delete this.identifier:this._idMap={};"separator"in d&&(this.separator=d.separator);"urlPreventCache"in d&&(this.urlPreventCache=d.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",separator:",",urlPreventCache:!1,
_assertIsItem:function(d){if(!this.isItem(d))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");},_getIndex:function(d){d=this.getIdentity(d);this.identifier&&(d=this._idMap[d]);return d},getValue:function(d,h,l){this._assertIsItem(d);var p=l;if("string"===typeof h)h=this._attributeIndexes[h],null!=h&&(p=this._dataArray[this._getIndex(d)][h]||l);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");return p},
getValues:function(d,h){return(d=this.getValue(d,h))?[d]:[]},getAttributes:function(d){this._assertIsItem(d);var h=[];d=this._dataArray[this._getIndex(d)];for(var p=0;p<d.length;p++)""!==d[p]&&h.push(this._attributes[p]);return h},hasAttribute:function(d,h){this._assertIsItem(d);if("string"===typeof h)return h=this._attributeIndexes[h],d=this._dataArray[this._getIndex(d)],"undefined"!==typeof h&&h<d.length&&""!==d[h];throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");
},containsValue:function(d,h,l){var p=void 0;"string"===typeof l&&(p=n.patternToRegExp(l,!1));return this._containsValue(d,h,l,p)},_containsValue:function(d,h,l,n){d=this.getValues(d,h);for(h=0;h<d.length;++h){var p=d[h];if("string"===typeof p&&n)return null!==p.match(n);if(l===p)return!0}return!1},isItem:function(d){if(d&&d[this._storeProp]===this)if(d=d[this._idProp],this.identifier){if(this._dataArray[this._idMap[d]])return!0}else if(0<=d&&d<this._dataArray.length)return!0;return!1},isItemLoaded:function(d){return this.isItem(d)},
loadItem:function(d){},getFeatures:function(){return this._features},getLabel:function(d){if(this.label&&this.isItem(d))return this.getValue(d,this.label)},getLabelAttributes:function(d){return this.label?[this.label]:null},_fetchItems:function(d,l,u){var p=this,v=function(a,k){var b=null;if(a.query){var e,g,b=[],c=a.queryOptions?a.queryOptions.ignoreCase:!1,x={};for(e in a.query)g=a.query[e],"string"===typeof g&&(x[e]=n.patternToRegExp(g,c));for(c=0;c<k.length;++c){var r=!0,z=k[c];for(e in a.query)g=
a.query[e],p._containsValue(z,e,g,x[e])||(r=!1);r&&b.push(z)}}else b=k.slice(0,k.length);l(b,a)};if(this._loadFinished)v(d,this._arrayOfAllItems);else if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:d,filter:v});else{this._loadInProgress=!0;var m=h.get({url:p.url,handleAs:"text",preventCache:p.urlPreventCache});m.addCallback(function(a){try{p._processData(a),v(d,p._arrayOfAllItems),p._handleQueuedFetches()}catch(k){u(k,d)}});m.addErrback(function(a){p._loadInProgress=!1;if(u)u(a,
d);else throw a;});var f=null;d.abort&&(f=d.abort);d.abort=function(){var a=m;a&&-1===a.fired&&(a.cancel(),a=null);f&&f.call(d)}}else if(this._csvData)try{this._processData(this._csvData),this._csvData=null,v(d,this._arrayOfAllItems)}catch(b){u(b,d)}else{var a=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(u)u(a,d);else throw a;}},close:function(d){},_getArrayOfArraysFromCsvFileContents:function(d){if(t.isString(d)){var h=/^\s+/g,l=/\s+$/g,p=/""/g,
v=[],m=this._splitLines(d);for(d=0;d<m.length;++d){var f=m[d];if(0<f.length){for(var f=f.split(this.separator),a=0;a<f.length;){var b=f[a].replace(h,""),k=b.replace(l,""),q=k.charAt(0),e=k.charAt(k.length-1),g=k.charAt(k.length-2),c=k.charAt(k.length-3);if(2===k.length&&'""'==k)f[a]="";else if('"'==q&&('"'!=e||'"'==e&&'"'==g&&'"'!=c)){if(a+1===f.length)return;f[a]=b+this.separator+f[a+1];f.splice(a+1,1)}else'"'==q&&'"'==e&&(k=k.slice(1,k.length-1),k=k.replace(p,'"')),f[a]=k,a+=1}v.push(f)}}this._attributes=
v.shift();for(d=0;d<this._attributes.length;d++)this._attributeIndexes[this._attributes[d]]=d;this._dataArray=v}},_splitLines:function(d){var h=[],l,p="",v=!1;for(l=0;l<d.length;l++){var m=d.charAt(l);switch(m){case '"':v=!v;p+=m;break;case "\r":v?p+=m:(h.push(p),p="",l<d.length-1&&"\n"==d.charAt(l+1)&&l++);break;case "\n":v?p+=m:(h.push(p),p="");break;default:p+=m}}""!==p&&h.push(p);return h},_processData:function(d){this._getArrayOfArraysFromCsvFileContents(d);this._arrayOfAllItems=[];if(this.identifier&&
void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");for(d=0;d<this._dataArray.length;d++){var h=d;this.identifier&&(h=this._dataArray[d][this._attributeIndexes[this.identifier]],this._idMap[h]=d);this._arrayOfAllItems.push(this._createItemFromIdentity(h))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(d){var h={};h[this._storeProp]=this;h[this._idProp]=d;return h},getIdentity:function(d){return this.isItem(d)?
d[this._idProp]:null},fetchItemByIdentity:function(d){var p,u=d.scope?d.scope:l.global;if(this._loadFinished)p=this._createItemFromIdentity(d.identity),this.isItem(p)||(p=null),d.onItem&&d.onItem.call(u,p);else{var n=this;if(""!==this.url)this._loadInProgress?this._queuedFetches.push({args:d}):(this._loadInProgress=!0,p=h.get({url:n.url,handleAs:"text"}),p.addCallback(function(h){try{n._processData(h);var m=n._createItemFromIdentity(d.identity);n.isItem(m)||(m=null);d.onItem&&d.onItem.call(u,m);n._handleQueuedFetches()}catch(f){d.onError&&
d.onError.call(u,f)}}),p.addErrback(function(h){this._loadInProgress=!1;d.onError&&d.onError.call(u,h)}));else if(this._csvData)try{n._processData(n._csvData),n._csvData=null,p=n._createItemFromIdentity(d.identity),n.isItem(p)||(p=null),d.onItem&&d.onItem.call(u,p)}catch(v){d.onError&&d.onError.call(u,v)}}},getIdentityAttributes:function(d){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var d=0;d<this._queuedFetches.length;d++){var h=
this._queuedFetches[d],l=h.filter,n=h.args;l?l(n,this._arrayOfAllItems):this.fetchItemByIdentity(h.args)}this._queuedFetches=[]}}});t.extend(d,w);return d})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(t,d,h,l,n,w,p,y,u,A,v){t=t(A,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],
"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(m){this._geocodeHandler=d.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=d.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=d.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(d){this.outSpatialReference=d},_geocodeHandler:function(d,
f,a,b,k){try{var q=d.candidates,e;f=[];var g,c=q.length,x=d.spatialReference,r;for(g=0;g<c;g++){e=q[g];if(r=e.location)r.spatialReference=x;f[g]=new v(e)}this._successHandler([f],"onAddressToLocationsComplete",a,k)}catch(z){this._errorHandler(z,b,k)}},_geocodeAddressesHandler:function(d,f,a,b,k){try{var q=d.locations;f=[];var e,g=q.length,c=d.spatialReference,x;for(e=0;e<g;e++){if(x=q[e].location)x.spatialReference=c;f[e]=new v(q[e])}this._successHandler([f],"onAddressesToLocationsComplete",a,k)}catch(r){this._errorHandler(r,
b,k)}},addressToLocations:function(h,f,a,b,k){var q,e,g,c,x,r,z;h.address&&(b=a,a=f,f=h.outFields,k=h.searchExtent,z=h.countryCode,q=h.magicKey,e=h.distance,r=h.categories,h.location&&this.normalization&&(g=h.location.normalize()),c=h.maxLocations,x=h.forStorage,h=h.address);k&&(k=k.shiftCentralMeridian());var B=this.outSpatialReference;h=this._encode(d.mixin({},this._url.query,h,{f:"json",outSR:B&&n.toJson(B.toJson()),outFields:f&&f.join(",")||null,searchExtent:k&&n.toJson(k.toJson()),category:r&&
r.join(",")||null,countryCode:z||null,magicKey:q||null,distance:e||null,location:g||null,maxLocations:c||null,forStorage:x||null}));var m=this._geocodeHandler,D=this._errorHandler,v=new l(u._dfdCanceller);v._pendingDfd=y({url:this._url.path+"/findAddressCandidates",content:h,callbackParamName:"callback",load:function(c,g){m(c,g,a,b,v)},error:function(a){D(a,b,v)}});return v},suggestLocations:function(h){var f;f=new l(u._dfdCanceller);h.hasOwnProperty("location")&&this.normalization&&(h.location=h.location.normalize());
h.searchExtent&&(h.searchExtent=h.searchExtent.shiftCentralMeridian());h=this._encode(d.mixin({},this._url.query,{f:"json",text:h.text,maxSuggestions:h.maxSuggestions,searchExtent:h.searchExtent&&n.toJson(h.searchExtent.toJson()),category:h.categories&&h.categories.join(",")||null,countryCode:h.countryCode||null,location:h.location||null,distance:h.distance||null},{f:"json"}));h=y({url:this._url.path+"/suggest",content:h,callbackParamName:"callback"});f._pendingDfd=h;h.then(d.hitch(this,function(a){a=
a.suggestions||[];this.onSuggestLocationsComplete(a);f.resolve(a)}),d.hitch(this,function(a){this._errorHandler(a);f.reject(a)}));return f},addressesToLocations:function(m,f,a){var b=this.outSpatialReference,k=[],q=m.categories,e=m.countryCode;h.forEach(m.addresses,function(a,c){k.push({attributes:a})});m=this._encode(d.mixin({},this._url.query,{category:q&&q.join(",")||null,sourceCountry:e||null},{addresses:n.toJson({records:k})},{f:"json",outSR:b&&n.toJson(b.toJson())}));var g=this._geocodeAddressesHandler,
c=this._errorHandler,x=new l(u._dfdCanceller);x._pendingDfd=y({url:this._url.path+"/geocodeAddresses",content:m,callbackParamName:"callback",load:function(c,e){g(c,e,f,a,x)},error:function(g){c(g,a,x)}});return x},_reverseGeocodeHandler:function(d,f,a,b,k){try{var q=new v({address:d.address,location:d.location,score:100});this._successHandler([q],"onLocationToAddressComplete",a,k)}catch(e){this._errorHandler(e,b,k)}},locationToAddress:function(h,f,a,b){h&&this.normalization&&(h=h.normalize());var k=
this.outSpatialReference;h=this._encode(d.mixin({},this._url.query,{outSR:k&&n.toJson(k.toJson()),location:h&&n.toJson(h.toJson()),distance:f,f:"json"}));var q=this._reverseGeocodeHandler,e=this._errorHandler,g=new l(u._dfdCanceller);g._pendingDfd=y({url:this._url.path+"/reverseGeocode",content:h,callbackParamName:"callback",load:function(c,e){q(c,e,a,b,g)},error:function(a){e(a,b,g)}});return g},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},
onLocationToAddressComplete:function(){}});w("extend-esri")&&d.setObject("tasks.Locator",t,p);return t})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(t,d,h,l,n){t=t(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(h){d.mixin(this,h);this.location=new n(this.location)}});h("extend-esri")&&d.setObject("tasks.AddressCandidate",t,l);return t})},"widgets/DataAggregation/js/UI/Addresses":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/Addresses.html dijit/form/Select dijit/form/RadioButton".split(" "),
function(t,d,h,l,n,w,p,y,u,A,v,m){return t([p,y,u,A],{baseClass:"cf-addresses",declaredClass:"CriticalFacilities.Addresses",templateString:v,_started:null,label:"Addresses",parent:null,nls:null,map:null,appConfig:null,config:null,singleFields:[],multiFields:[],fields:[],useSingle:!0,useMulti:!1,theme:"",isDarkTheme:"",styleColor:"",singleEnabled:!1,multiEnabled:!1,constructor:function(f){d.mixin(this,f)},postCreate:function(){this.inherited(arguments);this._initControls()},startup:function(){this._started=
!0;this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=!1},validate:function(f,a){var b=new w;"next-view"===f?b.resolve(this._nextView(a)):"back-view"===f?b.resolve(this._backView(a)):this._homeView(a).then(function(a){b.resolve(a)});return b},_updateAltIndexes:function(){this.pageContainer&&!this._startPageView&&(this._startPageView=this.pageContainer.getViewByTitle("StartPage"),this._locationTypeView=this.pageContainer.getViewByTitle("LocationType"),this._startPageView&&
this._locationTypeView?(this.altNextIndex=this._startPageView.index,this.altBackIndex=this._locationTypeView.index):this._startPageView&&(this.altBackIndex=this.altNextIndex=this._startPageView.index))},_nextView:function(f){if(f.currentView.label===this.label){f=this._getResults();var a=!1;h.forEach(f.fields,function(b){"undefined"!==typeof b.value&&null!==b.value&&""!==b.value&&(a=!0)});this.parent._locationMappingComplete=a;this.emit("location-mapping-update",a)}return!0},_backView:function(f){f.currentView.label===
this.label&&(this.parent._locationMappingComplete=!1,this.emit("location-mapping-update",!1));return!0},_homeView:function(f){var a=new w;this.pageContainer.getViewByTitle("Home").verifyClearSettings(f).then(function(b){a.resolve(b)});return a},_rdoSingleAddressClick:function(){this.rdoSingleAddress.set("checked",!0)},_rdoSingleAddressChanged:function(f){this.useSingle=f;this._toggleVisibility(this.singleFieldTable,f)},_rdoMultiAddressClick:function(){this.rdoMultiAddress.set("checked",!0)},_rdoMultiAddressChanged:function(f){this.useMulti=
f;this._toggleVisibility(this.multiFieldTable,f)},_toggleVisibility:function(f,a){var b=a?"display-table-row-group":"display-none";n.contains(f,b)||n.add(f,b);a=a?"display-none":"display-table-row-group";n.contains(f,a)&&n.remove(f,a)},_initControls:function(){var f=this.singleEnabled,a=this.multiEnabled;f&&a?(this.rdoSingleAddress.set("checked",this.useSingle),this._toggleVisibility(this.singleFieldTable,this.useSingle),this.rdoMultiAddress.set("checked",this.useMulti),this._toggleVisibility(this.multiFieldTable,
this.useMulti),this._setFields(this.singleFields,this.fields,this.singleFieldTable),this._setFields(this.multiFields,this.fields,this.multiFieldTable),n.contains(this.singleSubTaskHintTr,"bottom-border-bold")&&n.remove(this.singleSubTaskHintTr,"bottom-border-bold"),n.add(this.singleSubTaskHintTr,"bottom-border")):f?(this.useSingle=!0,this.useMulti=!1,this._setFields(this.singleFields,this.fields,this.singleFieldTable),this._initTableDisplay([this.multiAddressRow,this.mainInstructionRow,this.singleRadioRow],
[this.singleFieldHintTd,this.singleFieldTableRow],[],[this.singleSubTaskHintTd])):a&&(this.useMulti=!0,this.useSingle=!1,this._setFields(this.multiFields,this.fields,this.multiFieldTable),this._initTableDisplay([this.singleAddressRow,this.mainInstructionRow,this.multiRadioRow],[this.multiFieldHintTd,this.multiFieldTableRow],[],[this.multiSubTaskHintTd]))},_initTableDisplay:function(f,a,b,k){h.forEach(f,d.hitch(this,function(a){this._toggleVisibility(a,!1)}));h.forEach(a,d.hitch(this,function(a){n.add(a,
"no-padding")}));h.forEach(b,d.hitch(this,function(a){n.add(a,"pad-bottom-10")}));h.forEach(k,function(a){n.contains(a,"pad-left-20")&&n.remove(a,"pad-left-20");n.add(a,"pad-left-5")})},_setFields:function(f,a,b){var k=0;h.forEach(f,d.hitch(this,function(d){var e=l.create("tr",{},b);e.keyField=d.value;e.label=d.label;var g=l.create("td",{className:"field-control-td pad-left-15"},e);l.create("div",{className:"main-text float-left min-width-80",innerHTML:d.label},g);var g=l.create("td",{className:"field-control-td"},
e),c=new m({name:"field"+k,fieldName:d.label,className:"field-control"}),x=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}],r=this._getDefaultFieldName(a,d);h.forEach(a,function(a){x.push({label:a.label,value:a.value,selected:a.value===r})});c.addOption(x);c.placeAt(g);c.startup();e.fieldControl=c;k+=1;1<f.length&&n.add(e,"bottom-border")}))},_getDefaultFieldName:function(f,a){a=a.isRecognizedValues;for(var b=0;b<a.length;b++)for(var k=a[b],d=0;d<f.length;d++){var e=
f[d];if(e.value.toString().toUpperCase()===k.toString().toUpperCase())return e.value}},setStyleColor:function(f){this.styleColor=f},updateImageNodes:function(){},updateTheme:function(f){this.theme=f},_getResults:function(){var f=[],a={},b=this.nls.warningsAndErrors.noValue;h.forEach((this.useSingle?this.singleFieldTable:this.multiFieldTable).rows,function(k){var d=k.fieldControl.get("value"),e=k.label;k=k.keyField;d!==b?(f.push({keyField:k,value:d,label:e}),a[k]=d):(f.push({keyField:k,value:void 0,
label:e}),a[k]=void 0)});return{type:this.useSingle?"single":"multi",fields:f,mappedArrayFields:a}}})})},"widgets/DataAggregation/js/UI/Coordinates":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/dom-construct dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/Coordinates.html dojo/_base/array dijit/form/Select".split(" "),function(t,d,h,l,n,w,p,y,u,A,v){return t([n,w,p,y],{baseClass:"cf-coordinates",declaredClass:"CriticalFacilities.Coordinates",
templateString:u,_started:null,label:"Coordinates",parent:null,nls:null,map:null,appConfig:null,config:null,fields:[],xField:null,yField:null,theme:"",isDarkTheme:"",styleColor:"",firstField:"",constructor:function(h){d.mixin(this,h)},postCreate:function(){this.inherited(arguments);this._initUI()},_initUI:function(){"X"===this.firstField?(this._initXField(),this._initYField()):(this._initYField(),this._initXField());this._setFields(this.fields,this.xField,this.yField)},_initXField:function(){var d=
this._initSelectTd(this.xField.label+":");this.lblX=d.label;this.selectX=new v({name:"selectX",style:"min-width: 200px"});this.selectX.placeAt(d.select);this.selectX.startup()},_initYField:function(){var d=this._initSelectTd(this.yField.label+":");this.lblY=d.label;this.selectY=new v({name:"selectY",style:"min-width: 200px"});this.selectY.placeAt(d.select);this.selectY.startup()},_initSelectTd:function(d){var f=l.create("tr",{className:"bottom-border"},this.coordinateTable),a=l.create("td",{className:"field-control-td pad-left-10"},
f),a=l.create("div",{className:"main-text float-left"},a);a.innerHTML=d;return{select:l.create("td",{className:"float-right field-control-td"},f),label:a}},startup:function(){this._started=!0;this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=!1},validate:function(d,f){var a=new h;"next-view"===d?a.resolve(this._nextView(f)):"back-view"===d?a.resolve(this._backView(f)):this._homeView(f).then(function(b){a.resolve(b)});return a},_updateAltIndexes:function(){this.pageContainer&&
!this._startPageView&&(this._startPageView=this.pageContainer.getViewByTitle("StartPage"),this._locationTypeView=this.pageContainer.getViewByTitle("LocationType"),this._startPageView&&this._locationTypeView?(this.altNextIndex=this._startPageView.index,this.altBackIndex=this._locationTypeView.index):this._startPageView&&(this.altBackIndex=this.altNextIndex=this._startPageView.index))},_nextView:function(d){d.currentView.label===this.label&&(d=0<this._getResults().fields.length,this.parent._locationMappingComplete=
d,this.emit("location-mapping-update",d));return!0},_backView:function(d){d.currentView.label===this.label&&(this.parent._locationMappingComplete=!1,this.emit("location-mapping-update",!1));return!0},_homeView:function(d){var f=new h;this.pageContainer.getViewByTitle("Home").verifyClearSettings(d).then(function(a){f.resolve(a)});return f},_setFields:function(d,f,a){var b=this._getDefaultFieldName(d,f),k=this._getDefaultFieldName(d,a),q=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}],
e=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}];A.forEach(d,function(a){q.push({label:a.label,value:a.value,selected:b===a.value});e.push({label:a.label,value:a.value,selected:k===a.value})});this.selectX.addOption(q);this.selectY.addOption(e)},_getDefaultFieldName:function(d,f){f=f.isRecognizedValues;for(var a=0;a<f.length;a++)for(var b=f[a],k=0;k<d.length;k++){var q=d[k];if(q.value.toString().toUpperCase()===b.toString().toUpperCase())return q.value}},setStyleColor:function(d){this.styleColor=
d},updateImageNodes:function(){},updateTheme:function(d){this.theme=d},_getResults:function(){return{type:"xy",fields:this.selectX.value!==this.nls.warningsAndErrors.noValue&&this.selectY.value!==this.nls.warningsAndErrors.noValue?[{targetField:"X",sourceField:this.selectX.value},{targetField:"Y",sourceField:this.selectY.value}]:[]}}})})},"widgets/DataAggregation/js/UI/FieldMapping":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/FieldMapping.html jimu/dijit/SimpleTable dijit/form/Select".split(" "),
function(t,d,h,l,n,w,p,y,u,A,v,m,f){return t([p,y,u,A],{baseClass:"cf-field-mapping",declaredClass:"CriticalFacilities.FieldMapping",templateString:v,_started:null,label:"FieldMapping",parent:null,nls:null,map:null,appConfig:null,config:null,targetFields:[],sourceFields:[],_fieldsTable:null,theme:"",isDarkTheme:"",styleColor:"",constructor:function(a){d.mixin(this,a)},postCreate:function(){this.inherited(arguments);this._initFieldsTable();this._initFields(this.targetFields)},startup:function(){this._started=
!0;this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=!1},_updateAltIndexes:function(){this.pageContainer&&!this._startPageView&&(this._startPageView=this.pageContainer.getViewByTitle("StartPage"))&&(this.altBackIndex=this.altNextIndex=this._startPageView.index)},validate:function(a,b){var k=new w;"next-view"===a?k.resolve(this._nextView(b)):"back-view"===a?k.resolve(this._backView(b)):this._homeView(b).then(function(a){k.resolve(a)});return k},_nextView:function(a){if(a.currentView.label===
this.label){var b=this._getResults(),k=!1;a=Object.keys(b.results).map(function(a){return b.results[a]});h.forEach(a,function(a){"undefined"!==typeof a&&null!==a&&""!==a&&(k=!0)});this.parent._fieldMappingComplete=k;this.emit("field-mapping-update",k,b.results)}return!0},_backView:function(a){a.currentView.label===this.label&&(this.parent._fieldMappingComplete=!1,this.emit("field-mapping-update",!1));return!0},_homeView:function(a){var b=new w;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});
return b},_initFieldsTable:function(){var a=[{name:"targetField",type:"extension",hidden:!0,create:d.hitch(this,this._createTargetField),setValue:d.hitch(this,this._setTargetFieldValue),getValue:d.hitch(this,this._getTargetFieldValue)},{name:"target",title:this.nls.fieldMapping.targetField,type:"text","class":"task-instruction-row"},{name:"label",title:this.nls.fieldMapping.sourceField,type:"extension",hidden:!1,create:d.hitch(this,this._createSelect),setValue:d.hitch(this,this._setSelectValue),getValue:d.hitch(this,
this._getSelectValue)}];this._fieldsTable=new m({fields:a,selectable:!1,autoHeight:!0});this._fieldsTable.placeAt(this.fieldMappingTable);this._fieldsTable.startup()},_setTargetFieldValue:function(a,b){a.targetField=b},_getTargetFieldValue:function(a){return a.targetField},_createSelect:function(a){var b=new f({style:{display:"table",width:"100%",height:"28px"}}),k=a.parentNode.cells[0].targetField,d=this._getSupportedFields(this.sourceFields,k.type,k.length),e=[{label:this.nls.warningsAndErrors.noValue,
value:this.nls.warningsAndErrors.noValue}],g=this._getDefaultFieldName(d,k);h.forEach(d,function(a){e.push({label:a.label,value:a.value,selected:g===a.value})});b.addOption(e);a.fieldsSelect=b;l.place(b.domNode,a);n.add(a,"float-left");n.add(a,"width-all")},_getSelectValue:function(a){return a.fieldsSelect.get("value")},_setSelectValue:function(a,b){a.fieldsSelect.set("value",b)},_initFields:function(a){h.forEach(a,d.hitch(this,function(a){this._fieldsTable.addRow({target:a.label,targetField:a})}))},
_getSupportedFields:function(a,b,k){return a.filter(function(a){if(a.type){var e=a.type.supportsInt,g=a.type.supportsFloat,c=a.type.supportsDate;a=a.type.maxLength;return"date"!==b&&a>k?!1:"other"===b||"domain"===b?!0:"int"===b||"domainInt"===b?e:"float"===b?g:"date"===b?c:!1}return!1})},_getDefaultFieldName:function(a,b){b=b.isRecognizedValues;for(var k=0;k<b.length;k++)for(var d=b[k],e=0;e<a.length;e++){var g=a[e];if(g.value.toString().toUpperCase()===d.toString().toUpperCase())return g.value}},
setStyleColor:function(a){this.styleColor=a},updateImageNodes:function(){},updateTheme:function(a){this.theme=a},_getResults:function(){var a=this._fieldsTable.getRows(),b={},k=this.nls.warningsAndErrors.noValue,d=!1,e;h.forEach(a,function(a){var c=a.cells[2].fieldsSelect.getValue();c!==k?(a=a.cells[0].targetField.name,b[a]=c,d||(e=a,d=!0)):b[a.cells[0].targetField.name]=void 0});return{results:b,labelField:e}}})})},"widgets/DataAggregation/js/UI/StartPage":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/StartPage.html dojo/dom-class dojo/query esri/lang ./Review jimu/utils".split(" "),
function(t,d,h,l,n,w,p,y,u,A,v,m,f,a,b){return t([w,p,y,u],{baseClass:"cf-startpage",declaredClass:"CriticalFacilities.StartPage",templateString:A,_started:null,label:"StartPage",parent:null,nls:null,map:null,appConfig:null,config:null,theme:"",isDarkTheme:"",styleColor:"",state:"mapping",csvStore:null,_syncFields:{},singleEnabled:!1,multiEnabled:!1,xyEnabled:!1,constructor:function(a){d.mixin(this,a)},postCreate:function(){this.inherited(arguments);this._darkThemes=["DartTheme","DashboardTheme"];
this.locationAndFieldHint.innerHTML=f.substitute({layerName:this.parent.editLayer.name},this.nls.startPage.locationAndFieldHint);this.updateImageNodes()},startup:function(){this._started=!0;this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?!1:!0},onShown:function(){this._initDependencies();this._validateStatus();this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?!1:!0},setStyleColor:function(a){this.styleColor=a},updateImageNodes:function(){var a=-1<this._darkThemes.indexOf(this.theme),
b=a?"next-arrow-img":"next-arrow-img-white",e=a?"next-arrow-img-white":"next-arrow-img",a=m("."+b,this.domNode);h.forEach(a,function(a){v.remove(a,b);v.add(a,e)})},updateTheme:function(a){this.theme=a;this.updateImageNodes()},validate:function(a,b){var e=new n;"next-view"===a?e.resolve(this._nextView(b)):"back-view"===a?e.resolve(this._backView()):"home-view"===a&&this._homeView(b).then(function(a){e.resolve(a)});return e},_nextView:function(a){a.navView.label===this.label&&this.pageContainer.toggleController(!1);
if(this.parent._locationMappingComplete&&this.parent._fieldMappingComplete)return this.nextDisabled=!0,!1;this.pageContainer.backDisabled=!1;return!0},_backView:function(){return 0<this.pageContainer._backLabels.length},_homeView:function(a){var b=new n;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});return b},_locationMappingClick:function(){this._validateStatus();this._setViewByTitle(this.xyEnabled&&(this.multiEnabled||this.singleEnabled)?"LocationType":
this.xyEnabled?"Coordinates":"Addresses")},_schemaMappingClick:function(){this._validateStatus();this._setViewByTitle("FieldMapping")},_setViewByTitle:function(a){a=this.pageContainer.getViewByTitle(a);this.pageContainer.selectView(a.index)},_initDependencies:function(){if(this.pageContainer&&!this._coordinatesView&&!this._addressView&&!this._fieldMappingView){this.xyEnabled&&(this._coordinatesView=this.pageContainer.getViewByTitle("Coordinates"),this.own(l(this._coordinatesView,"location-mapping-update",
d.hitch(this,function(a){this.parent._locationMappingComplete=a;this._validateStatus()}))));if(this.singleEnabled||this.multiEnabled)this._addressView=this.pageContainer.getViewByTitle("Addresses"),this.own(l(this._addressView,"location-mapping-update",d.hitch(this,function(a){this.parent._locationMappingComplete=a;this._validateStatus()})));this._fieldMappingView=this.pageContainer.getViewByTitle("FieldMapping");this.own(l(this._fieldMappingView,"field-mapping-update",d.hitch(this,function(a){this.parent._fieldMappingComplete=
a;this._validateStatus()})));(this._locationTypeView=this.xyEnabled&&(this.singleEnabled||this.multiEnabled)?this.pageContainer.getViewByTitle("LocationType"):this.xyEnabled?this._coordinatesView:this._addressView)&&!this.parent._locationMappingComplete&&(this.altNextIndex=this._locationTypeView.index)}},_validateStatus:function(){this._updateNode(this.locationMappingComplete,this.parent._locationMappingComplete);this._updateNode(this.fieldMappingComplete,this.parent._fieldMappingComplete);var a=
this.pageContainer.backDisabled=!1;this.parent._locationMappingComplete&&this.parent._fieldMappingComplete&&"mapping"===this.state?(a=!0,this.pageContainer.nextDisabled=!0):!this.parent._locationMappingComplete&&this._locationTypeView?this.altNextIndex=this._locationTypeView.index:!this.parent._fieldMappingComplete&&this._fieldMappingView&&(this.altNextIndex=this._fieldMappingView.index);a||(this.pageContainer.nextDisabled=!1);this._updateNode(this.addToMapButton,a)},_updateNode:function(a,b){b?v.contains(a,
"display-none")&&v.remove(a,"display-none"):v.contains(a,"display-none")||v.add(a,"display-none")},_addToMapClick:function(){this._updateNode(this.addToMapButton,!1);this._updateNode(this.progressNode,!0);var a=this._fieldMappingView._getResults(),b=this._locationTypeView._getResults();this._syncFields=this._checkFields(a.results,b);this._locateFeatures(a,b)},_checkFields:function(a,b){var e={};b&&b.fields&&h.forEach(b.fields,function(g){var c=g.value?g.value:g.sourceField;g=g.keyField?g.keyField:
g.sourceField;if("undefined"!==typeof c&&"undefined"!==typeof g&&!e.hasOwnProperty(c)&&a)for(var b=Object.keys(a),r=0;r<b.length;r++)if(a[b[r]]===c){e[g]={layerFieldName:b[r]};break}});return e},_locateFeatures:function(a,b){this.csvStore.useMultiFields="multi"===b.type?!0:!1;this.csvStore.mappedArrayFields=a.results;this.csvStore.labelField=a.labelField;if("single"===b.type)this.csvStore.addrFieldName=b.fields[0].keyField,this.csvStore.singleFields=b.fields;else if("multi"===b.type)this.csvStore.multiFields=
b.fields;else if("xy"===b.type){this.csvStore.useAddr=!1;var e=b.fields[0];b=b.fields[1];this.csvStore.xFieldName="X"===e.targetField?e.sourceField:b.sourceField;this.csvStore.yFieldName="Y"===b.targetField?b.sourceField:e.sourceField}this.csvStore.processForm().then(d.hitch(this,function(b){this._addResultView({matchedFeatures:this._formatFeatures(b.matchedLayer,a.labelField),matchedLayer:b.matchedLayer,unMatchedFeatures:this._formatFeatures(b.unMatchedLayer,a.labelField),unMatchedLayer:b.unMatchedLayer,
duplicateFeatures:this._formatFeatures(b.duplicateLayer,a.labelField,b.duplicateLookupList),duplicateLayer:b.duplicateLayer});this.state="review";this._reviewView=this.pageContainer.getViewByTitle("Review");this.pageContainer.nextDisabled=!1;this.pageContainer.backDisabled=!0;this.pageContainer._backLabels=[];this.pageContainer.altHomeIndex=this._reviewView.index;this._updateNode(this.progressNode,!1);this.pageContainer.selectView(this._reviewView.index,!0);this.pageContainer._backLabels=[]}),d.hitch(this,
function(a){console.log(a);this._updateNode(this.progressNode,!1)}))},_formatFeatures:function(a,f,e){var g=[];if(a){var c=a.objectIdField;this._currentFields=a.fields;h.forEach(a.graphics,d.hitch(this,function(a){var x=[],z;e&&(z=e[a.attributes[c]]);h.forEach(Object.keys(a.attributes),d.hitch(this,function(c){var g=this._currentFields.filter(function(a){return a.name===c}),e=a.attributes[c],r=!1;"."!==this.csvStore.decimalSeperator&&(r=g&&g.hasOwnProperty("length")&&1===g.length&&g[0].hasOwnProperty("type")&&
"esriFieldTypeDouble"===g[0].type)&&(e=-1===[null,void 0,""].indexOf(e)?e.toString().replace(this.csvStore.decimalSeperator,"."):e);g={name:c,label:g&&g.hasOwnProperty("length")&&1===g.length&&g[0].alias?g[0].alias:c,formattedValue:r&&-1===[null,void 0].indexOf(e)?b.localizeNumber(e):e,value:e,needsFormat:r};z&&(g.duplicateFieldInfo={value:z[c]});x.push(g)}));var k=x.filter(function(a){return a.name===f&&a.needsFormat});g.push({label:k&&k.hasOwnProperty("length")&&1===k.length?k[0].formattedValue:
a.attributes[f],fieldInfo:x,geometry:a.geometry,address:""})}))}return g},_addResultView:function(b){var d=new a({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,matchedList:b.matchedFeatures,unMatchedList:b.unMatchedFeatures,duplicateList:b.duplicateFeatures,theme:this.theme,isDarkTheme:this.isDarkTheme,csvStore:this.csvStore,editLayer:this.parent.editLayer,matchedLayer:b.matchedLayer,unMatchedLayer:b.unMatchedLayer,duplicateLayer:b.duplicateLayer,duplicateLookupList:b.duplicateLookupList,
_syncFields:this._syncFields});this.pageContainer.addView(d);this._zoomToAllFeatures([b.matchedLayer,b.unMatchedLayer,b.duplicateLayer])},_zoomToAllFeatures:function(a){var b=[];h.forEach(a,function(a){if(a&&a.graphics)for(var g=0;g<a.graphics.length;g++)b.push(a.graphics[g])});this.csvStore._zoomToData(b)}})})},"widgets/DataAggregation/js/UI/Review":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-class dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/Deferred dojo/text!./templates/Review.html dojo/query dojo/on ./FeatureList jimu/dijit/Message jimu/CSVUtils esri/toolbars/edit esri/lang esri/graphic".split(" "),
function(t,d,h,l,n,w,p,y,u,A,v,m,f,a,b,k,q,e){return t([n,w,p,y],{baseClass:"cf-review",declaredClass:"CriticalFacilities.Review",templateString:A,_started:null,label:"Review",parent:null,nls:null,map:null,appConfig:null,config:null,matchedList:[],unMatchedList:[],duplicateList:[],theme:"",isDarkTheme:"",styleColor:"",csvStore:null,editLayer:null,matchedLayer:null,unMatchedLayer:null,duplicateLayer:null,_editToolbar:null,_syncFields:{},_currentIndex:0,constructor:function(a){d.mixin(this,a)},postCreate:function(){this.inherited(arguments);
this._initReviewRows();this._darkThemes=["DartTheme","DashboardTheme"];this.updateImageNodes();this._editToolbar=new k(this.map);this.reviewDuplicateHint.innerHTML=q.substitute({layerName:this.editLayer.name},this.nls.review.reviewDuplicateHint);this.reviewDataHint.innerHTML=q.substitute({layerName:this.editLayer.name},this.nls.review.reviewDataHint)},startup:function(){this._started=!0;this._initNavPages();this._updateIndexesList();this.altNextIndex=this.altNextIndexes[this._currentIndex];this._currentIndex=
this._currentIndex+1<this.altNextIndexes.length?this._currentIndex+1:0;this.own(m(this.pageContainer,"nav-view",d.hitch(this,this._navView)))},onShown:function(){this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?!1:!0},_navView:function(a){a===this.index&&(this._updateIndexesList(),this._currentIndex<this.altNextIndexes.length?(this.altNextIndex=this.altNextIndexes[this._currentIndex],this._currentIndex=this._currentIndex+1<this.altNextIndexes.length?this._currentIndex+1:0):
(this._currentIndex=0,this.altNextIndex=this.altNextIndexes[this._currentIndex]))},validate:function(a,c){var b=new u;"next-view"===a?b.resolve(this._nextView()):"back-view"===a?b.resolve(this._backView(c)):this._homeView(c).then(function(a){b.resolve(a)});return b},_nextView:function(){return!0},_backView:function(a){return 0<this.pageContainer._backLabels.length?!0:a.navView>this.index},_homeView:function(a){var c=new u;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){c.resolve(a)});
return c},_updateIndexesList:function(){this.altNextIndexes=[];0<this.unMatchedList.length&&this.altNextIndexes.push(this._unMatchedListView.index);0<this.duplicateList.length&&this.altNextIndexes.push(this._duplicateListView.index);0<this.matchedList.length&&this.altNextIndexes.push(this._matchedListView.index)},_initNavPages:function(){this.pageContainer&&(this._addMatchedFeaturesList(),0<this.unMatchedList.length&&this._addUnmatchedFeatureList(),0<this.duplicateList.length&&this._addDuplicateFeatureList());
this.pageContainer.selectView(this.index,!0)},_addMatchedFeaturesList:function(){this.matchedFeatureList=this._initFeatureList(this.matchedList,this.matchedLayer,"MatchedFeatures",this.nls.review.reviewMatchedHint,this.nls.review.reviewMatched,!1);this.pageContainer.addView(this.matchedFeatureList);this._updateNode(this.submitButton,0<this.matchedList.length);this._matchedListView=this.pageContainer.getViewByTitle(this.matchedFeatureList.label);this.own(m(this.matchedFeatureList,"feature-list-updated",
d.hitch(this,function(a){this.matchedCount.innerHTML=a;this._initReviewRow(this.matchedList,[this.matchedHintRow,this.matchedControlRow],this.matchedCount);this._updateNode(this.submitButton,0<this.matchedList.length)})))},_addUnmatchedFeatureList:function(){this.unMatchedFeatureList=this._initFeatureList(this.unMatchedList,this.unMatchedLayer,"UnMatchedFeatures",this.nls.review.reviewUnMatchedHint,this.nls.review.reviewUnMatched,!1);this.pageContainer.addView(this.unMatchedFeatureList);this._unMatchedListView=
this.pageContainer.getViewByTitle(this.unMatchedFeatureList.label);this.own(m(this.unMatchedFeatureList,"feature-list-updated",d.hitch(this,function(a){this.unMatchedCount.innerHTML=a;0===a&&this.pageContainer.removeView(this._unMatchedListView)})))},_addDuplicateFeatureList:function(){var a=q.substitute({layerName:this.editLayer.name},this.nls.review.reviewDuplicateHint);this.duplicateFeatureList=this._initFeatureList(this.duplicateList,this.duplicateLayer,"DuplicateFeatures",a,this.nls.review.reviewDuplicate,
!0);this.pageContainer.addView(this.duplicateFeatureList);this._duplicateListView=this.pageContainer.getViewByTitle(this.duplicateFeatureList.label);this.own(m(this.duplicateFeatureList,"feature-list-updated",d.hitch(this,function(a){this.duplicateCount.innerHTML=a;0===a&&this.pageContainer.removeView(this._duplicateListView)})))},_initFeatureList:function(a,c,b,e,z,d){return new f({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,hint:e,_title:z,label:b,features:a,
theme:this.theme,isDuplicate:d,isDarkTheme:this.isDarkTheme,layer:c,_editToolbar:this._editToolbar,csvStore:this.csvStore,_syncFields:this._syncFields})},_initReviewRows:function(){this._initReviewRow(this.matchedList,[this.matchedHintRow,this.matchedControlRow],this.matchedCount);this._initReviewRow(this.unMatchedList,[this.unMatchedHintRow,this.unMatchedControlRow],this.unMatchedCount);this._initReviewRow(this.duplicateList,[this.duplicateHintRow,this.duplicateControlRow],this.duplicateCount)},
_initReviewRow:function(a,c,b){0<a.length?(h.forEach(c,function(a){l.contains(a,"display-none")&&l.remove(a,"display-none")}),b.innerHTML=a.length):h.forEach(c,function(a){l.contains(a,"display-none")||l.add(a,"display-none")})},_updateReviewRows:function(a){this._initReviewRows();(a="unmatched"===a&&this.unMatchedFeatureList?this.unMatchedFeatureList:"duplicate"===a&&this.duplicateFeatureList?this.duplicateFeatureList:void 0)&&a.features&&0===a.features.length&&this.pageContainer.selectView(this.index,
!0)},updateImageNodes:function(){var a=-1<this._darkThemes.indexOf(this.theme),c=a?"next-arrow-img":"next-arrow-img-white",b=a?"next-arrow-img-white":"next-arrow-img",a=v("."+c,this.domNode);h.forEach(a,function(a){l.remove(a,c);l.add(a,b)})},_download:function(){var a;0<this.matchedList.length&&(a=this.csvStore.matchedFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.matchedFeatureLayer,a));0<this.unMatchedList.length&&(a=this.csvStore.unMatchedFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.unMatchedFeatureLayer,
a));0<this.duplicateList.length&&(a=this.csvStore.duplicateFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.duplicateFeatureLayer,a))},_export:function(a,c){var e=[];h.forEach(a.graphics,function(a){e.push(a.attributes)});var g={};g.datas=e;g.fromClient=!1;g.withGeometry=!1;g.outFields=a.fields;g.formatDate=!0;g.formatCodedValue=!0;g.formatNumber=!1;b.exportCSVFromFeatureLayer(c,a,g)},_submit:function(){this._updateNode(this.submitButton,!1);this._updateNode(this.progressNode,!0);var b=
this._getFeatures(this.csvStore.matchedFeatureLayer),c=this._getFeatures(this.csvStore.duplicateFeatureLayer);this.editLayer.applyEdits(b,c,null,d.hitch(this,function(a,c){this._validateResults(a);this._validateResults(c);this._updateNode(this.progressNode,!1);this._disableUI();this.csvStore._zoomToData(this.editLayer.graphics,!0)}),d.hitch(this,function(){new a({type:"Error",message:this.nls.warningsAndErrors.saveError})}))},_validateResults:function(b){var c=[],e=[];b&&b.hasOwnProperty("length")&&
0<b.length&&(h.forEach(b,function(a){"undefined"!==typeof a.success&&(a.success?c.push(a):e.push(a))}),0<e.length&&(b=0===c.length?this.nls.review.noFeaturesSaved:q.substitute({num:e.length},this.nls.review.someFeaturesNotSaved),new a({message:b})))},_disableUI:function(){this._updateNode(this.submitButton,!0);l.add(this.submitButton,"control-disbaled");l.add(this.reviewRowTable,"control-disbaled");l.add(this.pageContainer.nextTd,"control-disbaled");l.add(this.pageContainer.backTd,"control-disbaled");
this.map.infoWindow&&this.map.infoWindow.clearFeatures&&this.map.infoWindow.clearFeatures()},_getFeatures:function(a){var c=[],b=this.csvStore.objectIdField;a&&a.graphics&&h.forEach(a.graphics,d.hitch(this,function(a){a.hasOwnProperty("_graphicsLayer")&&delete a._graphicsLayer;a.hasOwnProperty("_layer")&&delete a._layer;var g=a.attributes;this._deleteProp(g,b);g.hasOwnProperty("hasDuplicateUpdates")&&g.hasOwnProperty("duplicateState")?g.hasDuplicateUpdates&&"make-change"===g.duplicateState&&(g.hasOwnProperty("DestinationOID")&&
(g[this.editLayer.objectIdField]=g.DestinationOID),this._deleteProp(g,"hasDuplicateUpdates"),this._deleteProp(g,"duplicateState"),c.push(a.toJson?new e(a.toJson()):a)):c.push(a.toJson?new e(a.toJson()):a);this._deleteProp(g,"matchScore");this._deleteProp(g,"DestinationOID")}));return 0<c.length?c:null},_deleteProp:function(a,c){a.hasOwnProperty(c)&&delete a[c]},_navigateHome:function(){var a=this.pageContainer.getViewByTitle("Home");a._clearStore(!0);a._clearMapping();this.pageContainer.toggleController(!0);
this.pageContainer.selectView(a.index)},_updateNode:function(a,c){c?l.contains(a,"display-none")&&l.remove(a,"display-none"):l.contains(a,"display-none")||l.add(a,"display-none")},setStyleColor:function(a){this.styleColor=a},updateTheme:function(a){this.theme=a},_reviewMatched:function(){this.pageContainer.selectView(this._matchedListView.index)},_reviewUnMatched:function(){this.pageContainer.selectView(this._unMatchedListView.index)},_reviewDuplicate:function(){this.pageContainer.selectView(this._duplicateListView.index)}})})},
"widgets/DataAggregation/js/UI/FeatureList":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/FeatureList.html dojo/query dojo/Deferred dojo/on ./Feature".split(" "),function(t,d,h,l,n,w,p,y,u,A,v,m,f,a){return t([w,p,y,u],{baseClass:"cf-feature-list",declaredClass:"CriticalFacilities.FeatureList",templateString:A,label:"FeatureList",parent:null,
nls:null,map:null,appConfig:null,config:null,features:[],updateFeatures:[],hint:"",theme:"",isDarkTheme:"",styleColor:"",type:"",isDuplicate:!1,layer:null,_editToolbar:null,_syncFields:{},_started:!1,constructor:function(a){d.mixin(this,a)},postCreate:function(){this.inherited(arguments);this.pageHint.innerHTML=this.hint;this.pageTitle.innerHTML=this._title;this._darkThemes=["DartTheme","DashboardTheme"]},onShown:function(){this.pageContainer.nextDisabled=!1;this.pageContainer.backDisabled=!1},startup:function(){this._started=
!0;this._initFeatureList(this.features);this._updateAltIndexes();this.updateImageNodes();this.own(f(this,"feature-list-updated",d.hitch(this,this._updateAltIndexes)));this.own(f(this.pageContainer,"view-index-change",d.hitch(this,this._indexChanged)))},validate:function(a,d){var b=new m;"next-view"===a?b.resolve(this._nextView()):"back-view"===a?b.resolve(this._backView()):this._homeView(d).then(function(a){b.resolve(a)});return b},_nextView:function(){return!0},_backView:function(){return!0},_homeView:function(a){var b=
new m;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});return b},_indexChanged:function(a){this._updateAltIndexes();a.oldIndex===this.altNextIndex&&(this.altNextIndex=a.newIndex)},_updateAltIndexes:function(){this.pageContainer&&!this._reviewView&&(this._reviewView=this.pageContainer.getViewByTitle("Review"))&&(this.altHomeIndex=this.altBackIndex=this._reviewView.index);if(this.featureListTable&&this.featureListTable.rows){var a=this.featureListTable.rows;
if(a.length&&0<a.length){var d=a[0].featureView,a=a[a.length-1].featureView;this.altNextIndex=d.index;this.finalFeatureIndex=a.index;a.altNextIndex=this._reviewView.index;d.altBackIndex=this.index}}},_initFeatureList:function(a){var b=0;this.featureListTable.rows.length!==this.features.length&&h.forEach(a,d.hitch(this,function(a){this._initRow(a,b);b+=1}))},updateImageNodes:function(){var a=-1<this._darkThemes.indexOf(this.theme),d=a?"next-arrow-img":"next-arrow-img-white",f=a?"next-arrow-img-white":
"next-arrow-img",a=v("."+d,this.domNode);h.forEach(a,function(a){n.remove(a,d);n.add(a,f)})},setStyleColor:function(a){this.styleColor=a},updateTheme:function(a){this.theme=a},_initFeatureView:function(b,d){b=new a({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,label:d,altBackIndex:this.index,isDuplicate:this.isDuplicate,feature:b,theme:this.theme,isDarkTheme:this.isDarkTheme,layer:this.layer,_editToolbar:this._editToolbar,csvStore:this.csvStore,_parentFeatureList:this,
pageContainer:this.pageContainer,pageHint:this.nls.review.reviewFeatureHint,pageTitle:b.label});this.pageContainer.addView(b);return this.pageContainer.getViewByTitle(d)},_initRow:function(a,f){var b=l.create("tr",{className:"bottom-border feature-list-row",onclick:d.hitch(this,function(a){this.pageContainer.selectView(a.currentTarget.featureView.index)})},this.featureListTable);b.featureView=this._initFeatureView(a,this.label+"_"+f);b.fieldInfo=a.fieldInfo;for(f=0;f<a.fieldInfo.length;f++){var e=
a.fieldInfo[f];if(e.name===this.layer.objectIdField){b._featureOID=e.value;break}}f=l.create("td",{className:"pad-10"},b);b.featureView.featureListLabel=l.create("div",{className:"main-text float-left text-left",innerHTML:a.label},f);a=l.create("td",{className:"width-15"},b);l.create("div",{className:"next-arrow float-right next-arrow-img"},a)},removeFeature:function(a,f){for(var b=new m,e=this.featureListTable.rows,g=0;g<e.length;g++){var c=e[g];if(c._featureOID===f){this.pageContainer._backLabelClone=
d.clone(this.pageContainer._backLabels);this.pageContainer.removeView(c.featureView);this.featureListTable.deleteRow(g);a=this.features.indexOf(a);-1<a&&this.features.splice(a,1);this.emit("feature-list-updated",this.features.length);g===this.features.length&&this.pageContainer.selectView(this.altBackIndex);break}}b.resolve("feature-removed");return b},resetFeatureList:function(){if(0<this.featureListTable.rows.length){for(var a=this.featureListTable.rows.length;0<a;a--)this.pageContainer.removeView(this.featureListTable.rows[a-
1].featureView),this.featureListTable.deleteRow(a-1);this.altNextIndex=void 0;this._initFeatureList(this.features);this._updateAltIndexes();this.pageContainer._backLabels=this.pageContainer._backLabelClone;this.updateImageNodes()}},addFeature:function(a){this.features.push(a);this.emit("feature-list-updated",this.features.length)}})})},"widgets/DataAggregation/js/UI/Feature":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dijit/form/ValidationTextBox dijit/form/Select dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dijit/form/DateTextBox dojo/text!./templates/Feature.html dojo/Deferred ./FeatureToolbar esri/tasks/query jimu/dijit/Popup jimu/utils esri/lang".split(" "),
function(t,d,h,l,n,w,p,y,u,A,v,m,f,a,b,k,q,e,g){return t([y,u,A,v],{baseClass:"cf-feature",declaredClass:"CriticalFacilities.Feature",templateString:f,_started:null,label:"Feature",parent:null,nls:null,map:null,appConfig:null,config:null,_featureToolbar:null,fields:[],feature:null,fileAddress:{},isDuplicate:!1,_useGeomFromFile:!1,_useGeomFromLayer:!0,_useValuesFromFile:!1,_useValuesFromLayer:!0,_featureExpanded:!1,_locationExpanded:!1,theme:"",isDarkTheme:"",styleColor:"black",layer:null,_changedFileAttributeRows:[],
_changedLayerAttributeRows:[],_changedAddressRows:[],_editToolbar:null,_featureQuery:null,_skipFields:[],csvStore:null,constructor:function(a){d.mixin(this,a)},postCreate:function(){this.inherited(arguments);this.pageHintDiv.innerHTML=this.pageHint;this.pageTitleDiv.innerHTML=this.pageTitle;this._initToolbar(this.featureToolbar);this._updateAltIndexes()},_updateAltIndexes:function(){if(this.pageContainer){var a=this.pageContainer.getViewByTitle("Review");a&&(this.altHomeIndex=a.index)}},_initSkipFields:function(a){this._skipFields=
["DestinationOID","matchScore","hasDuplicateUpdates","duplicateState",this.layer.objectIdField];h.forEach(a,d.hitch(this,function(a){-1<a.name.indexOf(this.csvStore.matchFieldPrefix)&&this._skipFields.push(a.name)}))},startup:function(){var a=this.feature.fieldInfo;this._initSkipFields(a);this._initRows(a,this.featureControlTable);this.isDuplicate?this._initDuplicateReview(a):this._initStandardReview();this._getFeature().then(d.hitch(this,function(a){this._feature=a;this._featureToolbar._panToAndSelectFeature(a)}));
this._getEditFeature().then(d.hitch(this,function(a){this._editFeature=a;this.isDuplicate&&this._editFeature&&this._editFeature.geometry&&this._toggleLocationControls(!0)}));this.onShown()},onShown:function(){this._isReviewed=!0;this._featureToolbar._disableEdit();this._showView();this._featureToolbar._panToAndSelectFeature(this.isDuplicate&&this._useGeomFromLayer?this._editFeature:this._feature);this.isShowing=!0;this.pageContainer.nextDisabled=!1;this.pageContainer.backDisabled=!1},onHidden:function(){this.isShowing=
!1},validate:function(c,b){var e=new a;"next-view"===c?e.resolve(this._nextView()):"back-view"===c?e.resolve(this._backView()):this._homeView(b).then(function(a){e.resolve(a)});return e},_nextView:function(){return!0},_backView:function(){return!0},_homeView:function(c){var b=new a;this.pageContainer.getViewByTitle("Home").verifyClearSettings(c).then(function(a){b.resolve(a)});return b},_showView:function(){n.remove(this.featureTitleTable,"display-none");n.remove(this.featureTable,"display-none");
n.remove(this.featureToggleTable,"display-none");n.remove(this.locationSyncTable,"display-none");n.remove(this.locationControlTable,"display-none");n.remove(this.locationControlToggleTable,"display-none");n.remove(this.featureToolbarTable,"display-none");this.isDuplicate&&n.remove(this.reviewText,"display-none");this._updateInfoRows()},_getFeature:function(){var c=new a,b=this.layer.objectIdField,e=this.feature.fieldInfo.filter(function(a){return a.name===b});this._featureQuery=new k;this._featureQuery.objectIds=
[e[0].value];this.layer.queryFeatures(this._featureQuery).then(d.hitch(this,function(a){c.resolve(a.features[0])}));return c},_getEditFeature:function(){var c=new a,b=this.feature.fieldInfo.filter(function(a){return"DestinationOID"===a.name});b&&0<b.length?(this._editQuery=new k,this._editQuery.objectIds=[b[0].value],this.parent.editLayer.queryFeatures(this._editQuery).then(d.hitch(this,function(a){c.resolve(a.features[0])}))):c.resolve();return c},_initStandardReview:function(){this._useValuesFromFile=
!0;this._useValuesFromLayer=!1},_initDuplicateReview:function(a){this._initDuplicateSelect();this._initDuplicateReviewRows(a);n.add(this.featureToolbar,"display-none")},_initDuplicateSelect:function(){var a=new p({style:{display:"table",width:"100%",height:"28px"},options:[{label:this.nls.review.duplicateAction,value:"no-change",selected:!0},{label:this.nls.remove,value:"skip"},{label:this.nls.review.isDuplicateMakeChange,value:"make-change"},{label:this.nls.save,value:"not-duplicate"}],onChange:d.hitch(this,
this._updateDuplicateUI)});this._duplicateFlag.fromSelect=a;l.place(a.domNode,this._duplicateFlag);a.startup()},_updateDuplicateUI:function(a){this._updateDuplicateAttributes(a,null);this._featureToolbar._disableEdit();"make-change"===a?n.remove(this.featureToolbar,"display-none"):n.add(this.featureToolbar,"display-none");"not-duplicate"===a&&this._showShouldLocateFeaturePopup().then(d.hitch(this,function(c){c?(this.resetAddressValues(this._featureToolbar._originalValues,a),this._featureToolbar._locateFeature(!0).then(d.hitch(this,
function(){var a=new q({titleLabel:this.nls.review.featureLocated,width:400,autoHeight:!0,content:l.create("div",{innerHTML:this.nls.warningsAndErrors.itemMoveMatch,style:"padding-bottom: 10px;"}),buttons:[{label:this.nls.ok,onClick:d.hitch(this,d.hitch(this,function(){a.close();a=null}))}],onClose:d.hitch(this,function(){a=null;this._featureToolbar._save(!0)})})}))):this._duplicateFlag.fromSelect.set("value","no-change")}))},_updateDuplicateAttributes:function(a,b){this._feature.attributes.duplicateState=
null!==a?a:this._feature.attributes.duplicateState;this._feature.attributes.hasDuplicateUpdates=null!==b?b:this._feature.attributes.hasDuplicateUpdates},_showShouldLocateFeaturePopup:function(){var c=new a,b=l.create("div");l.create("div",{innerHTML:this.nls.warningsAndErrors.itemWillBeLocated,style:"padding-bottom: 10px;"},b);l.create("div",{innerHTML:this.nls.warningsAndErrors.proceed},b);var e=new q({titleLabel:this.nls.review.locateFeature,width:400,autoHeight:!0,content:b,buttons:[{label:this.nls.yes,
onClick:d.hitch(this,function(){e.close();e=null;c.resolve(!0)})},{label:this.nls.no,onClick:d.hitch(this,function(){e.close();e=null;c.resolve(!1)})}],onClose:function(){e=null}});return c},_initDuplicateReviewRows:function(a){var c=l.create("tr",{className:"bottom-border",isHeaderRow:!0},this.reviewTable);l.create("td",{className:"text-left"},c);var b=l.create("td",{className:"text-left"},c);l.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.fromLayer},
b);c=l.create("td",{className:"text-left"},c);l.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.fromFile},c);h.forEach(a,d.hitch(this,function(a){if(-1===this._skipFields.indexOf(a.name)){var c=l.create("tr",{className:"bottom-border",isLabelRow:!0,isControlRow:!0},this.reviewTable);c.fieldName=a.name;c.parent=this;var b=l.create("td",{className:"field-control-td text-left"},c);l.create("div",{className:"main-text float-left",innerHTML:a.label},b);this._initLabel(c,
a.duplicateFieldInfo.value,!1,!1);this._initLabel(c,a.value,!0,!1)}}))},_initToolbar:function(a){this._featureToolbar=new b({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,feature:this.feature,theme:this.theme,layer:this.layer,featureView:this,_editToolbar:this._editToolbar,csvStore:this.csvStore,_stageLayer:this.csvStore.matchedFeatureLayer,styleColor:this.styleColor});this._featureToolbar.placeAt(a);this._featureToolbar.startup()},_initRows:function(a,b){if(this.isDuplicate){this._initSelectRow(this.nls.review.use,
this.locationControlTable,this._useGeomChanged,"geom");this._initSelectRow(this.nls.review.use,this.featureControlTable,this._useValuesChanged,"values");var c=l.create("tr",{className:"bottom-border",isHeaderRow:!0},b);l.create("td",{className:"text-left"},c);var e=l.create("td",{className:"text-left"},c);l.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.fromLayer},e);c=l.create("td",{className:"text-left"},c);l.create("div",{className:"duplicate-col-headers main-text float-left",
innerHTML:this.nls.review.fromFile},c)}(this._syncEnabled=0<Object.keys(this._parentFeatureList._syncFields).length)?this._syncFields=this._parentFeatureList._syncFields:n.add(this.syncFields,"display-none");var g=0;h.forEach(a,d.hitch(this,function(a){if(-1===this._skipFields.indexOf(a.name)){var c=l.create("tr",{className:"bottom-border",isRadioRow:!1,isEditRow:!0,rowIndex:g},b);c.fieldName=a.name;c.parent=this;var e=l.create("td",{className:"field-control-td text-left field-row-width pad-left-5"},
c);l.create("div",{className:"main-text float-left",innerHTML:a.label},e);this.isDuplicate&&this._initValidationBox(c,a.duplicateFieldInfo.value,!1,!1);this._initValidationBox(c,a.value,!0,!1);g+=1}}));this.addressFields=this.csvStore.useMultiFields?this.csvStore.multiFields:this.csvStore.useAddr?this.csvStore.singleFields:this.getXYFields();h.forEach(this.addressFields,d.hitch(this,function(a){var c=l.create("tr",{className:"bottom-border",isRadioRow:!1,isEditRow:!1,isAddressRow:!0},this.locationControlTable);
c.label=a.label;c.keyField=a.keyField;c.parent=this;var b=l.create("td",{className:"field-control-td text-left pad-left-5"},c);l.create("div",{className:"main-text float-left",innerHTML:a.label},b);var e=this.csvStore.matchFieldPrefix,b=this.feature.fieldInfo.filter(function(c){return c.name===e+a.keyField})[0];this._initValidationBox(c,b.value,!1,!0)}))},_syncAddressInfo:function(){if(!this._featureToolbar._syncDisabled){var a=this._getAddress();this._updateAddressFields(a,!0);this._featureToolbar._hasAddressEdit=
!1;this._featureToolbar._updateSync(!0)}},_locate:function(){this._featureToolbar._locate()},getXYFields:function(){this._featureToolbar._isAddressFeature=!1;var a=this.parent._pageContainer.getViewByTitle("Coordinates"),b=a.xField,a=a.yField;this._featureToolbar.xField=this.csvStore.xFieldName;this._featureToolbar.yField=this.csvStore.yFieldName;return[{keyField:this.csvStore.xFieldName,label:b.label,value:this.csvStore.xFieldName},{keyField:this.csvStore.yFieldName,label:a.label,value:this.csvStore.yFieldName}]},
_updateAddressFields:function(a,b){this._address=a;b?h.forEach(this.locationControlTable.rows,d.hitch(this,function(a){if(this._syncFields.hasOwnProperty(a.keyField))for(var c=this._syncFields[a.keyField],b=0;b<this.featureControlTable.rows.length;b++){var e=this.featureControlTable.rows[b];if(e.isEditRow&&e.fieldName===c.layerFieldName){a=this.csvStore.matchFieldPrefix+a.keyField;a=this._address&&this._address.hasOwnProperty(a)?this._address[a]:"";this.isDuplicate&&this._useValuesFromLayer?(e.layerValueTextBox.set("value",
a),e.layerValueTextBox.emit("keyUp")):(e.fileValueTextBox.set("value",a),e.fileValueTextBox.emit("keyUp"));break}}})):h.forEach(this.locationControlTable.rows,d.hitch(this,function(a){var c=this.csvStore.useAddr&&!this.csvStore.useMultiFields?"Match_addr":a.keyField;a.addressValueTextBox&&(this.csvStore.useAddr||(c=this.csvStore.xFieldName===c?"x":"y"),c=this._address&&this._address.hasOwnProperty(c)?this._address[c]:"",a.addressValueTextBox.set("value",c))}))},_validateAddressDifference:function(){var a=
!1;this.locationControlTable&&h.forEach(this.locationControlTable.rows,d.hitch(this,function(c){if(this._syncFields&&this._syncFields.hasOwnProperty(c.keyField)&&!a){var b=c.addressValueTextBox.displayedValue;c=this._syncFields[c.keyField];for(var e=0;e<this.featureControlTable.rows.length;e++){var g=this.featureControlTable.rows[e];if(g.isEditRow&&g.fieldName===c.layerFieldName&&!a){a=this.isDuplicate&&this._useValuesFromLayer?g.layerValueTextBox.displayedValue!==b:g.fileValueTextBox.displayedValue!==
b;break}}}}));return a},_getAddress:function(){this._address={};h.forEach(this.locationControlTable.rows,d.hitch(this,function(a){a.addressValueTextBox&&(this._address[this.csvStore.matchFieldPrefix+a.keyField]=a.addressValueTextBox.value)}));return this._address},_getAddressFieldsValues:function(){var a={};h.forEach(this.locationControlTable.rows,function(c){c.addressValueTextBox&&(a[c.keyField]=c.addressValueTextBox.value)});return a},_initLabel:function(a,b,e,g){var c=this._getField(a),d=l.create("td",
{className:"field-control-td field-row-width2"},a),f=new w({style:{width:"100%",height:"32px"},title:b,invalidMessage:this.nls.review.valuesDoNotMatch});f.decimalSeperator=this.csvStore.decimalSeperator;this._addLocalizeFloatSupport(f,b,g,c);f.set("value",b);f.set("readonly",!0);f.placeAt(d);f.startup();f.isFile=e;f.isAddress=g;f.row=a;f.parent=this;e?(a.fileValueTextBox=f,a.fileValue=b):g?(a.addressValueTextBox=f,a.addressValue=b):(a.layerValueTextBox=f,a.layerValue=b);e&&(f.validator=this._valuesMatch,
f.validate())},_initValidationBox:function(a,b,f,d){var c=this._getField(a),z=l.create("td",{className:"field-control-td",colspan:this.isDuplicate?1:2},a),k;if(c&&c.type&&"date"===c.type)k=c.fieldInfo&&c.fieldInfo.format?c.fieldInfo:void 0,b=-1===[null,void 0,""].indexOf(b)?new Date(b):void 0,k=new m({style:{width:"100%",height:"32px"},title:k?e.localizeDateByFieldInfo(b,k):e.localizeDate(b),onChange:this._onChange});else if(c&&c.domainValues){k=function(a){var b;-1<c.values.indexOf(a)&&(b=c.domainValues.filter(function(c){return c.label===
a}));return b&&-1<b.length?b[0].value:a};b=-1<[null,void 0,""].indexOf(b)?"":-1<c.codes.indexOf(b)?b:k(b);var x=[{label:this.nls.review.selectValue,value:null,selected:!0}],r=b;h.forEach(c.domainValues,function(a){if(b.toString()===a.value.toString()||b.toString()===a.label.toString())r=a.label;x.push({label:a.label,value:a.value})});k=new p({style:{width:"100%",height:"32px"},options:x,onChange:this._onChange,title:r});z.style.overflow="hidden"}else k=new w({style:{width:"100%",height:"32px"},title:b});
k.decimalSeperator=this.csvStore.decimalSeperator;this._addLocalizeFloatSupport(k,b,d,c);k.set("intermediateChanges",!0);k.set("value",this.isDuplicate&&d?"":b);k.placeAt(z);k.startup();k.isFile=f;k.isAddress=d;k.row=a;k.featureToolbar=this._featureToolbar;if(!d){var q;c&&c.length&&(q=g.substitute({num:c.length},this.nls.warningsAndErrors.rangeMessage));k.invalidLengthMessage=q;k.invalidTypeMessage=this.nls.warningsAndErrors.invalidMessage;k.fieldLength=c.length;k.fieldType=c.type;k.fieldNullable=
c.nullable;c&&c.type&&"date"!==c.type&&(k.validator=this._valuesValidForType)}k.parent=this;f?(a.fileValueTextBox=k,a.fileValue=b):d?(a.addressValueTextBox=k,a.addressValue=b):(a.layerValueTextBox=k,a.layerValue=b);k.on("keyUp",function(a){var c;a="undefined"!==typeof a.target.value?this.parent._getValue(a.target.value):"date"===this.fieldType?"":this.value;if(this.isAddress)a=a!==this.parent._getValue(this.row.addressValue),c=this.parent._changedAddressRows.indexOf(this.row.rowIndex),-1===c&&a?this.parent._changedAddressRows.push(this.row.rowIndex):
-1<c&&!a&&this.parent._changedAddressRows.splice(c,1),this.parent.emit("address-change",0<this.parent._changedAddressRows.length);else if(c=this.validate(),this.row._isValid=c){c=this.parent._getValue(this.row.fileValue);var b=this.parent._getValue(this.row.layerValue);a=this.isFile?a!==c:a!==b;b=this.isFile?this.parent._changedFileAttributeRows:this.parent._changedLayerAttributeRows;c=b.indexOf(this.row.rowIndex);-1===c&&a?b.push(this.row.rowIndex):-1<c&&!a&&b.splice(c,1);var e=!0;h.forEach(this.parent.featureControlTable.rows,
function(a){"undefined"===typeof a._isValid||a._isValid||(e=!1)});e?this.parent.emit("attribute-change",0<b.length):this.featureToolbar._updateSave(!0)}else this.featureToolbar._updateSave(!0)})},_getField:function(a){for(var c,b=0;b<this.csvStore.fsFields.length;b++){var e=this.csvStore.fsFields[b];if(e.name===a.fieldName){c=e;break}}return c},_addLocalizeFloatSupport:function(a,b,g,d){"."!==a.decimalSeperator&&(g&&!this.csvStore.useAddr||d&&d.type&&"float"===d.type)&&(a.title=-1!==[null,void 0,
""].indexOf(b)?"":isNaN(b)||"."===a.decimalSeperator?b:e.localizeNumber(b),a.format=function(a){return-1!==[null,void 0,""].indexOf(a)||isNaN(a)?a:e.localizeNumber(a).toString().replace(".","")},a.parse=function(a){return a&&a.toString&&-1<a.toString().indexOf(this.decimalSeperator)?a.toString().replace(this.decimalSeperator,"."):a})},_onChange:function(a){var c;a="undefined"!==typeof a?this.parent._getValue(a):"date"===this.fieldType?"":this.value;c=this.validate();if(this.row._isValid=c){c=this.parent._getValue(this.row.fileValue);
var b=this.parent._getValue(this.row.layerValue);a=this.isFile?a.toString()!==c.toString():a.toString()!==b.toString();b=this.isFile?this.parent._changedFileAttributeRows:this.parent._changedLayerAttributeRows;c=b.indexOf(this.row.rowIndex);-1===c&&a?b.push(this.row.rowIndex):-1<c&&!a&&b.splice(c,1);var e=!0;h.forEach(this.parent.featureControlTable.rows,function(a){"undefined"===typeof a._isValid||a._isValid||(e=!1)});e?this.parent.emit("attribute-change",0<b.length):this.featureToolbar._updateSave(!0)}else this.featureToolbar._updateSave(!0)},
_valuesValidForType:function(a){var c=a.toString();if(c.length>this.fieldLength)return this.invalidMessage=this.invalidLengthMessage,!1;if(0===c.length)return"undefined"!==typeof this.fieldNullable?this.fieldNullable:!0;this.invalidMessage=this.invalidTypeMessage;switch(this.fieldType){case "int":return/^-?[0-9]+$/.exec(a);case "float":return"."!==this.decimalSeperator?/^-?[0-9]+[.,]?[0-9]*$/.exec(a):/^-?[0-9]+[.]?[0-9]*$/.exec(a);case "date":if(a)try{return!isNaN((new Date(a)).getTime())}catch(r){return console.error(r),
!1}else return!0;case "domainInt":return/^-?[0-9]+$/.exec(a);case "domain":return!0;case "other":return!0}},_valuesMatch:function(){return this.row.fileValueTextBox&&this.row.layerValueTextBox?this.row.fileValueTextBox.value===this.row.layerValueTextBox.value:!0},_validateValues:function(){var a=!0;h.forEach(this.featureControlTable.rows,d.hitch(this,function(c){if(c.isEditRow){"undefined"===typeof c._isValid||c._isValid||(a=!1);var b="date"===c.fileValueTextBox.fieldType&&c.fileValueTextBox.value.toString()===
c.fileValueTextBox._invalidDate?"":this._getValue(c.fileValueTextBox.value),e=this._getValue(c.fileValue),g="date"===c.layerValueTextBox.fieldType&&c.layerValueTextBox.value.toString()===c.layerValueTextBox._invalidDate?"":this._getValue(c.layerValueTextBox.value),d=this._getValue(c.layerValue);c.parent._useValuesFromFile&&(b===e&&b===d||this._changedFileAttributeRows.push(c.rowIndex));c.parent._useValuesFromLayer&&g!==d&&this._changedLayerAttributeRows.push(c.rowIndex)}}));var b=this._useValuesFromFile?
this._changedFileAttributeRows:this._changedLayerAttributeRows;a?this.emit("attribute-change",0<b.length):this._featureToolbar._updateSave(!0)},_getValue:function(a){return-1===[null,void 0,""].indexOf(a)?a:""},_validateGeoms:function(){var a=this._featureToolbar._hasAttributeEdit,b=this._featureToolbar._hasGeometryEdit;this._useGeomFromLayer?this._featureToolbar._updateSaveAndCancel(!a):b?this._featureToolbar._updateSaveAndCancel(!a&&!b):this._featureToolbar._updateSaveAndCancel(!a)},_initSelectRow:function(a,
b,e,g){b=l.create("tr",{className:"task-instruction-row bottom-border",isRadioRow:!0,isEditRow:!1},b);b.radioButtons=[];b.useType=g;g=l.create("td",{},b);l.create("div",{className:"main-text float-left pad-left-5",innerHTML:a},g);this._createSelect(b,e)},_createSelect:function(a,b){var c=l.create("td",{colspan:2,className:"field-control-td"},a);b=new p({style:{display:"table",width:"100%",height:"28px"},options:[{label:this.nls.review.fromLayer,value:"layer",selected:!0},{label:this.nls.review.fromFile,
value:"file"}],onChange:d.hitch(this,b)});a.fromSelect=b;l.place(b.domNode,c);b.startup()},_useGeomChanged:function(a){this._useGeomFromFile=a="file"===a;this._useGeomFromLayer=!a;a?(this._featureToolbar._enableEdit(!0),this.resetAddressValues(this._featureToolbar._originalValues)):this._featureToolbar._enableEdit(!1);a&&!this._hasBeenLocatedForFile?this._hasBeenLocatedForFile||this._featureToolbar._locateFeature().then(d.hitch(this,function(a){this._featureToolbar._originalValues.duplicateGeometry=
a.feature.geometry;this._hasBeenLocatedForFile=!0;var c=[a.feature,this._editFeature];if(a.feature.geometry.x!==this._editFeature.geometry.x||a.feature.geometry.y!==this._editFeature.geometry.y)this.map&&this.map.extent&&this.map.extent.contains?this.map.extent.contains(a.feature.geometry)&&this.map.extent.contains(this._editFeature.geometry)||this.csvStore._zoomToData(c):this.csvStore._zoomToData(c);this._featureToolbar._flashFeatures(c);this._validateGeoms()})):(this._featureToolbar._updateFeature(this._useGeomFromFile?
this._featureToolbar._originalValues.duplicateGeometry:this._editFeature.geometry,!1,!0),this._featureToolbar._flashFeatures([a?this._feature:this._editFeature]),this._validateGeoms());this._useGeomFromLayer&&this._updateAddressFields(this._featureToolbar._originalValues.editAddress,!1);this._toggleLocationControls(!1);this._syncFields&&this._featureToolbar._updateSync(!this._validateAddressDifference())},_toggleFeature:function(){if(this._featureExpanded=!this._featureExpanded)this._locationExpanded=
!1;this._updateInfoRows()},_toggleLocation:function(){if(this._locationExpanded=!this._locationExpanded)this._featureExpanded=!1;this._updateInfoRows()},_updateInfoRows:function(){this._updateRow(this._featureExpanded,this.featureInformation,this.toggleFeature);this._updateRow(this._locationExpanded,this.locationInformation,this.toggleLocation)},_updateRow:function(a,b,e){var c=["bg-toggle-up-img","bg-toggle-up-img-white"],g=["bg-toggle-down-img","bg-toggle-down-img-white"];a?n.remove(b,"display-none"):
n.add(b,"display-none");this._updateImageNode(a?c:g,a?g:c,e)},_updateImageNode:function(a,b,e){var c=-1<this._featureToolbar._darkThemes.indexOf(this.theme);n.remove(e,c?b[1]:b[0]);n.add(e,c?a[1]:a[0])},_toggleLocationControls:function(a){var c=this.isDuplicate&&this._useGeomFromLayer?!0:a;this.locationControlTable&&h.forEach(this.locationControlTable.rows,function(b){b.fromSelect&&b.fromSelect.set("disabled",a);b.isAddressRow&&b.addressValueTextBox&&b.addressValueTextBox.set("disabled",c)})},_useValuesChanged:function(a){this._useValuesFromFile=
a="file"===a;this._useValuesFromLayer=!a;this._featureToolbar._editDisabled||this._toggleEnabled(a);this._validateValues();this._syncFields&&this._featureToolbar._updateSync(!this._validateAddressDifference())},_toggleEnabled:function(a){h.forEach(this.featureControlTable.rows,function(c){c.isRadioRow||(c.fileValueTextBox&&c.fileValueTextBox.set("disabled",!a),c.layerValueTextBox&&c.layerValueTextBox.set("disabled",a))})},_toggleEditControls:function(a){this.featureControlTable&&h.forEach(this.featureControlTable.rows,
function(c){c.isRadioRow&&c.fromSelect.set("disabled",a);c.isEditRow&&(c.fileValueTextBox&&(a?c.fileValueTextBox.set("disabled",a):c.parent.isDuplicate&&c.parent._useValuesFromFile?c.fileValueTextBox.set("disabled",a):c.parent.isDuplicate||c.fileValueTextBox.set("disabled",a)),c.layerValueTextBox&&(a?c.layerValueTextBox.set("disabled",a):c.parent.isDuplicate&&c.parent._useValuesFromLayer?c.layerValueTextBox.set("disabled",a):c.parent.isDuplicate||c.layerValueTextBox.set("disabled",a)))});this._toggleLocationControls(a)},
resetAttributeValues:function(){h.forEach(this.featureControlTable.rows,d.hitch(this,function(a){a.fileValueTextBox&&a.fileValueTextBox.set("value",a.fileValue);a.layerValueTextBox&&a.layerValueTextBox.set("value",a.layerValue)}));this._changedFileAttributeRows=[];this._changedLayerAttributeRows=[]},resetAddressValues:function(a,b){h.forEach(this.locationControlTable.rows,d.hitch(this,function(c){var e=this.csvStore.useAddr&&!this.csvStore.useMultiFields?"Match_addr":c.keyField;c.addressValueTextBox&&
(e=this.isDuplicate&&this._useGeomFromLayer&&"not-duplicate"!==b?a.editAddress&&a.editAddress.hasOwnProperty(e)?a.editAddress[e]:void 0:c.addressValue,c.addressValueTextBox.set("value",e))}))},resetGeometry:function(a){this._feature.geometry=a;this.feature.geometry=a;this._featureToolbar._updateLayer(this.layer,null,[this._feature],null,!1,!0).then(d.hitch(this,function(){this._featureToolbar._flashFeatures([this._feature])}));this.resetFromLayerRows()},resetFromLayerRows:function(){this.isDuplicate&&
(this._featureToolbar._fileGeometryModified||(this._useGeomFromLayer=!0),this._featureToolbar._fileValuesModified||(this._useValuesFromLayer=!0),h.forEach(this.featureControlTable.rows,d.hitch(this,function(a){a.fromSelect&&("geom"===a.useType&&this._useGeomFromLayer||"values"===a.useType&&this._useValuesFromLayer)&&a.fromSelect.set("value","layer")})),h.forEach(this.locationControlTable.rows,d.hitch(this,function(a){a.fromSelect&&("geom"===a.useType&&this._useGeomFromLayer||"values"===a.useType&&
this._useValuesFromLayer)&&a.fromSelect.set("value","layer")})))},setStyleColor:function(a){this.styleColor=a;this._featureToolbar.styleColor=a},updateTheme:function(a){this.theme=a}})})},"widgets/DataAggregation/js/UI/FeatureToolbar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Evented dojo/query dojo/dom-class dojo/dom-construct dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dojo/on dojox/gfx/fx dojo/text!./templates/FeatureToolbar.html esri/toolbars/edit jimu/dijit/Message jimu/dijit/Popup jimu/utils esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/Color esri/graphic esri/geometry/webMercatorUtils".split(" "),
function(t,d,h,l,n,w,p,y,u,A,v,m,f,a,b,k,q,e,g,c,x,r){return t([u,A,l],{templateString:f,baseClass:"cf-feature-toolbar",declaredClass:"FeatureToolbar",label:"FeatureToolbar",parent:null,nls:null,map:null,appConfig:null,config:null,feature:null,layer:null,theme:"",isDarkTheme:"",locators:[],styleColor:"",featureView:null,_editToolbar:null,csvStore:null,_isAddressFeature:!0,_stageLayer:null,constructor:function(a){d.mixin(this,a);this._syncDisabled=this._locateDisabled=this._cancelDisabled=this._saveDisabled=
this._editDisabled=!0;this._hasAttributeEdit=!1;this.own(v(this.featureView,"attribute-change",d.hitch(this,this._attributeChange)));this._hasAddressEdit=!1;this.own(v(this.featureView,"address-change",d.hitch(this,this._addressChange)));this._hasGeometryEdit=!1;this.own(v(this._editToolbar,"graphic-move-stop",d.hitch(this,this._graphicMoveStop)));this.own(v(this.featureView,"address-located",d.hitch(this,this._graphicMoveStop)));this.locator=this._getLocator(0);this._initOriginalValues()},postCreate:function(){this.inherited(arguments);
this._darkThemes=["DartTheme","DashboardTheme"];this.updateImageNodes()},startup:function(){this.inherited(arguments);this._started=!0;this.featureView._toggleEditControls(this._editDisabled)},_getLocator:function(a){for(var c;a<this.csvStore._geocodeSources.length;a++)if(this.locatorSource=this.csvStore._geocodeSources[a],this.locatorSource.locator.locationToAddress){c=this.locatorSource.locator;this._locatorIndex=a;break}c&&(c.outSpatialReference=this.map.spatialReference,c.countryCode=this.locatorSource.countryCode);
return c},_initOriginalValues:function(){this._originalValues=d.clone(this.featureView.feature)},_attributeChange:function(a){this._hasAttributeEdit=a;this.featureView.isDuplicate&&this.featureView._useGeomFromLayer?this._updateSaveAndCancel(!this._hasAttributeEdit):this._updateSaveAndCancel(!(this._hasAttributeEdit||this._hasGeometryEdit));this._updateSync(!this.featureView._validateAddressDifference())},_addressChange:function(a){this._hasAddressEdit=a;this._updateLocate(!a)},_graphicMoveStop:function(a){this.featureView.isShowing&&
(this._hasGeometryEdit=!0,this.featureView.isDuplicate&&this.featureView._useGeomFromLayer?this._updateSaveAndCancel(!this._hasAttributeEdit):this._updateSaveAndCancel(!(this._hasAttributeEdit||this._hasGeometryEdit)),this.map.infoWindow.setFeatures(this.featureView._feature),this.map.infoWindow.select(0),a?this._reverseLocate(a.graphic.geometry).then(d.hitch(this,function(){this._hasAddressEdit=!0;this._updateLocate(!0);this.featureView._validateAddressDifference()&&this._updateSync(!1);this.locator=
this._getLocator(0)}),function(a){this.locator=this._getLocator(0);new b(a)}):this.featureView._validateAddressDifference()&&this._updateSync(!1))},_reverseLocate:function(a){var c=new y;if(this._isAddressFeature)this.locator.locationToAddress(a,100,d.hitch(this,function(a){this.featureView._updateAddressFields(a.address,!1);c.resolve({address:a.address})}),d.hitch(this,function(b){this._getNextLocator()?this._reverseLocate(a).then(function(a){c.resolve(a)}):(this.featureView._updateAddressFields({},
!1),c.reject({message:b.message}))}));else{var b;a.spatialReference.isWebMercator&&a.spatialReference.isWebMercator()&&(b=r.webMercatorToGeographic(a));this.featureView._updateAddressFields(b||a,!1);c.resolve({geometry:a})}return c},_disableEdit:function(){this._editDisabled=!1;this._toggleEdit()},_toggleEdit:function(){this._editDisabled=!this._editDisabled;this._updateEdit(this._editDisabled);this.featureView._toggleEditControls(this._editDisabled);this.map.infoWindow.isShowing&&this.map.infoWindow.hide();
this._editDisabled?(this._enableEdit(!1),this._undoEdits(),this._updateSaveAndCancel(!0),this._updateSync(!0),this.map.infoWindow.clearFeatures()):(this.featureView.isDuplicate?(this._flashFeatures([this.featureView._useGeomFromFile?this.featureView._feature:this.featureView._editFeature]),this.featureView._useGeomFromFile?(this._enableEdit(!0),this._updateSaveAndCancel(!(this._hasAttributeEdit||this._hasGeometryEdit))):this._updateSaveAndCancel(!this._hasAttributeEdit)):(this._enableEdit(!0),this._flashFeatures([this.featureView._feature]),
this._updateSaveAndCancel(!(this._hasAttributeEdit||this._hasGeometryEdit))),this._updateLocate(!this._hasAddressEdit),this._hasGeometryEdit&&this._locateDisabled||this.featureView.isDuplicate&&this.featureView._useValuesFromLayer?this._updateSync(!this.featureView._validateAddressDifference()):this._updateSync(!0))},_enableEdit:function(c){c?this._editToolbar.activate(a.MOVE,this.featureView._feature):(this._editToolbar.refresh(),this._editToolbar.deactivate())},_undoEdits:function(){this._hasAttributeEdit&&
(this.featureView.resetAttributeValues(),this._hasAttributeEdit=!1);this._hasAddressEdit&&(this.featureView.resetAddressValues(this._originalValues),this._hasAddressEdit=!1);this._hasGeometryEdit?(this.featureView.resetGeometry(this._originalValues.geometry),this._hasGeometryEdit=!1):this.featureView.resetFromLayerRows();this._updateSync(!this.featureView._validateAddressDifference());this._updateLocate(!0)},_locate:function(){this._locateDisabled||this._locateFeature().then(d.hitch(this,function(){this._hasAddressEdit=
!1;this._updateLocate(!0)}))},_cancel:function(){if(!this._cancelDisabled)var a=new k({titleLabel:this.nls.featureToolbar.cancelTitle,width:400,autoHeight:!0,content:p.create("div",{innerHTML:this.nls.featureToolbar.cancelMessage,style:"padding-bottom: 10px;"}),buttons:[{label:this.nls.yes,onClick:d.hitch(this,function(){a.close();a=null;this._undoEdits();this._updateSaveAndCancel(!0);this._panToAndSelectFeature(this.featureView.isDuplicate&&this.featureView._useGeomFromLayer?this.featureView._editFeature:
this.featureView._feature)})},{label:this.nls.no,onClick:d.hitch(this,function(){a.close()})}],onClose:d.hitch(this,function(){a=null})})},_save:function(a){var c=this.featureView._feature;if(!this._saveDisabled||!0===a){!0!==a&&(this._setFieldValues(this.featureView),this._setAddressValues(this.featureView),this.featureView.feature.geometry=c.geometry,this._originalValues.geometry=c.geometry,this.featureView.isDuplicate&&(this._originalValues.duplicateGeometry=c.geometry));if(-1===this.featureView.label.indexOf("UnMatched")&&
-1===this.featureView.label.indexOf("DuplicateFeatures"))this._updateLayer(this._stageLayer,null,[c],null,!0,!1).then(d.hitch(this,function(a){a&&"success"===a.status&&this._updateFeatureListLabel(c)}));else if(this.featureView.isDuplicate&&!0!==a)this.featureView._updateDuplicateAttributes(null,!0),this._updateLayer(this.layer,null,[c],null,!0,!1).then(d.hitch(this,function(a){a&&"success"===a.status&&this._updateFeatureListLabel(c)}));else{var b=c.attributes[this.layer.objectIdField];this._updateLayer(this.layer,
null,null,[c],!0,!1).then(d.hitch(this,function(e){e&&"success"===e.status&&this.featureView._parentFeatureList.removeFeature(this.featureView.feature,b).then(d.hitch(this,function(){h.forEach(this.featureView._skipFields,d.hitch(this,function(a){delete c.attributes[a]}));this._updateLayer(this._stageLayer,[c],null,null,!0,!1).then(d.hitch(this,function(b){b&&"success"===b.status&&(b.hasOwnProperty("objectId")&&(this.featureView.feature.fieldInfo.filter(d.hitch(this,function(a){return a.name===this._stageLayer.objectIdField}))[0].value=
b.objectId),this.featureView.feature.label=c.attributes[this.csvStore.labelField],b=this.parent._pageContainer.getViewByTitle("Review"),b.matchedFeatureList.addFeature(this.featureView.feature),b.matchedFeatureList.resetFeatureList(),b._updateReviewRows(!0===a?"duplicate":"unmatched"))}))}))}))}!0!==a&&(this._updateSaveAndCancel(!0),this._toggleEdit())}},_updateFeatureListLabel:function(a){var c=this.csvStore.labelField;a=a.attributes[c];var b=q.stripHTML(a.toString?a.toString():"");b!==this.featureView.featureListLabel.innerHTML&&
("."!==this.csvStore.decimalSeperator&&(a=this.feature.fieldInfo.filter(function(a){return a.name===c&&a.needsFormat&&-1===[null,void 0].indexOf(b)}))&&a.hasOwnProperty("length")&&0<a.length&&(b=q.localizeNumber(b),a[0].formattedValue=b),this.featureView.featureListLabel.innerHTML=b,this.featureView.pageTitleDiv.innerHTML=b)},_updateLayer:function(a,c,e,g,f,k){var z=new y;a.applyEdits(c,e,g).then(d.hitch(this,function(a){var c={status:"success"};this.featureView.isDuplicate&&(this._hasGeometryEdit&&
this.featureView._useGeomFromFile&&(this._fileGeometryModified=!0),this._hasAttributeEdit&&this.featureView._useValuesFromFile&&(this._fileValuesModified=!0));f&&(this._hasAttributeEdit=this._hasGeometryEdit=!1);a&&a.hasOwnProperty("length")&&0<a.length&&a[0].hasOwnProperty("objectId")&&(c.objectId=a[0].objectId);!k&&e&&e.hasOwnProperty("length")&&0<e.length&&(a=this.featureView.parent._pageContainer.getViewByTitle("Review"),a._updateNode(a.submitButton,!0));z.resolve(c)}),d.hitch(this,function(a){new b({message:this.nls.warningsAndErrors.saveError});
z.resolve({status:"error",error:a})}));return z},_setFieldValues:function(a){var c=a._useValuesFromFile,b=c?a._changedFileAttributeRows:a._changedLayerAttributeRows,e=a._feature,g=a.feature;h.forEach(a.featureControlTable.rows,function(a){if(a.isEditRow&&-1<b.indexOf(a.rowIndex)){var d=a.parent.isDuplicate&&!c?a.layerValueTextBox:a.fileValueTextBox;e.attributes[a.fieldName]=d.value;g.fieldInfo.filter(function(c){return c.name===a.fieldName})[0].value=d.value;a.parent.isDuplicate&&!c?a.layerValue=
d.value:a.fileValue=d.value;if(d.textbox)d.textbox.title=d.value;else if(d.domNode){var f=d.attr("displayedValue");d.domNode.title=f?f:d.value}}})},_setAddressValues:function(a){var c=a._getAddress(),b=this.csvStore.matchFieldPrefix;a.isDuplicate&&a._useGeomFromLayer||h.forEach(a.addressFields,function(e){var g=b+e.keyField;a.feature.fieldInfo.filter(function(a){return a.name===g})[0].value=c[g];for(var d,f=0;f<a.locationControlTable.rows.length&&(d=a.locationControlTable.rows[f],!d.isAddressRow||
d.keyField!==e.keyField);f++);d.addressValueTextBox.textbox?d.addressValueTextBox.textbox.title=c[g]:d.addressValueTextBox.domNode&&(e=d.addressValueTextBox.attr("displayedValue"),d.addressValueTextBox.domNode.title=e?e:d.addressValueTextBox.value);d.addressValue=c[g]})},_updateFeature:function(a,c,b){var e=this.featureView;e.feature.geometry=a;e._feature.geometry=a;a=[e._feature];e.isDuplicate&&(this._hasGeometryEdit=e._editFeature.geometry.x!==e._feature.geometry.x||e._editFeature.geometry.y!==
e._feature.geometry.y);c||this._updateLayer(e.layer,null,a,null,!1,b).then(d.hitch(this,function(a){a&&"success"===a.status&&(this._panToAndSelectFeature(e._feature),e.emit("address-located"))}))},_locateFeature:function(a){var c=new y,e=this.featureView._getAddressFieldsValues();this._isAddressFeature?this._addressToLocation({address:e,countryCode:this.locatorSource.countryCode,outFields:["ResultID","Score"]}).then(d.hitch(this,function(b){this.locator=this._getLocator(0);this._updateFeature(b.location,
a,!0);c.resolve({feature:this.featureView.feature,address:b.address})}),function(a){new b({message:a.message})}):(e=this.csvStore._getGeometry(e[this.xField],e[this.yField]),this._updateFeature(e,a,!0),c.resolve({feature:this.featureView.feature,geometry:e}));return c},_addressToLocation:function(a){var c=new y;a.maxLocations=1;this.locator.addressToLocations(a,d.hitch(this,function(b){var e=this.csvStore.minScore,g;b&&0<b.length?(h.forEach(b,function(a){"undefined"===typeof g&&a.score>=e&&(g=a);
g&&a.score>g.score&&(g=a)}),g?c.resolve(g):this._getNextLocator()?this._addressToLocation(a).then(function(a){c.resolve(a)}):c.reject({message:this.nls.warningsAndErrors.cannotLocate})):this._getNextLocator()?this._addressToLocation(a).then(function(a){c.resolve(a)}):c.reject({message:this.nls.warningsAndErrors.cannotLocate})}),function(a){c.reject(a)});return c},_getNextLocator:function(){var a=!1,c=this._locatorIndex+1;c<this.csvStore._geocodeSources.length&&(this.locator=this._getLocator(c),a=
"undefined"!==typeof this.locator);return a},_flashFeatures:function(a){var b;h.forEach(a,d.hitch(this,function(a){if(a.geometry){var f=c.fromHex(this.styleColor),k=d.clone(f);k.a=.4;f=new e(e.STYLE_CIRCLE,15,new g(g.STYLE_SOLID,f,1),k);a=new x(a.geometry,f);this.map.graphics.add(a);b=a.getLayer?a.getLayer():b;(a=a.getDojoShape())&&m.animateStroke({shape:a,duration:900,color:{start:a.strokeStyle.color,end:a.strokeStyle.color},width:{start:25,end:0}}).play()}}));setTimeout(d.hitch(this,function(c){c&&
c.clear&&(c.clear(),a&&(a[0]._layer&&a[0]._layer.infoTemplate||a[0].infoTemplate)&&(this.map.infoWindow.setFeatures(a),this.map.infoWindow.select(0)))}),1200,b)},_panToAndSelectFeature:function(a){if(a&&a.geometry){var c=this.map.getMaxZoom(),b=Math.round(.25*c);this.map.centerAndZoom(a.geometry,0<c-b?c-b:c).then(d.hitch(this,function(){this._flashFeatures([a])}))}},setStyleColor:function(a){this.styleColor=a},_updateEdit:function(a){this._editDisabled=a;this._updateImageNode("bg-edit","bg-edit-white",
"bg-edit-disabled",this._editDisabled,this.domNode)},_updateCancel:function(a){this._cancelDisabled=a;this._updateImageNode("bg-cancel","bg-cancel-white","bg-cancel-disabled",this._cancelDisabled,this.domNode)},_updateSaveAndCancel:function(a){this._updateSave(a);this._updateCancel(a)},_updateSave:function(a){this._saveDisabled=a;this._updateImageNode("bg-save","bg-save-white","bg-save-disabled",this._saveDisabled,this.domNode)},_updateLocate:function(a){this._locateDisabled=a;this._updateImageNode("bg-locate",
"bg-locate-white","bg-locate-disabled",this._locateDisabled,this.featureView.domNode)},_updateSync:function(a){this._syncDisabled=a;this.featureView.syncFields&&this._updateImageNode("bg-sync","bg-sync-white","bg-sync-disabled",this._syncDisabled,this.featureView.domNode)},updateImageNodes:function(){this._updateImageNode("bg-edit","bg-edit-white","bg-edit-disabled",this._editDisabled,this.domNode);this._updateImageNode("bg-cancel","bg-cancel-white","bg-cancel-disabled",this._cancelDisabled,this.domNode);
this._updateImageNode("bg-save","bg-save-white","bg-save-disabled",this._saveDisabled,this.domNode);this._updateImageNode("bg-locate","bg-locate-white","bg-locate-disabled",this._locateDisabled,this.domNode);this._updateImageNode("bg-sync","bg-sync-white","bg-sync-disabled",this._syncDisabled,this.featureView.domNode)},_updateImageNode:function(a,c,b,e,g){var d=-1<this._darkThemes.indexOf(this.theme),f=e?b:d?c:a,k=d?c:a;e=!1;d=n("."+a,g);d.hasOwnProperty("length")&&0===d.length?d=n("."+b,g):(e=!0,
k=a);!e&&d.hasOwnProperty("length")&&0===d.length?d=n("."+c,g):e||(e=!0,k=b);h.forEach(d,function(a){w.remove(a,k);w.add(a,f)})},updateTheme:function(a){this.theme=a}})})},"dojox/gfx/fx":function(){define("dojo/_base/lang ./_base ./matrix dojo/_base/Color dojo/_base/array dojo/_base/fx dojo/_base/connect dojo/sniff".split(" "),function(t,d,h,l,n,w,p,y){function u(a,b){this.start=a;this.end=b}function A(a,b,c){this.start=a;this.end=b;this.units=c}function v(a,b){this.start=a;this.end=b;this.temp=new l}
function m(a){this.values=a;this.length=a.length}function f(a,b){this.values=a;this.def=b?b:{}}function a(a,b){this.stack=a;this.original=b}function b(a,b,c,f){if(a.values)return new m(a.values);var e,g;g=a.start?d.normalizeColor(a.start):e=b?c?b[c]:b:f;a.end?a=d.normalizeColor(a.end):(e||(e=b?c?b[c]:b:f),a=e);return new v(g,a)}var k=d.fx={};u.prototype.getValue=function(a){return(this.end-this.start)*a+this.start};A.prototype.getValue=function(a){return(this.end-this.start)*a+this.start+this.units};
v.prototype.getValue=function(a){return l.blendColors(this.start,this.end,a,this.temp)};m.prototype.getValue=function(a){return this.values[Math.min(Math.floor(a*this.length),this.length-1)]};f.prototype.getValue=function(a){var b=t.clone(this.def),c;for(c in this.values)b[c]=this.values[c].getValue(a);return b};a.prototype.getValue=function(a){var b=[];n.forEach(this.stack,function(c){if(c instanceof h.Matrix2D)b.push(c);else if("original"==c.name&&this.original)b.push(this.original);else if("matrix"==
c.name){if(c.start instanceof h.Matrix2D&&c.end instanceof h.Matrix2D){var e=new h.Matrix2D,g;for(g in c.start)e[g]=(c.end[g]-c.start[g])*a+c.start[g];b.push(e)}}else c.name in h&&(e=h[c.name],"function"!=typeof e?b.push(e):(g=n.map(c.start,function(b,e){return(c.end[e]-b)*a+b}),e=e.apply(h,g),e instanceof h.Matrix2D&&b.push(e)))},this);return b};var q=new l(0,0,0,0);k.animateStroke=function(a){a.easing||(a.easing=w._defaultEasing);var e=new w.Animation(a),c=a.shape,d;p.connect(e,"beforeBegin",e,
function(){d=c.getStroke();var e=a.color,g={},k;e&&(g.color=b(e,d,"color",q));(e=a.style)&&e.values&&(g.style=new m(e.values));if(e=a.width){var h=e,x=d;h.values?k=new m(h.values):(e=h.start?h.start:k=x?x.width:1,h.end?k=h.end:"number"!=typeof k&&(k=x?x.width:1),k=new u(e,k));g.width=k}(e=a.cap)&&e.values&&(g.cap=new m(e.values));if(e=a.join)e.values?g.join=new m(e.values):(k=e.start?e.start:d&&d.join||0,e=e.end?e.end:d&&d.join||0,"number"==typeof k&&"number"==typeof e&&(g.join=new u(k,e)));this.curve=
new f(g,d)});p.connect(e,"onAnimate",c,"setStroke");return e};k.animateFill=function(a){a.easing||(a.easing=w._defaultEasing);var e=new w.Animation(a),c=a.shape,d;p.connect(e,"beforeBegin",e,function(){d=c.getFill();var e=a.color;e&&(this.curve=b(e,d,"",q))});p.connect(e,"onAnimate",c,"setFill");return e};k.animateFont=function(a){a.easing||(a.easing=w._defaultEasing);var b=new w.Animation(a),c=a.shape,e;p.connect(b,"beforeBegin",b,function(){e=c.getFont();var b=a.style,g={},d,k;b&&b.values&&(g.style=
new m(b.values));(b=a.variant)&&b.values&&(g.variant=new m(b.values));(b=a.weight)&&b.values&&(g.weight=new m(b.values));(b=a.family)&&b.values&&(g.family=new m(b.values));(b=a.size)&&b.units&&(d=parseFloat(b.start?b.start:c.font&&c.font.size||"0"),k=parseFloat(b.end?b.end:c.font&&c.font.size||"0"),g.size=new A(d,k,b.units));this.curve=new f(g,e)});p.connect(b,"onAnimate",c,"setFont");return b};k.animateTransform=function(b){b.easing||(b.easing=w._defaultEasing);var e=new w.Animation(b),c=b.shape,
f;p.connect(e,"beforeBegin",e,function(){f=c.getTransform();this.curve=new a(b.transform,f)});p.connect(e,"onAnimate",c,"setTransform");if("svg"===d.renderer&&(9<=y("ie")||y("ff")))var k=[p.connect(e,"onBegin",e,function(){for(var a=c.getParent();a&&a.getParent;)a=a.getParent();a&&(c.__svgContainer=a.rawNode.parentNode,c.__svgRoot=a.rawNode,c.__svgRoot&&c.__svgRoot.getAttribute&&(c.__svgWidth=parseInt(c.__svgRoot.getAttribute("width"),10),isNaN(c.__svgWidth)&&delete c.__svgWidth))}),p.connect(e,"onAnimate",
e,function(){try{if(c.__svgContainer){var a=c.__svgContainer.style.visibility;c.__svgContainer.style.visibility="visible";c.__svgContainer.style.visibility=a;var b=c.__svgWidth;if(!isNaN(b))try{c.__svgRoot.setAttribute("width",b-5E-6),c.__svgRoot.setAttribute("width",b)}catch(C){}}}catch(C){}}),p.connect(e,"onEnd",e,function(){n.forEach(k,p.disconnect);if(c.__svgContainer){var a=c.__svgContainer;if(null==a.getAttribute("__gotVis")){a.setAttribute("__gotVis",!0);var b=c.__svgContainer.style.visibility,
e=c.__svgRoot,g=c.__svgWidth;a.style.visibility="visible";setTimeout(function(){try{a.style.visibility=b;a.removeAttribute("__gotVis");a=null;try{isNaN(g)||(e.setAttribute("width",g-5E-6),e.setAttribute("width",g))}catch(E){}}catch(E){}},100)}}delete c.__svgContainer;delete c.__svgRoot;delete c.__svgWidth})];return e};return k})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(t,d,h,l,n,w,p,y,u,A,v,m,f,a,b,k,q,e,g,c,x){var r=d(f,{declaredClass:"esri.toolbars.Edit",constructor:function(a,c){this._map=a;this._tool=0;if(this._map.loaded)this._scratchGL=a.graphics;else var b=l.connect(this._map,"onLoad",this,function(){l.disconnect(b);b=null;this._scratchGL=this._map.graphics});a=p("esri-mobile");this._defaultOptions=h.mixin({vertexSymbol:new e(e.STYLE_CIRCLE,a?20:12,new g(g.STYLE_SOLID,new w([0,0,0,.5]),1),new w([128,128,128])),ghostVertexSymbol:new e(e.STYLE_CIRCLE,
a?18:10,new g(g.STYLE_SOLID,new w([0,0,0,.5]),1),new w([255,255,255,.75])),ghostLineSymbol:new g(g.STYLE_DOT,new w([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:a?24:16,boxLineSymbol:new g(g.STYLE_DASH,new w([64,64,64]),1),boxHandleSymbol:new e(e.STYLE_SQUARE,a?16:9,new g(g.STYLE_SOLID,new w([0,0,0,.5]),1),new w([255,255,255,.75])),textAnchorSymbol:new e(e.STYLE_CIRCLE,10,null,new w([255,0,0]))},c||{})},activate:function(a,c,b){this.deactivate();this._graphic=c;this._options=
h.mixin(h.mixin({},this._defaultOptions),b||{});var e=r.MOVE;b=r.EDIT_VERTICES;var g=r.SCALE,d=r.ROTATE,f=r.EDIT_TEXT,k=!1,q=!1,x=!1,z=this._map,m=z.spatialReference,v=c.geometry.spatialReference;this._geo=!(!m||!v||m.equals(v)||!m.isWebMercator()||4326!==v.wkid);this._isTextPoint=this._prepareTextSymbolEditing(c,a);(a&e)===e&&(k=this._enableMove(c));e=(a&g)===g;d=(a&d)===d;if(e||d)x=this._enableBoxEditing(c,e,d);(a&b)===b&&(q=this._enableVertexEditing(c));(a&f)===f&&this._enableTextEditing(c);if(!(k||
q||x))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=a)this._mapPanEndHandle=l.connect(z,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=l.connect(z,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,c);z.snappingManager&&(k||q)&&z.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var a=this._tool,c=this._graphic;if(a){var b=
!!this._modified;this._clear();l.disconnect(this._mapPanEndHandle);l.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(a,c,{isModified:b});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(a,c){},onDeactivate:function(a,c,b){},
onGraphicMoveStart:function(a){},onGraphicFirstMove:function(a){this._modified=!0},onGraphicMove:function(a,c){},onGraphicMoveStop:function(a,c){},onGraphicClick:function(a,c){},onVertexMoveStart:function(a,c){},onVertexFirstMove:function(a,c){this._modified=!0},onVertexMove:function(a,c,b){},onVertexMoveStop:function(a,c,b){},onVertexAdd:function(a,c){this._modified=!0},onVertexClick:function(a,c){},onVertexMouseOver:function(a,c){},onVertexMouseOut:function(a,c){},onVertexDelete:function(a,c){this._modified=
!0},onTextEditStart:function(a,c){},onTextEditEnd:function(a){},onScaleStart:function(a){},onScaleFirstMove:function(a){this._modified=!0},onScale:function(a,c){},onScaleStop:function(a,c){},onRotateStart:function(a){},onRotateFirstMove:function(a){this._modified=!0},onRotate:function(a,c){},onRotateStop:function(a,c){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(a,b){if("point"===a.geometry.type||"multipoint"===a.geometry.type){var e=a.getLayer(),g=e.renderer,e=a.symbol||e._getSymbol(a);!e&&(g.hasVisualVariables("sizeInfo",!1)||g.hasVisualVariables("colorInfo",!1)||g.hasVisualVariables("opacityInfo",!1))&&g.addBreak&&
g.infos&&1===g.infos.length&&(e=g.infos[0].symbol||g.defaultSymbol);if(e&&"textsymbol"===e.type){if((b&r.SCALE)===r.SCALE||(b&r.ROTATE)===r.ROTATE||(b&r.EDIT_TEXT)===r.EDIT_TEXT){a.setSymbol(new c(e.toJson()));var d=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(a),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){d._boxEditor&&d._boxEditor.refresh()})):
t(["../dijit/SymbolEditor"],function(c){if(!d._textSymbolEditor){var b;b=d._options.textSymbolEditorHolder?y.create("div",null,d._options.textSymbolEditorHolder):y.create("div",null,d._map.root);d._textSymbolEditor=new c({graphic:a},b);c=d._textSymbolEditor.domNode.parentNode.id;u.set(d._textSymbolEditor.domNode,{position:"map_root"===c?"absolute":"relative",left:"map_root"===c?d._map.width/2-100+"px":"5px",top:"20px","z-index":50});d._textSymbolEditor.startup();d._textSymbolEditor.createForm(a);
d._textSymbolEditor.show();d._textSymbolEditor.on("symbol-change",function(){d._boxEditor&&d._boxEditor.refresh()})}})}if((b&r.MOVE)===r.MOVE||(b&r.ROTATE)===r.ROTATE||(b&r.SCALE)===r.SCALE)this._textAnchor=new x(a.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(a){var c=this._map;switch(a.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new b(a,c,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(a){var c=
this._map;switch(a.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=k.create(a,c,this),!0}return!1},_enableBoxEditing:function(c,b,e){var g=this._map,d=c.geometry.type;return"polyline"===d||"polygon"===d||this._isTextPoint?(this._boxEditor=new a(c,g,this,b,e,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(a){return this._isTextPoint?(this._textEditor=new q(a,this._map,this),l.connect(this._textEditor,"onEditStart",h.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var a=this._graphicMover;a&&(a.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var a=this._vertexEditor;a&&(a.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var a=this._boxEditor;a&&(a.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(a,c,b){b&&this._refreshMoveables()},_refreshMoveables:function(a){var c=n.filter([this._graphicMover,this._vertexEditor,this._boxEditor],v.isDefined);n.forEach(c,function(c){c.refresh(a)})},_beginOperation:function(a){n.forEach(this._getAffectedTools(a),function(a){a.suspend()})},_endOperation:function(a){n.forEach(this._getAffectedTools(a),function(a){a.resume()})},_getAffectedTools:function(a){var c=[];switch(a){case "MOVE":c=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":c=[this._boxEditor];break;case "BOX":c=[this._vertexEditor]}return c=n.filter(c,v.isDefined)}});h.mixin(r,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});p("extend-esri")&&h.setObject("toolbars.Edit",r,A);return r})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(t,d,h,l,n,w,p,y,u,A,v,m,f,a,b,k,q){t=t(null,{declaredClass:"esri.toolbars._Box",constructor:function(a,b,c,f,k,h,q){this._graphic=a;this._map=b;this._toolbar=c;this._scale=f;this._rotate=k;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=h;a=c._options;this._markerSymbol=a.boxHandleSymbol;this._lineSymbol=a.boxLineSymbol;this._moveStartHandler=d.hitch(this,this._moveStartHandler);this._firstMoveHandler=d.hitch(this,this._firstMoveHandler);
this._moveStopHandler=d.hitch(this,this._moveStopHandler);this._moveHandler=d.hitch(this,this._moveHandler);this._isTextPoint=q;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){h.forEach(this._getAllGraphics(),function(a){a.hide()})},resume:function(){h.forEach(this._getAllGraphics(),function(a){a.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
h.forEach(this._connects,l.disconnect);var a=this._toolbar._scratchGL;this._anchors&&h.forEach(this._anchors,function(b){a.remove(b.graphic);(b=b.moveable)&&b.destroy()});this._box&&a.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var a=this._map,b=this._toolbar._scratchGL,c=this._getBoxCoords(),k=new f(a.spatialReference),r=d.clone(h.filter(c,function(a,c){return 8!==c&&0===c%2}));r[0]&&r.push([r[0][0],r[0][1]]);k.addPath(r);this._rotate&&
k.addPath([c[1],c[8]]);this._box?this._box.setGeometry(k):(this._box=new q(k,this._lineSymbol),b.add(this._box));this._anchors?h.forEach(this._anchors,function(b,e){this._scale||(e=8);var g=new m(c[e],a.spatialReference);b.graphic.setGeometry(g);var g=b.moveable,d=b.graphic.getDojoShape();d&&(g?d!==g.shape&&(g.destroy(),b.moveable=this._getMoveable(b.graphic,e)):b.moveable=this._getMoveable(b.graphic,e))},this):(this._anchors=[],this._connects=[],h.forEach(c,function(c,e){!this._scale&&8>e||(c=new m(c,
a.spatialReference),c=new q(c,this._markerSymbol),this._isTextPoint&&1===e%2&&c.hide(),b.add(c),this._anchors.push({graphic:c,moveable:this._getMoveable(c,e)}))},this))}else this._cleanUp()},_getBoxCoords:function(a){var b=this._map,c,e=[],f,k,q;if(this._isTextPoint){c=this._graphic.getNode().getBoundingClientRect();var m=b.__container.getBoundingClientRect();c=[{x:c.left-m.left,y:c.top-m.top},{x:c.right-m.left,y:c.top-m.top},{x:c.right-m.left,y:c.bottom-m.top},{x:c.left-m.left,y:c.bottom-m.top}]}else c=
this._getTransformedBoundingBox(this._graphic);h.forEach(c,function(c,g,d){f=c;(k=d[g+1])||(k=d[0]);q={x:(f.x+k.x)/2,y:(f.y+k.y)/2};a||(f=b.toMap(f),q=b.toMap(q));e.push([f.x,f.y]);e.push([q.x,q.y])});this._rotate&&(c=d.clone(e[1]),c=a?{x:c[0],y:c[1]}:b.toScreen({x:c[0],y:c[1],spatialReference:b.spatialReference}),c.y-=this._toolbar._options.rotateHandleOffset,a||(c=b.toMap(c)),e.push([c.x,c.y]));return e},_getTransformedBoundingBox:function(a){var b=this._map,c=a.geometry.getExtent(),e=a.geometry.spatialReference;
a=new m(c.xmin,c.ymax,e);c=new m(c.xmax,c.ymin,e);a=b.toScreen(a);c=b.toScreen(c);return[{x:a.x,y:a.y},{x:c.x,y:a.y},{x:c.x,y:c.y},{x:a.x,y:c.y}]},_getAllGraphics:function(){var a=[this._box];this._anchors&&h.forEach(this._anchors,function(b){a.push(b.graphic)});return a=h.filter(a,v.isDefined)},_getMoveable:function(a,b){var c=a.getDojoShape();if(c)return a=new y(c),a._index=b,this._connects.push(l.connect(a,"onMoveStart",this._moveStartHandler)),this._connects.push(l.connect(a,"onFirstMove",this._firstMoveHandler)),
this._connects.push(l.connect(a,"onMoveStop",this._moveStopHandler)),a.onMove=this._moveHandler,(c=c.getEventSource())&&p.set(c,"cursor",this._toolbar._cursors["box"+b]),a},_moveStartHandler:function(a){this._toolbar["on"+(8===a.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(a){this._toolbar._deactivateScrollWheel();var b=a.host._index,c=this._wrapOffset=a.host.shape._wrapOffsets[0]||0,e=this._graphic.getLayer()._getTransform(),f;a=h.map(this._getBoxCoords(!0),
function(a){return{x:a[0]+c,y:a[1]}});f=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:a[1].x,y:a[3].y};this._centerCoord=u.multiplyPoint(u.invert(e),f);if(8===b)f=u.multiplyPoint(u.invert(e),a[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,f)),this._startLine=[this._centerCoord,f],this._moveLine=d.clone(this._startLine);else if(f=u.multiplyPoint(u.invert(e),a[b]),e=u.multiplyPoint(u.invert(e),a[(b+4)%8]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,
f)),this._firstMoverToAnchor=Math.sqrt((f.x-this._centerCoord.x)*(f.x-this._centerCoord.x)+(f.y-this._centerCoord.y)*(f.y-this._centerCoord.y)),this._startBox=e,this._startBox.width=a[4].x-a[0].x,this._startBox.height=a[4].y-a[0].y,this._moveBox=d.clone(this._startBox),this._xfactor=f.x>e.x?1:-1,this._yfactor=f.y>e.y?1:-1,1===b||5===b)this._xfactor=0;else if(3===b||7===b)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===b?this._rotateEvent:this._scaleEvent)+"FirstMove"](this._graphic)},
_moveHandler:function(a,b){a=a.host._index;var c=this._defaultEventArgs,e,d,g;c.angle=0;c.scaleX=1;c.scaleY=1;if(8===a)e=this._startLine,d=this._moveLine,g=d[1],g.x+=b.dx,g.y+=b.dy,b=this._getAngle(e,d),this._isTextPoint&&(b+=this._graphic.symbol.angle),d=u.rotategAt(b,e[0]),this._graphic.getDojoShape().setTransform(d),c.transform=d,c.angle=b,c.around=e[0];else{e=this._startBox;d=this._moveBox;d.width+=b.dx*this._xfactor;d.height+=b.dy*this._yfactor;this._uniformScaling||this._isTextPoint?(e=d.x+
this._xfactor*d.width,d=d.y+this._yfactor*d.height,e=Math.sqrt((e-this._centerCoord.x)*(e-this._centerCoord.x)+(d-this._centerCoord.y)*(d-this._centerCoord.y)),this._scaleRatio=b=g=e/this._firstMoverToAnchor,e=this._centerCoord):(b=d.width/e.width,g=d.height/e.height,e={x:e.x,y:e.y});if(isNaN(b)||Infinity===b||-Infinity===b)b=1;if(isNaN(g)||Infinity===g||-Infinity===g)g=1;d=u.scaleAt(b,g,e);if(this._isTextPoint){var f=u.rotategAt(this._graphic.symbol.angle,e);this._graphic.getDojoShape().setTransform([f,
d])}else this._graphic.getDojoShape().setTransform(d);c.transform=d;c.scaleX=b;c.scaleY=g;c.around=e}this._toolbar["on"+(8===a?this._rotateEvent:this._scaleEvent)](this._graphic,c)},_moveStopHandler:function(a){this._toolbar._activateScrollWheel();var e=this._graphic,c=this._toolbar,d=c._geo?b.geographicToWebMercator(e.geometry):e.geometry,f=d.spatialReference,h=e.getDojoShape(),q=h.getTransform(),m=e.getLayer()._getTransform();this._isTextPoint?(e=this._graphic.symbol,8===a.host._index?e.angle+=
this._getAngle(this._startLine,this._moveLine):e.font.setSize(Math.round(e.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(e)):(d=d.toJson(),this._updateSegments(d.paths||d.rings,q,m,f),h.setTransform(null),d=k.fromJson(d),e.setGeometry(c._geo?b.webMercatorToGeographic(d,!0):d));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;c._endOperation("BOX");this._defaultEventArgs.transform=q;c["on"+(8===a.host._index?this._rotateEvent:
this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(a,b,c,d){var e=this._map,g=this._wrapOffset||0;h.forEach(a,function(a){h.forEach(a,function(a){this._updatePoint(a,d,g,u,e,c,b)},this)},this)},_updatePoint:function(a,b,c,d,f,k,h){b=f.toScreen({x:a[0],y:a[1],spatialReference:b},!0);b.x+=c;b=d.multiplyPoint([k,h,d.invert(k)],b);b.x-=c;c=f.toMap(b);a[0]=c.x;a[1]=c.y},_getAngle:function(a,b){return 180*Math.atan2(b[0].y-b[1].y,b[0].x-b[1].x)/Math.PI-180*Math.atan2(a[0].y-
a[1].y,a[0].x-a[1].x)/Math.PI},_deNormalizePoint:function(a,b){var c=this._map._getFrameWidth();if(-1===c)return a;for(a={x:a.x,y:a.y};Math.abs(a.x-b.x)>=c;)a.x=a.x<b.x?a.x+c:a.x-c;var e=Math.abs(a.x-b.x);Math.abs(a.x-b.x+c)<e?a.x+=c:Math.abs(a.x-b.x-c)<e&&(a.x-=c);return a}});w("extend-esri")&&d.setObject("toolbars._Box",t,A);return t})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(t,d,h,l,n,w,p,y,u,A){return d("dojox.gfx.Moveable",null,{constructor:function(d,h){this.shape=d;this.delay=h&&0<h.delay?h.delay:0;this.mover=h&&h.mover?h.mover:u;this.leftButtonOnly=h&&h.leftButtonOnly;this.events=[this.shape.on(w.press,t.hitch(this,"onMouseDown"))]},destroy:function(){h.forEach(this.events,function(d){d.remove()});this.events=this.shape=null},onMouseDown:function(d){this.delay?(this.events.push(this.shape.on(w.move,t.hitch(this,"onMouseMove")),this.shape.on(w.release,t.hitch(this,
"onMouseUp"))),this._lastX=d.clientX,this._lastY=d.clientY):this.leftButtonOnly&&!A.isLeft(d)||new this.mover(this.shape,d,this);l.stop(d)},onMouseMove:function(d){var h=d.clientY;if(Math.abs(d.clientX-this._lastX)>this.delay||Math.abs(h-this._lastY)>this.delay)this.onMouseUp(d),new this.mover(this.shape,d,this);l.stop(d)},onMouseUp:function(d){this.events.pop().remove()},onMoveStart:function(d){n.publish("/gfx/move/start",d);p.add(y.body(),"dojoMove")},onMoveStop:function(d){n.publish("/gfx/move/stop",
d);p.remove(y.body(),"dojoMove")},onFirstMove:function(d){},onMove:function(d,h,f){this.onMoving(d,h,f);this.shape.applyLeftTransform(h);this.onMoved(d,h)},onMoving:function(d,h){},onMoved:function(d,h){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(t,d,h,l,n,w){return h("dojox.gfx.Mover",null,{constructor:function(d,h,u){this.shape=d;this.lastX=h.clientX;this.lastY=h.clientY;d=this.host=u;h=
document;u=l(h,n.move,t.hitch(this,"onFirstMove"));this.events=[l(h,n.move,t.hitch(this,"onMouseMove")),l(h,n.release,t.hitch(this,"destroy")),l(h,"dragstart",t.hitch(w,"stop")),l(h,"selectstart",t.hitch(w,"stop")),u];if(d&&d.onMoveStart)d.onMoveStart(this)},onMouseMove:function(d){var h=d.clientX,l=d.clientY;this.host.onMove(this,{dx:h-this.lastX,dy:l-this.lastY},d);this.lastX=h;this.lastY=l;w.stop(d)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){d.forEach(this.events,
function(d){d.remove()});var h=this.host;if(h&&h.onMoveStop)h.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(t,d,h,l,n,w,p,y,u,A,v,m,f,a){var b=t(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(a,b,e,d){this.graphic=a;this.map=b;this.toolbar=e;this.tempPt=d;this._enableGraphicMover();this._moved=!1},refresh:function(a){var b=this.graphic.getDojoShape();!b||!a&&b._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var a=this.graphic,d=a.getDojoShape();d&&(d._hostGraphic=a,this._moveable=new w(d,{mover:b.Mover}),this._moveStartHandle=
h.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=h.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=h.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=h.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(a=d.getEventSource())&&n.set(a,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var a=this._moveable;if(a){h.disconnect(this._moveStartHandle);h.disconnect(this._firstMoveHandle);
h.disconnect(this._movingHandle);h.disconnect(this._moveStopHandle);var b=a.shape;b&&(b._hostGraphic=null,(b=b.getEventSource())&&n.set(b,"cursor","inherit"));a.destroy()}this._moveable=null},_moveStartHandler:function(){var a=this.graphic,b=this.map;this._startTx=a.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&b.snappingManager&&b.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(a)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(a,b,e){a=a.shape.getTransform();b=this.map;var d;v("esri-pointer")?d=b.navigationManager.pointerEvents._processTouchEvent(e,e):e&&"pointermove"===e.type&&(d=A.prototype._processTouchEvent.call({map:b},e,e));d&&b.snappingManager&&b.snappingManager._onSnappingMouseMoveHandler(d);this.tempPt&&this.tempPt.getDojoShape().setTransform(a);this.toolbar.onGraphicMove(this.graphic,a)},_moveStopHandler:function(b){var d=this.graphic,e=this.toolbar,g=this.map,c=e._geo?m.geographicToWebMercator(d.geometry):
d.geometry,k=c.type,h=d.getDojoShape(),n=h.getTransform();if(l.toJson(n)!==l.toJson(this._startTx)){this._moved=!0;switch(k){case "point":var k=[n,y.invert(this._startTx)],v;g.snappingManager&&(v=g.snappingManager._snappingPoint);c=v||g.toMap(y.multiplyPoint(k,g.toScreen(c,!0)));g.snappingManager&&g.snappingManager._killOffSnapping();break;case "polyline":c=this._updatePolyGeometry(c,c.paths,n);break;case "polygon":c=this._updatePolyGeometry(c,c.rings,n)}h.setTransform(null);d.setGeometry(e._geo?
m.webMercatorToGeographic(c,!0):c);this.tempPt&&this.tempPt.setGeometry(new a(d.geometry.toJson()))}else this._moved=!1;e._endOperation("MOVE");e.onGraphicMoveStop(d,n);this._moved||(b=b.__e,g=this.map.position,b=new f(b.pageX-g.x,b.pageY-g.y),e.onGraphicClick(d,{screenPoint:b,mapPoint:this.map.toMap(b)}))},_updatePolyGeometry:function(a,b,e){var d=this.map,c=a.getPoint(0,0),d=d.toMap(d.toScreen(c).offset(e.dx,e.dy));e=d.x-c.x;for(var c=d.y-c.y,f,k,h,d=0;d<b.length;d++)for(k=b[d],f=0;f<k.length;f++)h=
a.getPoint(d,f),a.setPoint(d,f,h.offset(e,c));return a}});b.Mover=t(p,{declaredClass:"esri.toolbars._Mover",constructor:function(a,b,d){this.__e=b}});v("extend-esri")&&(d.setObject("toolbars._GraphicMover",b,u),d.setObject("toolbars._Mover",b.Mover,u));return b})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),
function(t,d,h,l,n,w,p,y,u,A,v,m){var f=t(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(a,b,d){this.graphic=a;this.map=b;this.toolbar=d;a=d._options;this._symbol1=a.vertexSymbol;this._symbol2=a.ghostVertexSymbol;b=a.ghostLineSymbol;this._lineStroke={style:b.style,width:b.width,color:b.color};this._canDel=a.allowDeleteVertices;this._canAdd=a.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(a){a?(this._removeControllers(),
this._addControllers()):(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=h.connect(u,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=h.connect(u,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),
this._symbol1);this._canAdd&&(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var a=this._getGraphicsLayer();this._mouseOverHandle=h.connect(a,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=h.connect(a,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new w({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),a=this._ctxDelete=new p({label:m.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),
this._deleteHandle=h.connect(a,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(a),this._ctxMenu.startup())},_removeControllers:function(){h.disconnect(this._firstMoveHandle);h.disconnect(this._moveStopHandle);h.disconnect(this._mouseOverHandle);h.disconnect(this._mouseOutHandle);h.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=
this._mpVertexMovers=null},_add:function(a,b,d){var f,e,g=this.graphic,c=[];for(f=0;f<a.length;f++){var k=a[f],h=[];for(e=0;e<k.length;e++)h.push(new u(k[e],b,g,f,e,k.length,this,d));c.push(h)}return c},_remove:function(a){a&&l.forEach(a,function(a){l.forEach(a,function(a){a.destroy()})})},_refresh:function(a){a&&l.forEach(a,function(a){l.forEach(a,function(a){a.refresh()})})},_isNew:function(a){return-1===l.indexOf(this._vertexMovers[a.segIndex],a)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(a){a=this._selectedMover;this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(a);this._deleteVertex(a);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(a){a=a.graphic;var b=this._findMover(a);b&&(this.toolbar.onVertexMouseOver(this.graphic,b._getInfo()),b._placeholder||(this._selectedMover=b,this._canDel&&this._bindCtxNode(a.getDojoShape().getNode())))},_mouseOutHandler:function(a){if(a=
this._findMover(a.graphic))this.toolbar.onVertexMouseOut(this.graphic,a._getInfo())},_bindCtxNode:function(a){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(a);this._bindNode=a},_unbindCtxNode:function(){var a=this._bindNode;a&&this._ctxMenu.unBindDomNode(a)},_findMover:function(a){var b,d=[];b=this._mpVertexMovers;l.forEach(this._vertexMovers,function(a){d=d.concat(a)});b&&l.forEach(b,function(a){d=d.concat(a)});
for(b=0;b<d.length;b++){var f=d[b];if(f.graphic===a)return f}},_firstMoveHandler:function(a){!this._isNew(a)&&this._canAdd&&this._hideRelatedMidpoints(a);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(a,b){var d=this._isNew(a);b&&(b.dx||b.dy)?(this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,d),this._canAdd&&(d?this._addMidpoints(a):(this._repositionRelatedMidpoints(a),this._showRelatedMidpoints(a))),this.toolbar._endOperation("VERTICES")):
!d&&this._canAdd&&this._showRelatedMidpoints(a)},_showRelatedMidpoints:function(a){var b=this._getAdjacentMidpoints(a.ptIndex,a.segLength),d=this._mpVertexMovers[a.segIndex];for(a=0;a<b.length;a++){var f=d[b[a]];f.graphic.show();f.refresh()}},_hideRelatedMidpoints:function(a){var b=this._getAdjacentMidpoints(a.ptIndex,a.segLength),d=this._mpVertexMovers[a.segIndex];for(a=0;a<b.length;a++)d[b[a]].graphic.hide()},_repositionRelatedMidpoints:function(a){var b,d=this._getAdjacentMidpoints(a.ptIndex,a.segLength),
f=this._mpVertexMovers[a.segIndex];for(b=0;b<d.length;b++){var e=this._getAdjacentVertices(d[b],a.segLength),g=a.relatedGraphic.geometry.getPoint(a.segIndex,e[0]),e=a.relatedGraphic.geometry.getPoint(a.segIndex,e[1]),g=new A({x:(g.x+e.x)/2,y:(g.y+e.y)/2,spatialReference:g.spatialReference.toJson()});f[d[b]].graphic.setGeometry(g)}},_addMidpoints:function(a){var b=a.segIndex,d=a.ptIndex,f=a.segLength,e=d+1,g,c=f+1;this._mpVertexMovers[b].splice(d,1);var h=this._vertexMovers[b];for(g=0;g<e;g++)h[g].segLength+=
1;for(g=e;g<h.length;g++)h[g].ptIndex+=1,h[g].segLength+=1;a.ptIndex=e;a.segLength=h.length+1;h.splice(e,0,a);a.graphic.setSymbol(this._symbol1);h=this._mpVertexMovers[b];for(g=0;g<d;g++)h[g].segLength+=1;for(g=d;g<f-1;g++)h[g].ptIndex+=1,h[g].segLength+=1;e=this._getAdjacentVertices(d,c);b=this._getAdjacentVertices(d+1,c);f=a.relatedGraphic.geometry.getPoint(a.segIndex,e[0]);g=a.relatedGraphic.geometry.getPoint(a.segIndex,e[1]);e=new A({x:(f.x+g.x)/2,y:(f.y+g.y)/2,spatialReference:f.spatialReference.toJson()});
f=a.relatedGraphic.geometry.getPoint(a.segIndex,b[0]);g=a.relatedGraphic.geometry.getPoint(a.segIndex,b[1]);b=new A({x:(f.x+g.x)/2,y:(f.y+g.y)/2,spatialReference:f.spatialReference.toJson()});f=new u(e,this._symbol2,this.graphic,a.segIndex,d,c,this,!0);a=new u(b,this._symbol2,this.graphic,a.segIndex,d+1,c,this,!0);h.splice(d,0,f,a)},_deleteVertex:function(a){var b,d=a.ptIndex,f=this._vertexMovers[a.segIndex];for(b=0;b<d;b++)--f[b].segLength;for(b=d+1;b<f.length;b++){var e=f[b];--e.ptIndex;--e.segLength}f.splice(d,
1);b=a._getInfo();a.destroy();this.toolbar.onVertexDelete(this.graphic,b)}});d.mixin(f,{create:function(a,b,d){switch(a.geometry.type){case "multipoint":return new f.MultipointVertexEditor(a,b,d);case "polyline":return new f.PolylineVertexEditor(a,b,d);case "polygon":return new f.PolygonVertexEditor(a,b,d)}}});f.MultipointVertexEditor=t(f,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=h.connect(u,"onMoveStart",this,this._moveStartHandler);
h.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);h.disconnect(this._moveStartHandle)},_getSegments:function(a){var b=a.points,d=[],f=a.spatialReference;for(a=0;a<b.length;a++){var e=b[a];d.push(new A({x:e[0],y:e[1],spatialReference:f.toJson()}))}return[d]},_getMidpointSegments:function(a){return[]},_getControlPoints:function(a,b,d,f,e){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(a){var b=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOver(b,
a._getInfo()),this._selectedMover=a,this._canDel&&this._bindCtxNode(a.graphic.getDojoShape().getNode())},_mouseOutHandler:function(a){var b=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOut(b,a._getInfo())},_findMover:function(a){var b=[].concat(this._vertexMovers[0]),d=a.target;for(a=0;a<b.length;a++){var f=b[a];if(f.graphic.getDojoShape().getNode()===d)return f}},_moveStartHandler:function(a){var b=a.ptIndex,d=a.segLength-1,f=a.relatedGraphic.geometry.points;a=f.splice(b,1);f.push(a[0]);
f=this._vertexMovers[0];for(a=d;a>b;a--)--f[a].ptIndex;a=f.splice(b,1);f.push(a[0]);a[0].ptIndex=d},_moveStopHandler:function(a){this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(a,b,d,f,e,g,c,h){a=b.geometry;h?a.removePoint(e):a.setPoint(e,d);b.setGeometry(a)},_deleteMidpoints:function(a){}});f.PolylineVertexEditor=t(f,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(a){var b,d,f=a.paths,e=[];for(b=0;b<f.length;b++){var g=f[b],c=[];for(d=0;d<g.length;d++)c.push(a.getPoint(b,d));e.push(c)}return e},_getMidpointSegments:function(a){var b,d,f=a.paths,e=[],g=a.spatialReference;for(b=0;b<f.length;b++){var c=f[b],h=[];for(d=0;d<c.length-1;d++){var l=a.getPoint(b,d),m=a.getPoint(b,d+1),l=new A({x:(l.x+m.x)/2,y:(l.y+m.y)/2,spatialReference:g.toJson()});h.push(l)}e.push(h)}return e},_getControlPoints:function(a,b,d,f,e){var g=this.map,c,h;this._isNew(a)?
(a=f,f+=1,0<=a&&(c=g.toScreen(b.getPoint(d,a))),f<=e&&(h=g.toScreen(b.getPoint(d,f)))):(a=f-1,f+=1,0<=a&&(c=g.toScreen(b.getPoint(d,a))),f<e&&(h=g.toScreen(b.getPoint(d,f))));return[c,h]},_getAdjacentMidpoints:function(a,b){var d=[],f=a-1;0<=f&&d.push(f);a<b-1&&d.push(a);return d},_getAdjacentVertices:function(a,b){return[a,a+1]},_deleteMidpoints:function(a){var b=this._mpVertexMovers[a.segIndex],d=b.length-1,f=this._getAdjacentMidpoints(a.ptIndex,a.segLength).sort(),e,g=f[0];for(e=0;e<g;e++)--b[e].segLength;
for(e=g+1;e<b.length;e++){var c=b[e];--c.ptIndex;--c.segLength}if(1===f.length)b.splice(g,1)[0].destroy();else for(c=this._getAdjacentVertices(g,d),e=a.relatedGraphic.geometry.getPoint(a.segIndex,c[0]),c=a.relatedGraphic.geometry.getPoint(a.segIndex,c[1]),e=new A({x:(e.x+c.x)/2,y:(e.y+c.y)/2,spatialReference:e.spatialReference.toJson()}),a=new u(e,this._symbol2,this.graphic,a.segIndex,g,d,this,!0),b=b.splice(g,f.length,a),e=0;e<b.length;e++)b[e].destroy()},_updateRelatedGraphic:function(a,b,d,f,e,
g,c,h){a=b.geometry;c?a.insertPoint(f,e+1,v.fromJson(d.toJson())):h?a.removePoint(f,e):a.setPoint(f,e,v.fromJson(d.toJson()));b.setGeometry(a)}});f.PolygonVertexEditor=t(f,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(a){var b,d,f=a.rings,e=[];for(b=0;b<f.length;b++){var g=f[b],c=[];for(d=0;d<g.length-1;d++)c.push(a.getPoint(b,d));e.push(c)}return e},_getMidpointSegments:function(a){var b,d,f=a.rings,e=[],g=a.spatialReference;for(b=0;b<f.length;b++){var c=f[b],
h=[];for(d=0;d<c.length-1;d++){var l=a.getPoint(b,d),m=a.getPoint(b,d+1),l=new A({x:(l.x+m.x)/2,y:(l.y+m.y)/2,spatialReference:g.toJson()});h.push(l)}e.push(h)}return e},_getControlPoints:function(a,b,d,f,e){var g=this.map;this._isNew(a)?a=f:(a=f-1,a=0>a?(e+a)%e:a);f=(f+1)%e;e=g.toScreen(b.getPoint(d,a));b=g.toScreen(b.getPoint(d,f));return[e,b]},_getAdjacentMidpoints:function(a,b){var d=a-1;return[0>d?(b+d)%b:d,a]},_getAdjacentVertices:function(a,b){return[a,(a+1)%b]},_deleteMidpoints:function(a){var b=
a.ptIndex,d=this._mpVertexMovers[a.segIndex],f=d.length-1,e=this._getAdjacentMidpoints(b,a.segLength).sort(),g,c;c=e[0];var h=e[e.length-1];if(0===b)for(g=this._getAdjacentVertices(f-1,f),b=a.relatedGraphic.geometry.getPoint(a.segIndex,g[0]),g=a.relatedGraphic.geometry.getPoint(a.segIndex,g[1]),b=new A({x:(b.x+g.x)/2,y:(b.y+g.y)/2,spatialReference:b.spatialReference.toJson()}),a=new u(b,this._symbol2,this.graphic,a.segIndex,f-1,f,this,!0),d.splice(h,1,a)[0].destroy(),d.splice(c,1)[0].destroy(),e=
0;e<d.length-1;e++)c=d[e],--c.ptIndex,--c.segLength;else{g=this._getAdjacentVertices(c,f);b=a.relatedGraphic.geometry.getPoint(a.segIndex,g[0]);g=a.relatedGraphic.geometry.getPoint(a.segIndex,g[1]);b=new A({x:(b.x+g.x)/2,y:(b.y+g.y)/2,spatialReference:b.spatialReference.toJson()});a=new u(b,this._symbol2,this.graphic,a.segIndex,c,f,this,!0);h=d.splice(c,e.length,a);for(e=0;e<h.length;e++)h[e].destroy();for(e=0;e<c;e++)--d[e].segLength;for(e=c+1;e<d.length;e++)c=d[e],--c.ptIndex,--c.segLength}},_updateRelatedGraphic:function(a,
b,d,f,e,g,c,h){a=b.geometry;c?a.insertPoint(f,e+1,v.fromJson(d.toJson())):h?(a.removePoint(f,e),0===e&&a.setPoint(f,g-1,v.fromJson(a.getPoint(f,0).toJson()))):(a.setPoint(f,e,v.fromJson(d.toJson())),0===e&&a.setPoint(f,g,v.fromJson(d.toJson())));b.setGeometry(a)}});n("extend-esri")&&(d.setObject("toolbars._GraphicVertexEditor",f,y),d.setObject("toolbars._MultipointVertexEditor",f.MultipointVertexEditor,y),d.setObject("toolbars._PolylineVertexEditor",f.PolylineVertexEditor,y),d.setObject("toolbars._PolygonVertexEditor",
f.PolygonVertexEditor,y));return f})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(t,d,h,l,n,w,p,y,u,A,v,m){t=t(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(d,a,b,h,l,e,g,c){this.point=d;this.symbol=a;this.relatedGraphic=b;this.segIndex=h;this.ptIndex=l;this.segLength=
e;this.editor=g;this.map=g.map;this._scratchGL=g.toolbar._scratchGL;this._placeholder=c||!1;this._type=b.geometry.type;this._init();this._enable()},refresh:function(d){if(d||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var d=new A(this.point.toJson()),
d=new v(d,this.symbol);switch(this._type){case "multipoint":d._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(d)}this.graphic=d},_enable:function(){var d=this.graphic.getDojoShape();d&&(d._hasMover=!0,this._moveable=this._getMoveable(d),(d=d.getEventSource())&&n.set(d,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var d=this._moveable;if(d){h.disconnect(this._startHandle);
h.disconnect(this._firstHandle);h.disconnect(this._movingHandle);h.disconnect(this._stopHandle);var a=d.shape;a&&(a=a.getEventSource())&&n.set(a,"cursor","inherit");d.destroy();this._moveable=null}},_needRefresh:function(){var d=this.graphic.getDojoShape(),a=!1;if(d)switch(this._type){case "multipoint":var b=this.relatedGraphic.getDojoShape();b&&(b=b.children[this.ptIndex],d!==b&&(this.graphic._shape=b,a=!0));break;case "polyline":case "polygon":a=!d._hasMover}return a},_getMoveable:function(d){d=
new w(d,l("mac")&&l("ff")&&!u("esri-touch")&&{leftButtonOnly:!0});this._startHandle=h.connect(d,"onMoveStart",this,this._moveStartHandler);this._firstHandle=h.connect(d,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=h.connect(d,"onMoving",this,this._movingHandler);this._stopHandle=h.connect(d,"onMoveStop",this,this._moveStopHandler);return d},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(d){var a=this.map;a.snappingManager&&a.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();d.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(d){var a=d.shape,b=this._getControlEdges(),f=this._scratchGL._div,h,e=[],g=d.host.shape._wrapOffsets[0]||0;for(h=0;h<b.length;h++){var c=b[h];
c.x1+=g;c.x2+=g;e.push([f.createLine({x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2}).setStroke(this.editor._lineStroke),c.x1,c.y1,c.x2,c.y2])}a._lines=e;d.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(d,a,b){a=this.map;var f;u("esri-pointer")?f=a.navigationManager.pointerEvents._processTouchEvent(b,b):b&&"pointermove"===b.type&&(f=y.prototype._processTouchEvent.call({map:a},b,b));f&&a.snappingManager&&
a.snappingManager._onSnappingMouseMoveHandler(f);b=d.shape;d=b.getTransform();b=b._lines;for(f=0;f<b.length;f++)a=b[f],a[0].setShape({x1:a[1]+d.dx,y1:a[2]+d.dy,x2:a[3],y2:a[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),d)},_moveStopHandler:function(d){d=d.shape;var a=this.editor.toolbar,b=d.getTransform(),f=this.map,h=this.graphic,e=a._geo?m.geographicToWebMercator(h.geometry):h.geometry;a._activateScrollWheel();var g,c=d._lines;if(c){for(g=0;g<c.length;g++)c[g][0].removeShape();
d._lines=null}g=!1;var c=!0,l=this._getInfo();b&&(b.dx||b.dy)?this._placeholder&&(this._placeholder=!1,g=!0):c=!1;var r;f.snappingManager&&(r=f.snappingManager._snappingPoint);r=r||f.toMap(f.toScreen(e).offset(b.dx,b.dy));f.snappingManager&&f.snappingManager._killOffSnapping();d.setTransform(null);h.setGeometry(a._geo?m.webMercatorToGeographic(r,!0):r);this.constructor.onMoveStop(this,b);a.onVertexMoveStop(this.relatedGraphic,l,b);if(!c)a.onVertexClick(this.relatedGraphic,l);if(g)a.onVertexAdd(this.relatedGraphic,
this._getInfo())},_getControlEdges:function(){var d=this.map,a=this.relatedGraphic.geometry,b=this.segIndex,h=this.ptIndex,l=this.segLength,e=this._scratchGL._getTransform(),g=e.dx,e=e.dy,c=d.toScreen(this.graphic.geometry),d=c.x-g,c=c.y-e,m=[],a=this.editor._getControlPoints(this,a,b,h,l);a[0]&&m.push({x1:d,y1:c,x2:a[0].x-g,y2:a[0].y-e});a[1]&&m.push({x1:d,y1:c,x2:a[1].x-g,y2:a[1].y-e});return m}});u("extend-esri")&&d.setObject("toolbars.VertexMover",t,p);d.mixin(t,{onMoveStart:function(){},onFirstMove:function(){},
onMoveStop:function(){}});return t})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(t,d,h,l,n,w,p,y,u,A){t=t(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(d,h,f){this._graphic=d;this._map=h;this._toolbar=f;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},
_enable:function(d){this._editBox?(h.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=h.connect(d.getLayer(),"onDblClick",this,function(m){this._map.navigationManager.setImmediateClick(!1);m.graphic==d&&(l.stop(m),h.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(d))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(h.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=
null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(l,m){if(!this._editBox){var f;l.symbol.text||(l.symbol.text="Tempt text",l.setSymbol(l.symbol),f="");var a=this._createInputTextStyle(l,this._map);""!==f&&(f=m||l.symbol.text);this._editBox=w.create("input",{type:"text",value:f});y.set(this._editBox,a);p.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=
h.connect(this._editBox,"onkeyup",d.hitch(this,function(a){a.keyCode!=u.ENTER&&a.keyCode!==u.TAB||this._disable()}));this._editBoxBlurHandler=h.connect(this._editBox,"onblur",d.hitch(this,function(a){this._disable()}));l.symbol.text="";l.setSymbol(l.symbol);l.hide();var b=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",d.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(a){y.set(b,{left:this._editBoxLeft+a.delta.x+
"px",top:this._editBoxTop+a.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(y.get(b,"left"));this._editBoxTop=parseFloat(y.get(b,"top"))});this.onEditStart(l,this._editBox);this._toolbar.onTextEditStart(l,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(h.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&
(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(h.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(d,h){h=d.getDojoShape().getTransformedBoundingBox();var f=d.symbol.font;return{"font-family":f.family,"font-size":f.size+"px","font-style":f.style,
"font-variant":f.variant,"font-weight":f.weight,left:h[0].x+"px",top:h[0].y+"px",width:Math.abs(h[0].x-h[1].x)/Math.cos(d.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var d=this._graphic.symbol;d.text=this._editBox.value;this._graphic.setSymbol(d)}else this._graphic.getLayer().remove(this._graphic)}});n("extend-esri")&&d.setObject("toolbars.TextEditor",t,A);return t})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query".split(" "),
function(t,d,h,l,n,w,p,y,u,A){function v(h){var f=d.clone(h.attributes);(h=h.geometry)&&"point"===h.type&&("x"in f?f._x=h.x:f.x=h.x,"y"in f?f._y=h.y:f.y=h.y);return f}t.exportCSV=function(d,f,a){return t._createCSVStr(f,a).then(function(a){return t._download(d+".csv",a)})};t.exportCSVFromFeatureLayer=function(d,f,a){a=a||{};return t._getExportData(f,{datas:a.datas,objectIds:a.objectIds,fromClient:a.fromClient,withGeometry:a.withGeometry,outFields:a.outFields,filterExpression:a.filterExpression,outSpatialReference:a.outSpatialReference}).then(function(b){return t._formattedData(f,
b,{formatNumber:a.formatNumber,formatDate:a.formatDate,formatCodedValue:a.formatCodedValue,richText:{clearFormat:a.richTextFieldsToClear&&!!a.richTextFieldsToClear.length,fieldsToClear:a.richTextFieldsToClear||[]},popupInfo:a.popupInfo}).then(function(a){return t.exportCSV(d,a.datas,a.columns)})})};t.exportCSVByAttributes=function(h,f,a,b){b=d.mixin({},b);b.datas=a;return t.exportCSVFromFeatureLayer(h,f,b)};t.exportCSVByGraphics=function(d,f,a,b){a=h.map(a,function(a){return a.attributes});return t.exportCSVByAttributes(d,
f,a,b)};t._createCSVStr=function(d,f){var a=new w,b="",k=0,l=0,e="",g="";try{f=h.map(f,function(a){return"string"===typeof a?{name:a}:a});h.forEach(f,function(a){a=a.alias||a.name;-1<a.toString().indexOf(",")&&(a='"'+a+'"');b=b+e+a;e=","});for(var b=b+"\r\n",k=d.length,l=f.length,c=0;c<k;c++){for(var e="",m=0;m<l;m++)(g=d[c][f[m].name])||"number"===typeof g||(g=""),g&&/[",\r\n]/g.test(g)&&(g='"'+g.replace(/(")/g,'""')+'"'),b=b+e+g,e=",";b+="\r\n"}a.resolve(b)}catch(r){console.error(r),a.resolve("")}return a};
t._isIE11=function(){return 11===p.has("ie")};t._isEdge=function(){return p.has("edge")};t._getDownloadUrl=function(d){return window.Blob&&window.URL&&window.URL.createObjectURL?(d=new Blob(["\ufeff"+d],{type:"text/csv"}),URL.createObjectURL(d)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(d)};t._download=function(d,f){var a=new w;try{if(n("ie")&&10>n("ie")){var b=window.top.open("about:blank","_blank");b.document.write("sep\x3d,\r\n"+f);b.document.close();b.document.execCommand("SaveAs",
!0,d);b.close()}else if(10===n("ie")||t._isIE11()||t._isEdge()){var h=new Blob(["\ufeff"+f],{type:"text/csv"});navigator.msSaveBlob(h,d)}else{var m=l.create("a",{href:t._getDownloadUrl(f),target:"_blank",download:d},document.body);if(n("safari")){var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0);m.dispatchEvent(e)}else m.click();l.destroy(m)}a.resolve()}catch(g){a.reject(g)}return a};t._getExportData=function(l,f){var a=new w,b=null,k=[],m=f.datas,e=f.withGeometry,b=f.outFields;
b&&b.length||(b=l.fields);b=d.clone(b);if(e&&!(m&&0<m.length)){var k=d.clone(b),g="",g=-1!==b.indexOf("x")?"_x":"x";b.push({name:g,alias:g,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});g=-1!==b.indexOf("y")?"_y":"y";b.push({name:g,alias:g,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}m&&0<m.length?a.resolve({data:m||[],outFields:b}):f.fromClient?(m=h.map(l.graphics,function(a){return e?v(a):d.clone(a)}),a.resolve({data:m||[],outFields:b})):t._getExportDataFromServer(l,
k,f).then(function(c){a.resolve({data:c||[],outFields:b})});return a};t._getExportDataFromServer=function(d,f,a){var b=new w;if("esri.layers.FeatureLayer"!==d.declaredClass)return b.resolve([]),b;var k=new u(d.url),l=new A;l.where=a.filterExpression||d.getDefinitionExpression&&d.getDefinitionExpression()||"1\x3d1";0<f.length?(d=h.map(f,function(a){return a.name}),l.outFields=d):l.outFields=["*"];l.objectIds=a.objectIds;l.returnGeometry=a.withGeometry;l.outSR=a.spatialReference;k.execute(l,function(a){a=
h.map(a.features,function(a){return v(a)});b.resolve(a)},function(a){console.error(a);b.resolve([])});return b};t._formattedData=function(d,f,a){var b=new w,k=[],l=f.data;f=f.outFields;for(var e=0,g=l.length;e<g;e++){for(var c={},m=0;m<f.length;m++){var r=f[m];c[r.name]=t._getExportValue(l[e][r.name],r,d.objectIdField,d.typeIdField,l[e][d.typeIdField],d.types,a)}k.push(c)}d=h.map(f,function(a){return{alias:a.alias,name:a.name}});b.resolve({datas:k,columns:d});return b};t._getExportValue=function(d,
f,a,b,k,l,e){function g(a){if(m&&y.isDefined(m.fieldInfos))for(var b=0,c=m.fieldInfos.length;b<c;b++){var d=m.fieldInfos[b];if(d.fieldName===a)return d.format}return null}function c(a){for(var b=0,c=r.length;b<c;b++)if(r[b].fieldName===a)return!0;return!1}var m=e.popupInfo,r=e.richText.fieldsToClear,n=!!f.domain&&e.formatCodedValue,u="esriFieldTypeDate"===f.type&&e.formatDate,q=a&&f.name===a;b=b&&f.name===b;c="esriFieldTypeString"===f.type&&e.richText.clearFormat&&c(f.name);return u?p.fieldFormatter.getFormattedDate(d,
g(f.name)):b?p.fieldFormatter.getTypeName(d,l):n?p.fieldFormatter.getCodedValue(f.domain,d):c?d?(f=document.createElement("span"),f.innerHTML=d,f.textContent||f.innerText||""):d:n||u||q||b||c?d:(e=null,a&&l&&0<l.length&&(a=(a=h.filter(l,function(a){return a.id===k}))&&a[0])&&a.domains&&a.domains[f.name]&&a.domains[f.name].codedValues&&(e=p.fieldFormatter.getCodedValue(a.domains[f.name],d)),null!==e?e:d)}})},"widgets/DataAggregation/js/UI/LocationType":function(){define("dojo/_base/declare dojo/_base/lang dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/Deferred dojo/text!./templates/LocationType.html dijit/form/RadioButton".split(" "),
function(t,d,h,l,n,w,p,y){return t([h,l,n,w],{baseClass:"cf-location-type",declaredClass:"CriticalFacilities.LocationType",templateString:y,_started:null,label:"LocationType",parent:null,nls:null,map:null,appConfig:null,config:null,useAddress:!0,useCoordinates:!1,theme:"",isDarkTheme:"",styleColor:"",_coordinatesView:void 0,_addressView:void 0,constructor:function(h){d.mixin(this,h)},postCreate:function(){this.inherited(arguments);this.rdoAddress.set("checked",this.useAddress);this.rdoCoordinates.set("checked",
this.useCoordinates)},startup:function(){this._started=!0;this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=!1},validate:function(d,h){var l=new p;"next-view"===d?l.resolve(this._nextView()):"back-view"===d?l.resolve(this._backView()):this._homeView(h).then(function(d){l.resolve(d)});return l},_nextView:function(){return!0},_backView:function(){return!0},_homeView:function(d){var h=new p;this.pageContainer.getViewByTitle("Home").verifyClearSettings(d).then(function(d){h.resolve(d)});
return h},_updateAltIndexes:function(){if(this.pageContainer&&!this._coordinatesView&&!this._addressView){this._coordinatesView=this.pageContainer.getViewByTitle("Coordinates");this._addressView=this.pageContainer.getViewByTitle("Addresses");var d=this.rdoAddress.checked;this._addressView&&this._coordinatesView&&(this._addressView.altBackIndex=this.index,this._coordinatesView.altBackIndex=this.index,this.altNextIndex=d?this._addressView.index:this._coordinatesView.index)}},_rdoAddressClick:function(){this.rdoAddress.set("checked",
!0)},_rdoAddressChanged:function(d){this.useAddress=d;this._addressView&&this._coordinatesView&&(this.altNextIndex=d?this._addressView.index:this._coordinatesView.index);this.parent._locationMappingComplete=!1},_rdoCoordinateClick:function(){this.rdoCoordinates.set("checked",!0)},_rdoCoordinateChanged:function(d){this.useCoordinates=d;this._addressView&&this._coordinatesView&&(this.altNextIndex=d?this._coordinatesView.index:this._addressView.index);this.parent._locationMappingComplete=!1},setStyleColor:function(d){this.styleColor=
d},updateImageNodes:function(){},updateTheme:function(d){this.theme=d},_getResults:function(){return this.useAddress?this._addressView._getResults():this._coordinatesView._getResults()}})})},"widgets/DataAggregation/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/DataAggregation/js/UI/templates/PageContainer.html":'\x3cdiv style\x3d"height: 100%;" class\x3d"no-select"\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"controlTr" style\x3d"line-height:20px;"\x3e\r\n          \x3c!--BACK--\x3e\r\n          \x3ctd nowrap class\x3d"page-item-td-left" data-dojo-attach-point\x3d"backTd" data-dojo-attach-event\x3d"onclick:_prevView"\x3e\r\n            \x3cdiv class\x3d"float-left bg-img bg-back-img margin-right-5" data-dojo-attach-point\x3d"backImage"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"page-item-div main-text" title\x3d"${nls.back}" label\x3d"${nls.back}"\x3e${nls.back}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3c!--HOME--\x3e\r\n          \x3ctd nowrap align\x3d"center" class\x3d"page-item-td-center" data-dojo-attach-point\x3d"homeTd" data-dojo-attach-event\x3d"onclick:_homeView"\x3e\r\n            \x3cdiv\x3e\r\n              \x3cdiv class\x3d"bg-home bg-home-img" data-dojo-attach-point\x3d"homeImage"\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"page-item-div"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3c!--NEXT--\x3e\r\n          \x3ctd nowrap class\x3d"page-item-td-right" data-dojo-attach-point\x3d"nextTd" data-dojo-attach-event\x3d"onclick:_nextView"\x3e\r\n            \x3cdiv class\x3d"float-right bg-img bg-next-img margin-left-5" data-dojo-attach-point\x3d"nextImage"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"page-item-div main-text" title\x3d"${nls.next}" label\x3d"${nls.next}"\x3e${nls.next}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Home.html":'\x3cdiv style\x3d"height: 100%;" class\x3d"no-select"\x3e\r\n  \x3cdiv class\x3d"bottom-border-mid" data-dojo-attach-point\x3d"schemaMapInstructions"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"pageInstruction" class\x3d"main-instruction"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"main-instruction startpage-hint"\x3e${nls.startPage.startPageHint}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"upload-tab-node" data-dojo-attach-point\x3d"uploadTabNode"\x3e\r\n    \x3cdiv class\x3d"schema-map-instructions" data-dojo-attach-point\x3d"schemaMapInstructions"\x3e\r\n      \x3cdiv class\x3d"usage-instruction"\x3e\r\n        ${nls.startPage.dragDrop}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"drop-or-browse"\x3e\r\n        ${nls.startPage.or}\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"browseContainer"\x3e\r\n        \x3cform class\x3d"file-form" enctype\x3d"multipart/form-data" method\x3d"post"\r\n              data-dojo-attach-point\x3d"fileForm"\x3e\r\n          \x3clabel for\x3d"${id}_file" class\x3d"jimu-btn"\r\n                 data-dojo-attach-point\x3d"uploadLabel"\x3e${nls.startPage.browse}\x3c/label\x3e\r\n          \x3cinput id\x3d"${id}_file" name\x3d"file" type\x3d"file" class\x3d"upload-input"\r\n                 data-dojo-attach-point\x3d"fileNode" /\x3e\r\n        \x3c/form\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"warning-instruction" data-dojo-attach-point\x3d"loadWarning"\x3e\r\n      \x3cspan\x3e${nls.warningsAndErrors.loadWarning}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"credit-warning-container"\x3e\r\n    \x3ca class\x3d"credit-warning" target\x3d"_blank" href\x3d"http://www.esri.com/software/arcgis/arcgisonline/credits"\x3e${nls.warningsAndErrors.consumesCredits}\x3c/a\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Addresses.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0" \x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row" data-dojo-attach-point\x3d"mainInstructionRow"\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cdiv class\x3d"instruction panel-title-hint-td"\x3e${nls.address.addressPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-point\x3d"singleAddressRow"\x3e\r\n        \x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"singleFieldHintTd"\x3e\r\n          \x3c!--table for single field--\x3e\r\n          \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-event\x3d"onClick:_rdoSingleAddressClick" data-dojo-attach-point\x3d"singleRadioRow"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-10 field-control-td"\x3e\r\n                  \x3cinput name\x3d"addr" data-dojo-type\x3d"dijit/form/RadioButton"\r\n                         data-dojo-attach-point\x3d"rdoSingleAddress"\r\n                         data-dojo-attach-event\x3d"onChange:_rdoSingleAddressChanged"\r\n                         title\x3d"${nls.address.singleField}" /\x3e\r\n                  \x3cdiv class\x3d"main-text"\x3e${nls.address.singleField}\x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"bottom-border-bold sub-task-hint panel-title-hint" data-dojo-attach-point\x3d"singleSubTaskHintTr"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-20 panel-title-hint-td float-left" data-dojo-attach-point\x3d"singleSubTaskHintTd"\x3e\r\n                  \x3cspan class\x3d"instruction"\x3e${nls.address.singleFieldHint}\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"bottom-border"\x3e\r\n                \x3ctd data-dojo-attach-point\x3d"singleFieldTableRow"\x3e\r\n                  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n                    \x3ccolgroup\x3e\r\n                      \x3ccol width\x3d"40%" /\x3e\r\n                      \x3ccol width\x3d"60%" /\x3e\r\n                    \x3c/colgroup\x3e\r\n                    \x3ctbody data-dojo-attach-point\x3d"singleFieldTable"\x3e\r\n                    \x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"multiAddressRow"\x3e\r\n        \x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"multiFieldHintTd"\x3e\r\n          \x3c!--table for multi field--\x3e\r\n          \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-event\x3d"onClick:_rdoMultiAddressClick" data-dojo-attach-point\x3d"multiRadioRow"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-10 field-control-td"\x3e\r\n                  \x3cinput name\x3d"addr" data-dojo-type\x3d"dijit/form/RadioButton"\r\n                         data-dojo-attach-point\x3d"rdoMultiAddress"\r\n                         data-dojo-attach-event\x3d"onChange:_rdoMultiAddressChanged"\r\n                         title\x3d"${nls.address.multiField}" /\x3e\r\n                  \x3cdiv class\x3d"main-text"\x3e${nls.address.multiField}\x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"bottom-border sub-task-hint panel-title-hint"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-20 panel-title-hint-td float-left" data-dojo-attach-point\x3d"multiSubTaskHintTd"\x3e\r\n                  \x3cspan class\x3d"instruction"\x3e${nls.address.multiFieldHint}\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd data-dojo-attach-point\x3d"multiFieldTableRow"\x3e\r\n                  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n                    \x3ccolgroup\x3e\r\n                      \x3ccol width\x3d"40%" /\x3e\r\n                      \x3ccol width\x3d"60%" /\x3e\r\n                    \x3c/colgroup\x3e\r\n                    \x3ctbody data-dojo-attach-point\x3d"multiFieldTable"\x3e\x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Coordinates.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0" data-dojo-attach-point\x3d"coordinateTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cdiv class\x3d"instruction panel-title-hint-td"\x3e${nls.coordinates.coordinatesPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/FieldMapping.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.mapping.schemaMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-instruction-row bottom-border-bold"\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cdiv class\x3d"instruction panel-title-hint-td"\x3e${nls.fieldMapping.fieldMappingPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"fieldMappingTable"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/StartPage.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.startPage.locationAndField}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cdiv class\x3d"instruction panel-title-hint-td" data-dojo-attach-point\x3d"locationAndFieldHint"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"task-row" data-dojo-attach-event\x3d"onClick:_locationMappingClick"\x3e\r\n        \x3ctd class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"display-none done-mark" data-dojo-attach-point\x3d"locationMappingComplete"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row" \x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cdiv class\x3d"instruction instruction-padding"\x3e${nls.mapping.locationMappingHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"task-row" data-dojo-attach-event\x3d"onClick:_schemaMappingClick"\x3e\r\n        \x3ctd class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.mapping.schemaMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"display-none done-mark" data-dojo-attach-point\x3d"fieldMappingComplete"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-top-10 task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cdiv class\x3d"instruction instruction-padding"\x3e${nls.mapping.schemaMappingHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv class\x3d"pad-top-10"\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-right display-none" data-dojo-attach-point\x3d"addToMapButton" data-dojo-attach-event\x3d"onClick:_addToMapClick"\x3e${nls.buttons.addToMap}\x3c/div\x3e\r\n    \x3cdiv class\x3d"float-right bg-loading-img bg-loading pad-top-10 display-none" data-dojo-attach-point\x3d"progressNode"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Review.html":'\x3cdiv class\x3d"pad-left-5 no-select" style\x3d"height: 100%"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0" data-dojo-attach-point\x3d"reviewRowTable"\x3e\r\n    \x3ctbody\x3e\r\n\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.review.reviewData}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cdiv class\x3d"instruction panel-title-hint-td" data-dojo-attach-point\x3d"reviewDataHint"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-row" data-dojo-attach-point\x3d"unMatchedControlRow" data-dojo-attach-event\x3d"onclick:_reviewUnMatched"\x3e\r\n        \x3ctd class\x3d"field-control-td width-100"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewUnMatched}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"unMatchedCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"unMatchedHintRow"\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"unMatchedHintTd"\x3e\r\n          \x3cdiv class\x3d"instruction instruction-padding"\x3e${nls.review.reviewUnMatchedHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-row" data-dojo-attach-point\x3d"duplicateControlRow" data-dojo-attach-event\x3d"onclick:_reviewDuplicate"\x3e\r\n        \x3ctd class\x3d"field-control-td width-100"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewDuplicate}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"duplicateCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"duplicateHintRow"\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"duplicateHintTd"\x3e\r\n          \x3cdiv class\x3d"instruction instruction-padding" data-dojo-attach-point\x3d"reviewDuplicateHint"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-row" data-dojo-attach-point\x3d"matchedControlRow" data-dojo-attach-event\x3d"onclick:_reviewMatched"\x3e\r\n        \x3ctd class\x3d"field-control-td width-100"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewMatched}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"matchedCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"matchedHintRow"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cdiv class\x3d"instruction instruction-padding"\x3e${nls.review.reviewMatchedHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv class\x3d"pad-top-10"\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-right" data-dojo-attach-point\x3d"submitButton" data-dojo-attach-event\x3d"onclick:_submit"\x3e${nls.buttons.submit}\x3c/div\x3e\r\n    \x3cdiv class\x3d"float-right bg-loading-img bg-loading pad-top-10 display-none" data-dojo-attach-point\x3d"progressNode"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-right margin-right-15" data-dojo-attach-point\x3d"downloadButton" data-dojo-attach-event\x3d"onclick:_download"\x3e${nls.buttons.download}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/FeatureList.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" data-dojo-attach-point\x3d"pageTitle"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cdiv class\x3d"instruction panel-title-hint-td" data-dojo-attach-point\x3d"pageHint"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd\x3e\r\n          \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n            \x3ctbody data-dojo-attach-point\x3d"featureListTable"\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Feature.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n\r\n  \x3c!-- Title table --\x3e\r\n  \x3ctable class\x3d"page-table display-none table-layout" cellpading\x3d"0" data-dojo-attach-point\x3d"featureTitleTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" data-dojo-attach-point\x3d"pageTitleDiv"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"instruction panel-title-hint-td" data-dojo-attach-point\x3d"pageHintDiv"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3c!--Feature toolbar table--\x3e\r\n  \x3ctable class\x3d"page-table display-none table-layout" cellpading\x3d"0" data-dojo-attach-point\x3d"featureToolbarTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd data-dojo-attach-point\x3d"reviewRowRecordTd" class\x3d"pad-bottom-10 pad-top-10"\x3e\r\n          \x3cspan class\x3d"float-left main-text pad-right-10 display-none pad-left-5" data-dojo-attach-point\x3d"reviewText" style\x3d"line-height:30px;"\x3e${nls.review.item}\x3c/span\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_duplicateFlag" class\x3d"pad-bottom-10 duplicate-flag"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-bottom-10 pad-top-10 feature-toolbar-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"featureToolbar"\x3e\r\n\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3c!--feature toggle table--\x3e\r\n  \x3ctable data-dojo-attach-point\x3d"featureToggleTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border toggle-expand-row" data-dojo-attach-event\x3d"onclick:_toggleFeature"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"field-control-td text-left field-row-width pad-left-5"\x3e\r\n          \x3cdiv class\x3d"font-size-med main-text float-left"\x3e\r\n            ${nls.review.feature}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd style\x3d"width: 20px;" nowrap class\x3d"page-item-td-nav" data-dojo-attach-point\x3d"featureTd"\x3e\r\n          \x3cdiv class\x3d"float-right bg-img-toggle bg-toggle-down-img margin-left-5" data-dojo-attach-point\x3d"toggleFeature"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"featureInformation" class\x3d"display-none"\x3e\r\n\r\n    \x3c!--feature controls table--\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"featureTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol width\x3d"30%" /\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n      \x3c/colgroup\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"featureControlTable"\x3e\x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3c!--location toggle table--\x3e\r\n  \x3ctable data-dojo-attach-point\x3d"locationControlToggleTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border toggle-expand-row" data-dojo-attach-event\x3d"onclick:_toggleLocation"\x3e\r\n        \x3ctd class\x3d"field-control-td text-left field-row-width pad-left-5"\x3e\r\n          \x3cdiv class\x3d"font-size-med main-text float-left"\x3e\r\n            ${nls.review.locationInfo}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd style\x3d"width: 20px;" class\x3d"page-item-td-nav" data-dojo-attach-point\x3d"locationTd"\x3e\r\n          \x3cdiv class\x3d"float-right bg-img-toggle bg-toggle-down-img margin-left-5" data-dojo-attach-point\x3d"toggleLocation"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"locationInformation" class\x3d"display-none"\x3e\r\n\r\n    \x3c!--location toolbar--\x3e\r\n    \x3ctable class\x3d"page-table display-none" cellpading\x3d"0" data-dojo-attach-point\x3d"locationSyncTable"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n          \x3ctd class\x3d"field-control-td pad-left-5"\x3e\r\n            \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"locationHint"\x3e${nls.review.locationControlHint}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"field-control-td" title\x3d"${nls.review.sync}"\x3e\r\n            \x3cdiv class\x3d"float-right bg-ft-img bg-sync feature-toolbar-btn" data-dojo-attach-point\x3d"syncFields" data-dojo-attach-event\x3d"onclick:_syncAddressInfo"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd title\x3d"${nls.featureToolbar.locate}"\x3e\r\n            \x3cdiv class\x3d"bg-ft-img bg-locate feature-toolbar-btn float-right" data-dojo-attach-point\x3d"locateButton" data-dojo-attach-event\x3d"onclick:_locate"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\r\n    \x3c!--location controls table--\x3e\r\n    \x3ctable class\x3d"page-table display-none" cellpading\x3d"0" data-dojo-attach-point\x3d"locationControlTable"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n        \x3ccol width\x3d"65%" /\x3e\r\n      \x3c/colgroup\x3e\r\n      \x3ctbody\x3e\x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n\r\n',
"url:widgets/DataAggregation/js/UI/templates/FeatureToolbar.html":'\x3cdiv class\x3d"float-right no-select"\x3e\r\n  \x3ctable class\x3d"control-table table-layout" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"feature-toolbar-row"\x3e\r\n        \x3ctd title\x3d"${nls.featureToolbar.edit}"\x3e\r\n          \x3cdiv class\x3d"float-left bg-ft-img bg-edit feature-toolbar-btn" data-dojo-attach-event\x3d"onclick:_toggleEdit"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd title\x3d"${nls.featureToolbar.cancel}"\x3e\r\n          \x3cdiv class\x3d"bg-ft-img bg-cancel feature-toolbar-btn" data-dojo-attach-event\x3d"onclick:_cancel"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd title\x3d"${nls.featureToolbar.save}"\x3e\r\n          \x3cdiv class\x3d"float-right bg-ft-img bg-save feature-toolbar-btn" data-dojo-attach-event\x3d"onclick:_save"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/LocationType.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cdiv class\x3d"instruction panel-title-hint-td"\x3e${nls.locationMapping.locationMappingPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-event\x3d"onClick:_rdoAddressClick"\x3e\r\n        \x3ctd class\x3d"field-control-td pad-left-10"\x3e\r\n          \x3cinput name\x3d"lt" data-dojo-type\x3d"dijit/form/RadioButton"\r\n                 data-dojo-attach-point\x3d"rdoAddress"\r\n                 data-dojo-attach-event\x3d"onChange:_rdoAddressChanged"\r\n                 title\x3d"${nls.locationMapping.useAddress}" /\x3e\r\n          \x3cdiv class\x3d"main-text"\x3e${nls.locationMapping.useAddress}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd class\x3d"pad-left-20 pad-bottom-10"\x3e\r\n          \x3cspan class\x3d"instruction"\x3e${nls.locationMapping.useAddressHint}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-instruction-row task-row" data-dojo-attach-event\x3d"onClick:_rdoCoordinateClick"\x3e\r\n        \x3ctd class\x3d"field-control-td pad-left-10"\x3e\r\n          \x3cinput name\x3d"lt" data-dojo-type\x3d"dijit/form/RadioButton"\r\n                 data-dojo-attach-point\x3d"rdoCoordinates"\r\n                 data-dojo-attach-event\x3d"onChange:_rdoCoordinateChanged"\r\n                 title\x3d"${nls.locationMapping.useCoordinates}" /\x3e\r\n          \x3cdiv class\x3d"main-text"\x3e${nls.locationMapping.useCoordinates}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd class\x3d"pad-left-20 pad-bottom-10"\x3e\r\n          \x3cspan class\x3d"instruction"\x3e${nls.locationMapping.useCoordinatesHint}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/Widget.html":'\x3cdiv style\x3d"width: 100%; height: 100%;" class\x3d"no-select"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"pageNavigation"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:widgets/DataAggregation/css/style.css":".jimu-widget-critical-facilities .disabled{cursor: default; background-color: #a0acbf;}.jimu-widget-critical-facilities-ui .credit-warning{color: #86909c; margin-bottom: 10px;}.jimu-widget-critical-facilities-ui .credit-warning-container{margin-top: 20px; margin-bottom: 10px; position: absolute; bottom: 0px;}.jimu-widget-critical-facilities .processing {background-image: url('images/loading.gif'); background-repeat: no-repeat; background-position: center center; height: 22px; width: 100%;}.jimu-widget-critical-facilities-ui .no-select {-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}.jimu-widget-critical-facilities-ui .font-size-large {font-size: 16px;}.jimu-widget-critical-facilities-ui .font-size-med {font-size: 14px;}.jimu-widget-critical-facilities-ui .bottom-border {border-bottom: 1px solid;}.jimu-widget-critical-facilities-ui .bottom-border-bold {border-bottom: 3px solid;}.jimu-widget-critical-facilities-ui .bottom-border-mid {border-bottom: 2px solid;}.jimu-widget-critical-facilities-ui .width-all {width: 100%;}.jimu-widget-critical-facilities-ui .table-layout {table-layout: fixed;}.jimu-widget-critical-facilities-ui .feature-toolbar-btn {padding: 10px; display: block;}.jimu-widget-critical-facilities-ui .feature-toolbar-row {line-height: 25px;}.jimu-widget-critical-facilities-ui .duplicate-col-headers {overflow: hidden; width: 100%; white-space: normal !important; line-height: 1.5; text-align: center;}.jimu-widget-critical-facilities-ui .page-item-td {cursor: pointer; min-width: 0; white-space: nowrap;}.jimu-widget-critical-facilities-ui .float-left {float: left;}.jimu-rtl .jimu-widget-critical-facilities-ui .float-left {float: right;}.jimu-widget-critical-facilities-ui .float-right {float: right;}.jimu-rtl .jimu-widget-critical-facilities-ui .float-right {float: left;}.jimu-widget-critical-facilities-ui .text-left {text-align: left;}.jimu-rtl .jimu-widget-critical-facilities-ui .text-left {text-align: right;}.jimu-widget-critical-facilities-ui .field-row-width {word-break: break-word;}.jimu-widget-critical-facilities-ui .field-row-width2 {word-break: break-word;}.jimu-widget-critical-facilities-ui .pad-side-15 {padding-left: 15px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-side-15 {padding-right: 15px;}.jimu-widget-critical-facilities-ui .bg-home-img {background-image: url('../images/home_black.png');}.jimu-widget-critical-facilities-ui .page-item-td-center:hover .bg-home-img {background-image: url('../images/home_hover.png');}.jimu-widget-critical-facilities-ui .bg-home-img-white {background-image: url('../images/home_white.png');}.jimu-widget-critical-facilities-ui .page-item-td-center:hover .bg-home-img-white {background-image: url('../images/home_hover.png');}.jimu-widget-critical-facilities-ui .bg-home {width: 20px; height: 20px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin: auto;}.jimu-widget-critical-facilities-ui .bg-img {width: 12px; height: 20px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer;}.jimu-widget-critical-facilities-ui .toggle-expand-row {cursor: pointer;}.jimu-widget-critical-facilities-ui .bg-img-toggle {width: 16px; height: 12px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer;}.jimu-widget-critical-facilities-ui .page-item-td-nav {cursor: pointer; min-width: 0; white-space: nowrap;}.jimu-widget-critical-facilities-ui .bg-toggle-down-img {background-image: url('../images/nav_down_black.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-down-img {background-image: url('../images/nav_down_hover.png');}.jimu-widget-critical-facilities-ui .bg-toggle-down-img-white {background-image: url('../images/nav_down_white.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-down-img-white {background-image: url('../images/nav_down_hover.png');}.jimu-widget-critical-facilities-ui .bg-toggle-up-img {background-image: url('../images/nav_up_black.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-up-img {background-image: url('../images/nav_up_hover.png');}.jimu-widget-critical-facilities-ui .bg-toggle-up-img-white {background-image: url('../images/nav_up_white.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-up-img-white {background-image: url('../images/nav_up_hover.png');}.jimu-widget-critical-facilities-ui .feature-toolbar-td {width: 80px;}.jimu-widget-critical-facilities-ui .duplicate-flag {padding-bottom: 9px; float: left; display: inline-table;}.jimu-widget-critical-facilities-ui .bg-ft-img {width: 15px; height: 15px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin: auto;}.jimu-widget-critical-facilities-ui .bg-edit {background-image: url('../images/edit_black.png');}.jimu-widget-critical-facilities-ui .bg-edit:hover {background-image: url('../images/edit_hover.png');}.jimu-widget-critical-facilities-ui .bg-edit-white {background-image: url('../images/edit_white.png');}.jimu-widget-critical-facilities-ui .bg-edit-white:hover {background-image: url('../images/edit_hover.png');}.jimu-widget-critical-facilities-ui .bg-edit-disabled {background-image: url('../images/edit_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .bg-edit-disabled:hover {background-image: url('../images/edit_hover.png');}.jimu-widget-critical-facilities-ui .bg-locate {background-image: url('../images/locate_black.png');}.jimu-widget-critical-facilities-ui .bg-locate:hover {background-image: url('../images/locate_hover.png');}.jimu-widget-critical-facilities-ui .bg-locate-white {background-image: url('../images/locate_white.png');}.jimu-widget-critical-facilities-ui .bg-locate-white:hover {background-image: url('../images/locate_hover.png');}.jimu-widget-critical-facilities-ui .bg-locate-disabled {background-image: url('../images/locate_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .bg-save {background-image: url('../images/save_black.png');}.jimu-widget-critical-facilities-ui .bg-save:hover {background-image: url('../images/save_hover.png');}.jimu-widget-critical-facilities-ui .bg-save-white {background-image: url('../images/save_white.png');}.jimu-widget-critical-facilities-ui .bg-save-white:hover {background-image: url('../images/save_hover.png');}.jimu-widget-critical-facilities-ui .bg-save-disabled {background-image: url('../images/save_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .bg-sync {background-image: url('../images/sync_black.png');}.jimu-widget-critical-facilities-ui .bg-sync:hover {background-image: url('../images/sync_hover.png');}.jimu-widget-critical-facilities-ui .bg-sync-white {background-image: url('../images/sync_white.png');}.jimu-widget-critical-facilities-ui .bg-sync-white:hover {background-image: url('../images/sync_hover.png');}.jimu-widget-critical-facilities-ui .bg-sync-disabled {background-image: url('../images/sync_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .bg-cancel {background-image: url('../images/cancel_black.png');}.jimu-widget-critical-facilities-ui .bg-cancel:hover {background-image: url('../images/cancel_hover.png');}.jimu-widget-critical-facilities-ui .bg-cancel-white {background-image: url('../images/cancel_white.png');}.jimu-widget-critical-facilities-ui .bg-cancel-white:hover {background-image: url('../images/cancel_hover.png');}.jimu-widget-critical-facilities-ui .bg-cancel-disabled {background-image: url('../images/cancel_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .feature-list-row {}.jimu-widget-critical-facilities-ui .feature-list-row:hover {cursor:pointer;}.jimu-widget-critical-facilities-ui .feature-list-row:hover .next-arrow-img {background-image: url('../images/nav_right_hover.png'); cursor: pointer;}.jimu-widget-critical-facilities-ui .page-item-td-left {cursor: pointer; min-width: 0; white-space: nowrap; text-align: left;}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-left {cursor: pointer; min-width: 0; white-space: nowrap; text-align: right;}.jimu-widget-critical-facilities-ui .bg-back-img {background-image: url('../images/nav_left_black.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-back-img {background-image: url('../images/nav_right_black.png');}.jimu-widget-critical-facilities-ui .bg-back-img-white {background-image: url('../images/nav_left_white.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-back-img-white {background-image: url('../images/nav_right_white.png');}.jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img {background-image: url('../images/nav_left_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img {background-image: url('../images/nav_right_hover.png');}.jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img-white {background-image: url('../images/nav_left_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img-white {background-image: url('../images/nav_right_hover.png');}.jimu-widget-critical-facilities-ui .page-item-td-right {cursor: pointer; min-width: 0; white-space: nowrap; text-align: right;}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-right {cursor: pointer; min-width: 0; white-space: nowrap; text-align: left;}.jimu-widget-critical-facilities-ui .bg-next-img {background-image: url('../images/nav_right_black.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-next-img {background-image: url('../images/nav_left_black.png');}.jimu-widget-critical-facilities-ui .bg-next-img-white {background-image: url('../images/nav_right_white.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-next-img-white {background-image: url('../images/nav_left_white.png');}.jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img-white {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img-white {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .jimu-tab3 .page-item-td.jimu-state-active {color: #48494B;}.jimu-widget-critical-facilities-ui .control-node {padding-bottom: 10px; border-bottom: 2px solid;}.jimu-widget-critical-facilities-ui .container-node {padding-top: 10px;}.jimu-widget-critical-facilities-ui .control-disbaled {opacity: .3; cursor: default; pointer-events: none;}.jimu-widget-critical-facilities-ui .min-width-200 {min-width: 200px;}.jimu-widget-critical-facilities-ui .main-text {font-weight: bold; display: inline-block;}.jimu-widget-critical-facilities-ui .panel-title-td {padding: 0px 0px 5px 0px;}.jimu-widget-critical-facilities-ui .panel-title-text {font-weight: bold; display: inline-block; font-size: 15px;}.jimu-widget-critical-facilities-ui .panel-title-hint-td {padding-bottom: 10px; padding-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .panel-title-hint-td {padding-right: 5px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .main-instruction {color: #898989; font-size: 13px;}.jimu-widget-critical-facilities-ui .instruction {color: #898989; font-size: 11px;}.jimu-widget-critical-facilities-ui .instruction-padding {padding-left: 15px; padding-bottom: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .instruction-padding {padding-right: 15px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .width-100 {width: 100%;}.jimu-widget-critical-facilities-ui .pad-10 {padding: 10px;}.jimu-widget-critical-facilities-ui .pad-top-10 {padding-top: 10px;}.jimu-widget-critical-facilities-ui .pad-bottom-10 {padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .pad-left-5 {padding-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-5 {padding-right: 5px;}.jimu-widget-critical-facilities-ui .pad-left-10 {padding-left: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-10 {padding-right: 10px;}.jimu-widget-critical-facilities-ui .pad-left-15 {padding-left: 15px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-15 {padding-right: 15px;}.jimu-widget-critical-facilities-ui .pad-left-20 {padding-left: 20px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-20 {padding-right: 20px;}.jimu-widget-critical-facilities-ui .pad-left-30 {padding-left: 30px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-30 {padding-right: 30px;}.jimu-widget-critical-facilities-ui .pad-right-10 {padding-right: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-right-10 {padding-left: 10px;}.jimu-widget-critical-facilities-ui .pad-right-15 {padding-right: 15px !important;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-right-15 {padding-left: 15px !important;}.jimu-widget-critical-facilities-ui .margin-right-5 {margin-right: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .margin-right-5 {margin-left: 5px;}.jimu-widget-critical-facilities-ui .margin-left-5 {margin-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .margin-left-5 {margin-right: 5px;}.jimu-widget-critical-facilities-ui .margin-right-15 {margin-right: 15px;}.jimu-rtl .jimu-widget-critical-facilities-ui .margin-right-15 {margin-left: 15px;}.jimu-widget-critical-facilities-ui .field-control {min-width: 150px; width: 100%; float: right;}.jimu-rtl .jimu-widget-critical-facilities-ui .field-control {min-width: 150px; width: 100%; float: left;}.jimu-widget-critical-facilities-ui .field-control-td {padding-top: 10px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .sub-field-control-td {padding-bottom: 10px; padding-left: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .sub-field-control-td {padding-right: 10px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .min-width-80 {min-width: 80px;}.jimu-widget-critical-facilities-ui .task-text {float: left; padding-left: 10px; font-weight: bold; font-size: 14px;}.jimu-rtl .jimu-widget-critical-facilities-ui .task-text {float: right; padding-right: 10px; font-weight: bold; font-size: 14px;}.jimu-widget-critical-facilities-ui .task-row {cursor: pointer;}.jimu-widget-critical-facilities-ui .dijitSelectLabel {text-align: left; text-overflow: ellipsis; overflow: hidden;}.jimu-widget-critical-facilities-ui .next-arrow {width: 15px; height: 16px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer;}.jimu-widget-critical-facilities-ui .next-arrow-img {background-image: url('../images/nav_right_black.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .next-arrow-img {background-image: url('../images/nav_left_black.png');}.jimu-widget-critical-facilities-ui .next-arrow-img-white {background-image: url('../images/nav_right_white.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .next-arrow-img-white {background-image: url('../images/nav_left_white.png');}.jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img-white {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img-white {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .sub-task-hint {text-align: left; margin: auto; line-height: 20px; color: #898989; font-size: 11px;}.jimu-widget-critical-facilities-ui .panel-title-hint {padding-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .panel-title-hint {padding-right: 5px;}.jimu-widget-critical-facilities-ui .task-instruction-row {text-align: left; margin: auto;}.jimu-rtl .jimu-widget-critical-facilities-ui .task-instruction-row {text-align: right; margin: auto;}.jimu-widget-critical-facilities-ui .page-table {width: 100%; border-collapse: collapse; font-size: 13px;}.jimu-widget-critical-facilities-ui .width-15 {width: 15px;}.jimu-widget-critical-facilities-ui .display-none {display: none;}.jimu-widget-critical-facilities-ui .display-table-row-group {display: table-row-group;}.jimu-widget-critical-facilities-ui .no-padding {padding: 0px;}.jimu-widget-critical-facilities-ui .cf-page-container {position: relative; width: 100%;}.jimu-widget-critical-facilities-ui .cf-home .disabled {cursor: default; background-color: #a0acbf;}.jimu-widget-critical-facilities-ui .cf-home .upload-tab-node {margin-top: 20px;}.jimu-widget-critical-facilities-ui .cf-home .schema-map-instructions {text-align: center;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse {display: block; margin-top: 10px; margin-bottom: 10px; font-size: 11px; color: #898989; line-height: 20px; position: relative;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:before,.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {content: \"\"; display: block; height: 1px; width: 45%; background: #eee; position: absolute; top: 9px; left: 0;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:before,.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {content: \"\"; display: block; height: 1px; width: 45%; background: #eee; position: absolute; top: 9px; right: 0;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {right: 0; left: auto;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {right: auto; left: 0;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse b {display: inline-block; padding-right: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse b {display: inline-block; padding-left: 5px;}.jimu-widget-critical-facilities-ui .cf-home .file-form {display: inline-block;}.jimu-widget-critical-facilities-ui .cf-home .file-form label {display: inline-block; font-size: 11px; text-transform: uppercase; padding: 5px; margin-right: 5px; min-width: 180px; line-height: 20px; white-space: normal;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .file-form label {display: inline-block; font-size: 11px; text-transform: uppercase; padding: 5px; margin-left: 5px; min-width: 180px; line-height: 20px; white-space: normal;}.DartTheme .jimu-widget-critical-facilities-ui .cf-home .file-form label {color: #15a4fa !important;}.jimu-widget-critical-facilities-ui .cf-home .upload-input {display: none;}.jimu-widget-critical-facilities-ui .cf-home .warning-instruction {color: firebrick; display: none;}.jimu-widget-critical-facilities-ui .cf-home .usage-instruction {font-size: 14px; font-weight: bold;}.jimu-widget-critical-facilities-ui .cf-home .startpage-hint {padding-top: 10px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .cf-home .bottom {padding-top: 10px; padding-bottom: 10px;}.jimu-popup .cf-warning-icon {width: 30px; height: 30px; position: relative; background-size: contain; background-repeat: no-repeat; margin-top: 10px; background-image: url('../images/warning.png');} .jimu-widget-critical-facilities-ui .cf-home .address-search {display: inline-block;}.jimu-widget-critical-facilities-ui .esriCTSearchOuterContainer {padding: 0px 0px 15px 0px; clear: both;}.jimu-widget-critical-facilities-ui .esriCTSearchDiv {float: left; clear: both; margin-right: 10px;}.jimu-widget-critical-facilities-ui .esriCTSearchHeader {margin-bottom: 10px;}.jimu-widget-critical-facilities-ui .esriCTSearchDiv .arcgisSearch {float: left; width: 100% !important;}.jimu-widget-critical-facilities-ui .esriCTSearchContainer {width: 100%; height: 35px;}.jimu-widget-critical-facilities-ui .arcgisSearch .searchGroup .searchInput {width: 170px; padding: 6px 24px 6px 12px !important;}.esriRtl .jimu-widget-critical-facilities-ui .arcgisSearch .searchGroup .searchInput {padding: 6px 12px 6px 24px !important;}.jimu-widget-critical-facilities-ui .arcgisSearch .searchBtn {padding: 6px;}.jimu-widget-critical-facilities-ui .jimu-widget-search .arcgisSearch .searchGroup .searchInputGroup .searchInput {width: auto;}.jimu-widget-critical-facilities-ui .esriCTSearchContainer .searchClear {top: 2px !important;}.jimu-widget-critical-facilities-ui .done-mark {background-image: url('../images/check.png'); width: 15px; height: 16px; position: relative; background-size: contain; float: right; margin-right: 10px; background-repeat: no-repeat;}.jimu-rtl .jimu-widget-critical-facilities-ui .done-mark {background-image: url('../images/check.png'); width: 15px; height: 16px; position: relative; background-size: contain; float: left; margin-left: 10px; background-repeat: no-repeat;}.jimu-widget-critical-facilities-ui .bg-loading {background-image: url('../css/images/loading.gif');}.jimu-widget-critical-facilities-ui .bg-loading-img {width: 75px; height: 15px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin: auto;}",
"*now":function(t){t(['dojo/i18n!*preload*widgets/DataAggregation/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array jimu/BaseWidget dojo/_base/xhr dojo/Deferred dojo/DeferredList dojo/dom-construct jimu/LayerStructure jimu/portalUtils jimu/dijit/Message jimu/dijit/Popup esri/lang esri/request ./js/UI/PageContainer ./js/UI/Home ./js/UI/StartPage ./js/UI/LocationType jimu/utils".split(" "),function(t,d,h,l,n,w,p,y,u,A,v,m,f,a,b,k,q,e,g){return t([l],{baseClass:"jimu-widget-critical-facilities-ui",_configLayerInfo:null,_url:"",_geocodeSources:null,_fsFields:null,
_singleFields:null,_multiFields:null,editLayer:null,_pageContainer:null,_userCanEdit:!0,_userHasCredits:!1,_hasLocators:!0,_locationMappingComplete:!1,_fieldMappingComplete:!1,_tempResultsAdded:!1,postCreate:function(){this.inherited(arguments);this.nls=d.mixin(this.nls,window.jimuNls.common);this._initEditLayerNode();this.editLayerNode&&this._initUserProperties().then(d.hitch(this,function(){this._initThemeAndConfig()}))},_initUserProperties:function(){var a=new w;this.validatePrivileges().then(d.hitch(this,
function(b){this._userCanEdit=b.canEdit;this._userHasCredits=b.hasCredits;this._userCanEdit&&this._userHasCredits?a.resolve(!0):this._alertUser().then(d.hitch(this,function(b){this._hasLocators=b;a.resolve(!0)}))}));return a},_initEditLayerNode:function(){this._configLayerInfo=this.config.layerSettings.layerInfo;this.layerStructure=u.getInstance();this.editLayerNode=this.layerStructure.getNodeById(this._configLayerInfo.featureLayer.id);-1!==[null,void 0].indexOf(this.editLayerNode)&&this._showNoEditLayerMessage()},
_showNoEditLayerMessage:function(){this._userHasCredits=this._userCanEdit=!1;var a=[this.nls.startPage.appropriateCredentials+"\x3c/br\x3e\x3c/br\x3e",this.nls.startPage.or+"\x3c/br\x3e\x3c/br\x3e",f.substitute({layerName:this.config.layerSettings.layerInfo.featureLayer.title},this.nls.startPage.shared)];this._showPopup(a,f.substitute({layerName:this.config.layerSettings.layerInfo.featureLayer.title},this.nls.startPage.unableToAccess))},_initThemeAndConfig:function(){this._setThemeAndColors().then(d.hitch(this,
function(){this._initConfigInfo();this._initEditLayerInfo().then(d.hitch(this,function(){this._initBaseArgs();this._initPageContainer(!1)}))}))},_alertUser:function(){var a=new w;this._userCanEdit?this._removeWorldLocator(!0).then(function(b){a.resolve(0<b.length)}):(this.showEditMessage(),a.resolve(!1));return a},_removeWorldLocator:function(){var b=new w,e=[],g=[];h.forEach(this.config.sources,function(b){g.push(b.url);e.push(a({url:b.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}))});
(new p(e)).then(d.hitch(this,function(a){if(a){for(var c=[],d=0;d<a.length;d++){var e=a[d][1];e&&e.locatorProperties&&e.locatorProperties.isAGOWorldLocator&&c.push(g[d])}if(0<c.length){var h=[];this.config.sources=this.config.sources.filter(function(a){if(-1===c.indexOf(a.url))return!0;h.push(a.name);return!1});a=this._getMessages(h);this._showPopup(a,f.substitute({widgetName:this.label},this.nls.startPage.cannotUseLocator))}}b.resolve(this.config.sources)}));return b},_getMessages:function(a){var b=
[],c="";a?h.forEach(a,d.hitch(this,function(a){c+=f.substitute({widgetName:this.label,locator:a},this.nls.startPage.userCredits);c+="\x3c/br\x3e\x3c/br\x3e"})):(c+=this.nls.startPage.notEnoughCredits,c+="\x3c/br\x3e\x3c/br\x3e");""!==c&&(b.push(c),b.push(this.nls.startPage.contactAdmin+"\x3c/br\x3e\x3c/br\x3e"),0<this.config.sources.length&&(c="",h.forEach(this.config.sources,d.hitch(this,function(a){c+=f.substitute({locator:a.name},this.nls.startPage.canUseLocator);c+="\x3c/br\x3e\x3c/br\x3e"})),
b.push(c)));return b},_showPopup:function(a,b){var c=y.create("div");y.create("div",{className:"cf-warning-icon",style:"float: "+(window.isRTL?"right; margin-left":"left; margin-right")+": 10px;"},c);for(var e="padding-"+(window.isRTL?"right":"left")+": 50px;",f=0;f<a.length;f++)y.create("div",{innerHTML:a[f],style:(0===f?"padding-top:10px; ":"")+e},c);var g=new m({width:500,autoHeight:!0,content:c,titleLabel:b,buttons:[{label:this.nls.ok,onClick:d.hitch(this,function(){g.close();g=null})}],onClose:function(){g=
null}})},_initBaseArgs:function(){this._baseArgs={nls:this.nls,map:this.map,parent:this,config:this.config,appConfig:this.appConfig,theme:this.theme,isDarkTheme:this.isDarkTheme,styleColor:this.styleColor,singleEnabled:this.singleEnabled,multiEnabled:this.multiEnabled,xyEnabled:this.xyEnabled}},onAppConfigChanged:function(a,b,d){switch(b){case "widgetChange":this._clearResults()}},_setThemeAndColors:function(){var a=new w;this.theme=this.appConfig.theme.name;this._getStyleColor().then(d.hitch(this,
function(b){this.styleColor=b;a.resolve(!0)}));return a},_getStyleColor:function(a){var b=new w,c=a?a:this.appConfig.theme.styles[0];n.get({url:"./themes/"+this.theme+"/manifest.json",handleAs:"json",load:d.hitch(this,function(a){a=a.styles;for(var d=0;d<a.length;d++){var e=a[d];e.name===c&&b.resolve(e.styleColor)}})});return b},_initConfigInfo:function(){if(this._configLayerInfo){this._valid=!0;this._url=this._configLayerInfo.featureLayer.url;this._geocodeSources=this.config.sources;this._symbol=
this.config.layerSettings.symbol;this.xyEnabled=this.config.xyEnabled;this.singleEnabled=this.multiEnabled=!1;this._fsFields=[];h.forEach(this._configLayerInfo.fieldInfos,d.hitch(this,function(a){a&&a.visible&&this._fsFields.push({name:a.fieldName,label:a.label,value:a.type,isRecognizedValues:a.isRecognizedValues,duplicate:a.duplicate})}));var a=function(a,b){h.forEach(a.isRecognizedValues,function(a){-1===b.isRecognizedValues.indexOf(a)&&b.isRecognizedValues.push(a)})};this._singleFields=[];this._multiFields=
[];var b=[],e=[],f=[],g=[];this._geocodeSources&&h.forEach(this._geocodeSources,d.hitch(this,function(c){this.singleEnabled=this.singleEnabled?this.singleEnabled:c.singleEnabled;this.multiEnabled=this.multiEnabled?this.multiEnabled:c.multiEnabled;if(c.singleEnabled){var k=c.singleAddressFields[0],l=k.label||k.alias,m=f.indexOf(l),n=k.fieldName||k.name,p=g.indexOf(n);-1<m||-1<p?a(k,this._singleFields[-1<m?m:p]):(f.push(l),g.push(n),this._singleFields.push({label:l,value:n,type:"STRING",isRecognizedValues:k.isRecognizedValues}))}c.multiEnabled&&
h.forEach(c.addressFields,d.hitch(this,function(c){if(c&&c.visible){var d=c.label||c.alias,f=b.indexOf(d),g=c.fieldName||c.name,h=e.indexOf(g);-1<f||-1<h?(d=this._multiFields[-1<f?f:h],"undefined"===typeof d.fieldList?d.fieldList=[d.value,g]:d.fieldList.push(g),a(c,this._multiFields[-1<f?f:h])):(b.push(d),e.push(g),this._multiFields.push({label:d,value:g,type:"STRING",isRecognizedValues:c.isRecognizedValues}))}}))}))}},_initEditLayerInfo:function(){var a=new w;this.editLayerNode.getLayerObject().then(d.hitch(this,
function(b){this.infoTemplate=this.editLayerNode.getInfoTemplate();this.editLayer=b;this.editLayerDefinition=g.getFeatureLayerDefinition(b);this._updateFsFields(this.editLayer,this.infoTemplate);a.resolve(!0)}));return a},_updateFsFields:function(a,b){var c=a.typeIdField,d=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle"],e=["esriFieldTypeDouble"],f=this.editLayerDefinition;h.forEach(this._fsFields,function(h){var k=0;a:for(;k<a.fields.length;k++){var l=a.fields[k];if(l.name===
h.name){h.domain=l.domain;h.length=l.length;h.isTypeIdField=h.name===c;h.subtypes=a.subtypes;var m=!0,k=h.domain,n=!0,p;if(k||h.isTypeIdField)p=g.getCodedValueListForCodedValueOrSubTypes(f,h.name,{});if(p){h.domainValues=p;h.codes=[];h.values=[];for(var r=0;r<p.length;r++){var q=p[r];h.codes.push(q.value);n&&(n=!isNaN(parseInt(q.label,10))&&!isNaN(parseFloat(q.label))&&parseFloat(q.label).toString().length===q.label.toString().length);h.values.push(q.label)}r=0;b:for(;r<p.length;r++)if(m=p[r].value,
m=!isNaN(parseInt(m,10))&&parseInt(m,10).toString().length===m.toString().length,!m)break b}p=l.type;h.type=-1<d.indexOf(p)&&n?"int":-1<e.indexOf(p)&&n?"float":"esriFieldTypeDate"===p?"date":k&&m&&n?"domainInt":k?"domain":"other";h.esriFieldType=p;if("date"===h.type){b:{if(b&&b.info&&b.info.fieldInfos)for(k=b.info.fieldInfos,n=0;n<k.length;n++)if(p=k[n],p.fieldName===h.name){k=p;break b}k=void 0}h.fieldInfo=k}h.nullable=l.nullable;break a}}})},_initPageContainer:function(a){this._initHomeView(a).then(d.hitch(this,
function(a){var c=this._initStartPageView();a=[a,c];this.xyEnabled&&(this.multiEnabled||this.singleEnabled)&&(c=this._initLocationTypeView(),a.push(c));this._pageContainer?(this._tempResultsAdded=this._fieldMappingComplete=this._locationMappingComplete=!1,this._pageContainer.reset(),this._pageContainer.displayControllerOnStart=!1,this._pageContainer.toggleController(!0),this._pageContainer.views=a):this._pageContainer=new b({views:a,nls:this.nls,appConfig:this.appConfig,displayControllerOnStart:!1,
parent:this,styleColor:this.styleColor},this.pageNavigation);this._pageContainer.startup()}))},_initHomeView:function(a){var b=new w;a?this._initUserProperties().then(d.hitch(this,function(){b.resolve(this._getHome())})):b.resolve(this._getHome());return b},_getHome:function(){return new k(d.mixin({_geocodeSources:this._geocodeSources,_fsFields:this._fsFields,_singleFields:this._singleFields,_multiFields:this._multiFields,userName:this.userName,disabled:!this._userCanEdit||!this._userHasCredits&&
!this._hasLocators},this._baseArgs))},_initStartPageView:function(){return new q(this._baseArgs)},_initLocationTypeView:function(){return new e(this._baseArgs)},_clearResults:function(){if(this._pageContainer){var a=this._pageContainer.getViewByTitle("Home");a&&(a._clearStore(!0),a._clearMapping())}},validatePrivileges:function(){var a=new w,b=A.getPortal(this.appConfig.portalUrl);b.getUser().then(d.hitch(this,function(c){this.userName=c.username;this.userCredits="undefined"!==typeof c.availableCredits?
c.availableCredits:"undefined"!==typeof b.availableCredits?b.availableCredits:0;this._checkLayerEditable(0<this.userCredits).then(function(b){a.resolve(b)})}),d.hitch(this,function(b){console.log(b);this._checkLayerEditable(!1).then(function(b){a.resolve(b)})}));return a},_checkLayerEditable:function(a){var b=new w;this.editLayerNode.isEditable().then(d.hitch(this,function(c){b.resolve({canEdit:c,hasCredits:a})}));return b},showEditMessage:function(){var a=[];"undefined"!==typeof this.userName?a=
[this.nls.startPage.userPrivilege+"\x3c/br\x3e\x3c/br\x3e",this.nls.startPage.contactAdminEdit]:(a=A.getPortal(this.appConfig.portalUrl),a=[f.substitute({layerName:this.editLayer.name},this.nls.startPage.noAnonymousEdit+"\x3c/br\x3e\x3c/br\x3e"),f.substitute({org:a.name},this.nls.startPage.pleaseLogin)]);this._showPopup(a,this.nls.startPage.invalidEdit)}})});