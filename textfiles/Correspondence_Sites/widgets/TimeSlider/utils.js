// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/html dojo/dom-geometry dojo/_base/array esri/layers/TimeInfo jimu/utils esri/TimeExtent libs/storejs/store moment/moment".split(" "),function(f,h,n,e,p,q,l,m){var d={};d.intervalUnitOptions=[{label:window.jimuNls.timeUnit.years,value:e.UNIT_YEARS},{label:window.jimuNls.timeUnit.months,value:e.UNIT_MONTHS},{label:window.jimuNls.timeUnit.weeks,value:e.UNIT_WEEKS},{label:window.jimuNls.timeUnit.days,value:e.UNIT_DAYS},{label:window.jimuNls.timeUnit.hours,value:e.UNIT_HOURS},{label:window.jimuNls.timeUnit.minutes,
value:e.UNIT_MINUTES},{label:window.jimuNls.timeUnit.seconds,value:e.UNIT_SECONDS},{label:window.jimuNls.timeUnit.milliSeconds,value:e.UNIT_MILLISECONDS}];d.isLayerEnabledTime=function(a,c,b){b||(b=c.getLayerInfoById(a.id));if(b)return a=b.layerObject,a=a.timeInfo&&a.timeInfo.timeExtent,c=!0,b=b.originOperLayer,b.itemProperties&&"undefined"!==typeof b.itemProperties.timeAnimation&&(c=!1),!1===b.timeAnimation&&(c=!1),!0===b.timeAnimation&&(c=!0),b.itemProperties&&"undefined"!==typeof b.itemProperties.timeAnimation&&
"undefined"!==typeof b.timeAnimation&&(c=!0),!(!c||!a)};d.setLayersUseMapTimebyConfig=function(a,c){c=c.customLayersConfig;a=a.getLayerInfoArray();for(var b=0,d=c.length;b<d;b++)for(var e=c[b],f=0,h=a.length;f<h;f++){var k=a[f];e.id===k.id&&k.layerObject.setUseMapTime&&(!0===e.isTimeEnable?k.layerObject.setUseMapTime(!0):k.layerObject.setUseMapTime(!1))}};d.initPositionForTheme={DartTheme:{bottom:140},LaunchpadTheme:{bottom:120}};d.isRunInMobile=function(){return window.appInfo.isRunInMobile};d.isOutOfScreen=
function(a,c){var b=h.getMarginBox(a.root);a=b.w;b=b.h;return c&&(c.top>=b||c.left>=a)?!0:!1};d.initPosition=function(a,c,b){if(b&&b.hasMoved)f.setStyle(c,"top",b.top+"px"),f.setStyle(c,"left",b.left+"px");else{var g=window.getAppConfig(),e;g&&g.theme&&g.theme.name&&(e=g.theme.name);g=d.getInitTop(a,e);a=d.getInitLeft(a,c);b.top=g;b.left=a;f.setStyle(c,"top",b.top+"px");f.setStyle(c,"left",b.left+"px");b.hasMoved=!0}};d.getInitTop=function(a,c){var b=0;return b=h.getMarginBox(a.root).h-(d.initPositionForTheme[c]?
d.initPositionForTheme[c].bottom:60)-35};d.getInitLeft=function(a,c){a=h.getMarginBox(a.root);c=f.getContentBox(c);return a.w/2-c.w/2};d.isValidDate=function(a){return a instanceof Date&&!isNaN(a.getTime())};d.isValidDataStrByDateLocale=function(a){return"undefined NaN, NaN"===a?!1:!0};d.hasLiveData=function(a){return!!(a&&a.useMapTime&&a.timeInfo&&a.timeInfo.hasLiveData)};d.getCalendarTime=function(a,c){var b;if("time"===a.timeMode||"min"===a.timeMode||"max"===a.timeMode)b=new Date(a.time);else if("now"===
a.timeMode||"today"===a.timeMode)if(b=c?new Date(c):new Date,b="today"===a.timeMode?new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0):b,a=a.calender,c="",a&&a.number&&a.operator&&a.unit){var d=a.unit;if(-1!==d.indexOf("esriTimeUnits"))(d=d.split("esriTimeUnits"))&&2===d.length&&(c=d[1]);else return console.log("unsupported unit:"+a.unit),new Date(b);"+"===a.operator?b=m(b).add(a.number,c).valueOf():"-"===a.operator&&(b=m(b).subtract(a.number,c).valueOf())}return new Date(b)};d.isConfigLiveMode=
function(a){var c=!1,b=!1,g=!1===a.isHonorWebMap;a&&a.customTimeConfig&&a.customTimeConfig.startTime&&a.customTimeConfig.startTime.timeConfig&&a.customTimeConfig.startTime.timeConfig.timeMode&&(c=d.isLiveTimeMode(a.customTimeConfig.startTime.timeConfig.timeMode));a&&a.customTimeConfig&&a.customTimeConfig.endTime&&a.customTimeConfig.endTime.timeConfig&&a.customTimeConfig.endTime.timeConfig.timeMode&&(b=d.isLiveTimeMode(a.customTimeConfig.endTime.timeConfig.timeMode));return g&&(c||b)};d.isLiveTimeMode=
function(a){return!a||"now"!==a&&"today"!==a&&"max"!==a&&"min"!==a?!1:!0};d.timeCalendarForBuilderConfig=function(a){if(!1===a.isHonorWebMap){var c,b;b=new Date;c=d.getCalendarTime(a.customTimeConfig.startTime.timeConfig,b);b=d.getCalendarTime(a.customTimeConfig.endTime.timeConfig,b);return{startTime:c,endTime:b,interval:null!==a.customTimeConfig.interval?a.customTimeConfig.interval:null,thumbCount:!0===a.customTimeConfig.displayAllData?1:2}}return null};d.getFullTimeExtent=function(a,c){var b=null;
n.forEach(a,function(a){a&&(b?(b.startTime>a.startTime&&(b.startTime=new Date(a.startTime.getTime())),b.endTime<a.endTime&&(b.endTime=new Date(a.endTime.getTime()))):b=new q(new Date(a.startTime.getTime()),new Date(a.endTime.getTime())))});a=1;!0===c&&(a=0);b.startTime=new Date(b.startTime.getFullYear(),b.startTime.getMonth(),b.startTime.getDate(),b.startTime.getHours(),b.startTime.getMinutes(),0,0);b.endTime=new Date(b.endTime.getFullYear(),b.endTime.getMonth(),b.endTime.getDate(),b.endTime.getHours(),
b.endTime.getMinutes()+a,0,0);return b};d.getAutoRefreshTime=function(a){var c=0,b="";if(a&&a.autoRefresh&&!0===a.autoRefresh.isAutoRefresh&&a.autoRefresh.interval&&a.autoRefresh.unit){var d=a.autoRefresh.unit;-1!==d.indexOf("esriTimeUnits")&&(d=d.split("esriTimeUnits"))&&2===d.length&&(b=d[1]);b=b.toUpperCase();"SECONDS"===b?c=a.autoRefresh.interval:"MINUTES"===b?c=60*a.autoRefresh.interval:"HOURS"===b?c=3600*a.autoRefresh.interval:"DAYS"===b&&(c=86400*a.autoRefresh.interval)}return 1E3*c};d.getKey=
function(a){return"TimeSlider."+encodeURIComponent(p.getAppIdFromUrl())+"."+a};d.getCacheByKeys=function(a){return l.get(d.getKey(a))};d.saveToLocalCache=function(a,c){d.removeLocalCache(a);l.set(d.getKey(a),c)};d.removeLocalCache=function(a){d.getCacheByKeys(a)&&l.remove(d.getKey(a))};return d});